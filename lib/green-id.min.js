var GREENID={USER_ID:"result.return.verificationResult.userId",STATE:{PENDING:"pending",VERIFIED:"verified",REJECTED:"rejected"}},GreenId={Overrides:{Lang:{},Source:{}}},fcGreenID=function(a){"use strict";if(!fc)return{};var b={address:"greenIDAddress",country:"greenIDCountry",dob:"greenIDDOB",email:"greenIDEmail",firstName:"greenIDFirstName",integrationId:"greenIDIntegration",middleName:"greenIDMiddleName",postcode:"greenIDPostcode",state:"greenIDState",suburb:"greenIDSuburb",title:"greenIDTitle",surname:"greenIDSurname"},c=function(a,c){var d,e={},f=function(a){if(c.indexOf(fc.constants.prefixSeparator)>=0){var b=c.split(fc.constants.prefixSeparator)[0],d=fc.fieldSchema[b],e=d.config.sourceField,f=c.split(fc.constants.prefixSeparator);f.length>2&&(e+="."+f[1]+"."),e+=a;var g=e.split(".").reduce(function(a,b){return void 0!==a?a[b]:void 0},fc.fields);if(void 0!==g)return g}return fc.getValue(a)};for(var g in b)b.hasOwnProperty(g)&&(d=fc.getConfig(a,b[g],""),d.length>0&&(e[g]=f(d)));return e},d=function(a){return""+a.split("").reduce(function(a,b){return(a=(a<<5)-a+b.charCodeAt(0))&a},0)},e=function(a){return!0===a.passed||["VERIFIED","VERIFIED_ADMIN","VERIFIED_WITH_CHANGES","PASSED","PENDING"].indexOf(a.state)>=0},f=function(a,b){for(var c,d=/<%([^%>]+)?%>/g,e=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,f="var r=[];\n",g=0,h=function(a,b){return f+=b?a.match(e)?a+"\n":"r.push("+a+");\n":""!=a?'r.push("'+a.replace(/"/g,'\\"')+'");\n':"",h};c=d.exec(a);)h(a.slice(g,c.index))(c[1],!0),g=c.index+c[0].length;return h(a.substr(g,a.length-g)),f+='return r.join("");',new Function(f.replace(/[\r\t\n]/g,"")).apply(b)};return{init:function(){fc.loadMaterialDatepicker()},initGreenId:function(){},passesValidation:function(){return!1},session:function(b){var g=fc.getFieldDefinition(b),h=c(g,b),i=d(JSON.stringify(h));if(void 0!==fcGreenID.sessions[i])return fcGreenID.sessions[i];var j=this;this.fieldIds=[b],this.events=function(){var a={},b=a.hasOwnProperty;return{const:{DISPLAY_CHILD_SOURCE:"greenid/options/display-child",DISPLAY_SOURCE:"greenid/options/display-source",DISPLAY_SUCCESS:"greenid/messages/success",EXTRA_FAILED:"greenid/extra/fail",FATAL_ERROR:"greenid/errors/fatal",FETCH_ERROR:"greenid/fetch/error",FETCH_RESULT_INITIALISED:"greenid/fetch/initialised",FETCH_RESULT_NOT_INITIALISED:"greenid/fetch/not-initialised",GET_EXTRA_DATA:"greenid/extra/get",OPTION_CLICKED:"greenid/options/clicked",READY_FOR_RENDER:"greenid/render/ready",RENDER_PENDING:"greenid/render/main",RENDER_VERIFIED:"greenid/render/verified",SHOW_EXTRA_DATA_SOURCE:"greenid/extra/show",SOURCE_CHANGED:"greenid/sources/changed",SOURCE_SUBMIT:"greenid/source/submit",SOURCE_VERIFIED:"greenid/source/verified",VERIFICATION_DO:"greenid/verification/do",VERIFICATION_ERROR:"greenid/verification/error",VERIFICATION_SKIPPED:"greenid/verification/skipped",VERIFICATION_SUCCESS:"greenid/verification/success"},subscribe:function(c,d){b.call(a,c)||(a[c]=[]);var e=a[c].push(d)-1;return{remove:function(){delete a[c][e]}}},publish:function(c,d){b.call(a,c)&&a[c].forEach(function(a){a(void 0!=d?d:{})})}}}(),this.fieldId=b,this.field=fc.getFieldDefinition(b),this.config=this.field.config,this.options=this.config.greenIDIntegration.config,this.extraData={},this.fatalError=!1,this.userId=function(){var a=fc.getValue(j.fieldId);return"object"==typeof a&&"object"==typeof a.result?a.result.return.verificationResult.userId:null},this.events.subscribe(this.events.const.FETCH_RESULT_INITIALISED,function(a){"object"==typeof fc.getValue(j.fieldId)&&("object"==typeof a&&"object"==typeof a.result&&fc.setVirtualValue(j.fieldId,a.result,fc.fields,!1,!1),j.events.publish(j.events.const.READY_FOR_RENDER))}),this.events.subscribe(this.events.const.FETCH_RESULT_NOT_INITIALISED,function(a){var b=c(j.field,j.fieldId);b.fieldId=j.fieldId,Object.keys(j.extraData).length>0&&(b.extra=j.extraData),fc.api("greenid/gateway-v2/init",b,"POST",function(a){if(fc.setVirtualValue(j.fieldId,{values:b,result:a},fc.fields,!1,!1),Object.keys(j.extraData).length>0){var c=_.find(j.options.sources.extraData,function(a){return a.key==j.extraData.source});if(void 0===c||!_.isObject(c.onFail))return void j.events.publish(j.events.const.READY_FOR_RENDER);var d=_.find(a.return.verificationResult.individualResults,function(a){return a.name==c.source});if(void 0===d)return void j.events.publish(j.events.const.READY_FOR_RENDER);if(!e(d))return void j.events.publish(j.events.const.EXTRA_FAILED,c);j.events.publish(j.events.const.READY_FOR_RENDER)}else j.events.publish(j.events.const.READY_FOR_RENDER)})}),this.events.subscribe(this.events.const.EXTRA_FAILED,function(a){var b=f('<div class="fc-green-id extra-data-source"> <div class="options">   <div class="child-container with-submit">     <div class="pre-verification">       <h4><%this.title%></h4>       <div class="desc"><%this.desc%></div>     </div>   </div>   <div class="status-bar"></div>   <div class="source-submit">     <div class="links">       <a href="#"data-for="<%this.source%>" data-continue="true" class="btn"><%this.text%></a>     </div>   </div> </div></div>',{title:fc.tokenise(a.onFail.label),desc:fc.tokenise(a.onFail.msg||""),text:j.lang("extraFailContinue","Continue")});j.render(b)}),this.events.subscribe(this.events.const.READY_FOR_RENDER,function(a){if(j.isSkipped())return void j.events.publish(j.events.const.VERIFICATION_SKIPPED);switch(j.getApplicationStatus()){case GREENID.STATE.VERIFIED:j.events.publish(j.events.const.RENDER_VERIFIED,a);break;case GREENID.STATE.REJECTED:j.events.publish(j.events.const.FATAL_ERROR,{msg:j.lang("couldNotVerify","We're sorry, but we could not verify your identity.")});break;case GREENID.STATE.PENDING:j.events.publish(j.events.const.RENDER_PENDING,a)}}),this.events.subscribe(this.events.const.RENDER_PENDING,function(a){var b=_.filter(j.options.sources.active,function(a){return!0===a.primary}),c="";_.each(b,function(a){var b=a.source;("string"!=typeof a.source||j.userHasSource(b))&&(c+=f('<li class="fc-greenid-source" data-status="<%this.status%>" data-source="'+a.key+'"> <div class="icon"><div></div></div> <label>'+a.label+"</label></li>",{status:j.getSourceStatus(a)}))});var d="";"boolean"==typeof j.config.allowSkipping&&j.config.allowSkipping&&(d=f('<div class="skip-verification"> <div>   <%this.skipText%> </div></div>',{skipText:j.lang("skipText",'Can\'t pass verification? <a href="#" class="verification-skip fc-link">Click here</a> to skip.')}));var e=f('<div class="fc-green-id-summary"><%this.summary%></div><div class="fc-green-id fc-ready"> <div class="options primary">   <ul>'+c+'</ul>   <div class="fc-clear"></div> </div> <%this.skip%> <%this.error%></div>',{error:"string"==typeof a.error?'  <div class="verification-error">'+a.error+"</div>":"",skip:d,summary:j.greenIdSummary()});j.render(e),j.events.publish(j.events.const.SOURCE_CHANGED)}),this.events.subscribe(this.events.const.RENDER_VERIFIED,function(a){var b=_.filter(j.options.sources.active,function(a){return!0===a.primary}),c="";_.each(b,function(a){var b=j.getSourceStatus(a);if("verified"===b){a.source;c+=f('<li class="fc-greenid-source" data-status="<%this.status%>" data-source="'+a.key+'"> <div class="icon"><div></div></div> <label>'+a.label+"</label></li>",{status:b})}});var d=f('<div class="fc-green-id fc-ready"> <div class="options primary">   <ul>'+c+'</ul>   <div class="fc-clear"></div> </div> <div class="status-bar"></div></div>');j.render(d),j.events.publish(j.events.const.VERIFICATION_SUCCESS,{msg:j.lang("verifyMessage","Your identify has successfully been verified.")})}),this.events.subscribe(this.events.const.SOURCE_CHANGED,function(){j.canStillVerify()||j.events.publish(j.events.const.FATAL_ERROR,{msg:j.lang("notEnoughInformation","We're sorry, but we could not gather enough information to verify your identity.")})}),this.events.subscribe(this.events.const.FATAL_ERROR,function(a){var b=f('<div class="fc-green-id fatal-error"> <div><%this.msg%></div></div>',{msg:a.msg});j.render(b)}),this.events.subscribe(this.events.const.OPTION_CLICKED,function(a){var b=_.find(j.options.sources.active,function(b){return b.key==a.source});if(!1===b.source)return void j.events.publish(j.events.const.DISPLAY_CHILD_SOURCE,b);j.events.publish(j.events.const.DISPLAY_SOURCE,b)}),this.events.subscribe(this.events.const.DISPLAY_SOURCE,function(a){j.render(j.loading(j.lang("retrievingSourceDetails","Retrieving source details")));var b={fieldId:j.fieldId,sourceId:a.source,verificationUserId:j.userId()},c=a;fc.api("greenid/gateway-v2/get-fields",b,"POST",function(a){var d=a.return.sourceFields.rawData,e=d.replace(/<[\/]{0,1}sourcefields>/g,"",d);e=e.replace(/<\?xml[^\/]+\?>/g,"",e);var g=f('<div class="fc-green-id-summary"><%this.summary%></div><div class="fc-green-id"> <div class="options">   <div class="child-container with-submit">     <div class="close"></div>     <div class="source">       <h3>'+c.label+'</h3>       <div class="fields">'+e+'</div>     </div>   </div>   <div class="source-submit">     <div class="submit" data-source="'+c.key+'"><%this.lang.submit%></div>     <div class="verifying">       <div class="container fc-green-init-css">         <span class="spinner"></span>         <span><%this.lang.verifying%></span>       </div>     </div>   </div>   <div class="status-bar"></div> </div></div>',{lang:{submit:j.lang("verify","Verify"),verifying:j.lang("verifying","Verifying")},summary:j.greenIdSummary()});"function"==typeof GreenId.Overrides.Source[b.sourceId]&&(g=GreenId.Overrides.Source[b.sourceId](g)),j.render(g)})}),this.events.subscribe(this.events.const.DISPLAY_CHILD_SOURCE,function(a){var b=_.filter(j.options.sources.active,function(b){return b.belongsTo===a.key}),c="";_.each(b,function(a){("string"!=typeof a.source||j.userHasSource(a.source)&&!j.sourceIsLocked(a))&&(c+=f('<li class="fc-child-source" data-source="'+a.key+'" data-status="<%this.status%>"> <label>'+a.label+"</label></li>",{status:j.getSourceStatus(a)}))});var d=f('<div class="fc-green-id-summary"><%this.summary%></div><div class="fc-green-id">  <div class="child-sources options secondary">   <div class="child-container">     <div class="close"></div>     <div class="header">       <h3>'+a.label+"</h3>       <h5>"+a.desc+'</h5>     </div>     <div class="child-options">       <ul>'+c+'</ul>       <div class="fc-clear"></div>     </div>    </div>  </div></div>',{summary:j.greenIdSummary()});j.render(d)}),this.events.subscribe(this.events.const.SOURCE_SUBMIT,function(b){var c=b.dom,d=c.find(".required"),e=0;d.length>0&&d.each(function(){var b=a(this),c=b.parent(),d=fc.getFieldValue(b);b.is('input[type="checkbox"]')&&b.is(":checked")&&(d="on"),_.isString(d)&&0!==d.length?c.removeClass("fc-error"):(c.addClass("fc-error"),++e)}),e?j.events.publish(j.events.const.VERIFICATION_ERROR,{error:j.lang("requiredFieldsError","Please ensure all required form fields are correctly filled out prior to verification.")}):(j.events.publish(j.events.const.VERIFICATION_NO_ERROR),j.events.publish(j.events.const.VERIFICATION_DO,b))}),this.events.subscribe(this.events.const.VERIFICATION_ERROR,function(a){var b=j.getDomElements(),c=b.find(".status-bar"),d=f('<div class="error"> <span><%this.text.error%></div>',{text:{error:a.error}});c.html(d),j.events.publish(j.events.const.SOURCE_CHANGED)}),this.events.subscribe(this.events.const.VERIFICATION_SUCCESS,function(a){var b=j.getDomElements(),c=b.find(".status-bar"),d=f('<div class="success"> <span><%this.text.message%></div>',{text:{message:a.msg}});c.html(d)}),this.events.subscribe(this.events.const.VERIFICATION_NO_ERROR,function(a){j.getDomElements().find(".status-bar").html("")}),this.events.subscribe(this.events.const.VERIFICATION_DO,function(b){var c=b.dom,d=c.find(".source-submit"),f={};d.addClass("verifying"),c.find("input,select").each(function(){var b=a(this),c=b.attr("name"),d=fc.getFieldValue(b);b.is('input[type="checkbox"]')&&b.is(":checked")&&(d="on"),void 0===d&&(d=""),"string"==typeof c&&c.length>0&&(f[c]=d)});var g={fieldId:j.fieldId,verificationUserId:j.userId(),data:f};fc.api("greenid/gateway-v2/verify?source="+b.source,g,"POST",function(a){if(!1===a.success&&"string"==typeof a.message&&a.message.length>0)return a.message.indexOf("locked out of")>=0?void j.updateRemotely(function(a){switch(d.removeClass("verifying"),j.getApplicationStatus()){case GREENID.STATE.REJECTED:return void j.events.publish(j.events.const.FATAL_ERROR,{msg:j.lang("sorryCouldNotVerify","We're sorry, but we could not verify your identity.")})}j.events.publish(j.events.const.RENDER_PENDING,{error:j.lang("lockedOutTooManyAttempts","You've been locked out of the selected data source due to too many failed attempts. Please select a different method.")})}):(d.removeClass("verifying"),void j.events.publish(j.events.const.VERIFICATION_ERROR,{error:a.message}));if(!0===a.success){var c=a.response.return.checkResult;return void(e(c)?j.events.publish(j.events.const.SOURCE_VERIFIED,b):(d.removeClass("verifying"),j.events.publish(j.events.const.VERIFICATION_ERROR,{error:j.lang("verificationFailed","We're sorry, but electronic identification failed, please try again")})))}d.removeClass("verifying"),j.events.publish(j.events.const.VERIFICATION_ERROR,{error:j.lang("unexpectedError","An unexpected error occurred when verifying the data source.")})})}),this.events.subscribe(this.events.const.VERIFICATION_SKIPPED,function(){var a=j.getDomElements(),b=(a.find(".status-bar"),f('<div class="fc-green-id fc-ready"> <div class="skipped">   <%this.message%>   <div class="fc-clear"></div> </div></div>',{message:j.lang("skippedVerification","You have skipped electronic verification")}));j.render(b)}),this.events.subscribe(this.events.const.FETCH_ERROR,function(){j.fatalError=!0,j.events.publish(j.events.const.FATAL_ERROR,{msg:j.lang("fetchError","An unknown error occurred initialising electronic verification. You may be asked additional questions later on to verify your identity.")})}),this.events.subscribe(this.events.const.SOURCE_VERIFIED,function(a){fc.api("greenid/gateway-v2/fetch",{fieldId:j.fieldId},"POST",function(a){"boolean"!=typeof a.success||a.success?"object"==typeof a.data&&(a.data.initialised&&fc.setVirtualValue(j.fieldId,a.data.result,fc.fields,!1,!1),j.getApplicationStatus()===GREENID.STATE.VERIFIED?j.events.publish(j.events.const.DISPLAY_SUCCESS,{msg:j.lang("identityVerified","Your identity has successfully been verified.")}):j.init(!1)):j.events.publish(j.events.const.FETCH_ERROR)}),j.events.publish(j.events.const.SOURCE_CHANGED)}),this.events.subscribe(this.events.const.DISPLAY_SUCCESS,function(a){var b=f('<div class="fc-green-id large-success"> <div class="close"></div> <div><%this.msg%></div></div>',{msg:a.msg});j.render(b)}),this.events.subscribe(this.events.const.GET_EXTRA_DATA,function(a){var b=j.options.sources.extraData[0];j.events.publish(j.events.const.SHOW_EXTRA_DATA_SOURCE,b)}),this.events.subscribe(this.events.const.SHOW_EXTRA_DATA_SOURCE,function(a){var b="";_.each(a.preAgree.buttons,function(c){b+=f('<a href="#" data-method="<%this.method%>" data-for="<%this.source%>" class="btn"><%this.text%></a>',{method:c.method,text:c.text,source:a.key})});var c=f('<div class="fc-green-id extra-data-source"> <div class="options">   <div class="child-container with-submit">     <div class="pre-verification">       <h4><%this.title%></h4>       <div class="desc"><%this.desc%></div>     </div>   </div>   <div class="status-bar"></div>   <div class="source-submit">     <div class="links"><%this.buttons%></div>   </div> </div></div>',{title:fc.tokenise(a.preAgree.label),desc:fc.tokenise(a.preAgree.msg||""),buttons:b,source:a.key});j.render(c)}),this.combinations=function(a,b){var c,d,e,f,g;if(b>a.length||b<=0)return[];if(b==a.length)return[a];if(1==b){for(e=[],c=0;c<a.length;c++)e.push([a[c]]);return e}for(e=[],c=0;c<a.length-b+1;c++)for(f=a.slice(c,c+1),g=this.combinations(a.slice(c+1),b-1),d=0;d<g.length;d++)e.push(f.concat(g[d]));return e},this.updateRemotely=function(a,b){"boolean"!=typeof b&&(b=!0),fc.api("greenid/gateway-v2/fetch",{fieldId:j.fieldId},"POST",function(c){"boolean"!=typeof c.success||c.success?"object"==typeof c.data&&(b&&c.data.initialised&&fc.setVirtualValue(j.fieldId,c.data.result,fc.fields,!1,!1),"function"==typeof a?a(c.data):"string"==typeof a&&j.events.publish(event,c.data)):j.events.publish(j.events.const.FETCH_ERROR)})},this.triggerValidationError=function(){j.events.publish(j.events.const.RENDER_PENDING,{error:j.lang("mustPassValidation","You must pass electronic verification before continuing.")})},this.canStillVerify=function(){for(var a=_.keyBy(_.filter(j.options.sources.active,function(a){var b=j.getSourceStatus(a);return!0===a.primary&&("string"!=typeof a.source||j.userHasSource(a.source))&&"available"===b}),"key"),b=_.keyBy(_.filter(j.getUserVerificationSources(),function(a){return"boolean"==typeof a.passed&&!a.passed&&"string"==typeof a.state&&["EMPTY","IN_PROGRESS"].indexOf(a.state)>=0}),"name"),c=_.filter(j.options.sources.active,function(c){var d=c.key;return"string"==typeof c.belongsTo&&(d=c.belongsTo),"object"==typeof b[c.source]&&"object"==typeof a[d]}),d=[],e=1,f=c.length;e<f;e++)d=_.concat(d,j.combinations(c,e));var g=_.filter(d,function(a){var b={};return _.every(a,function(a){return"string"!=typeof a.belongsTo||("boolean"!=typeof b[a.belongsTo]||!b[a.belongsTo])&&(b[a.belongsTo]=!0,!0)})}),h=j.getSourceRuleSetWeightings();j.getRuleSetOutstandingMatrix();return _.some(g,function(a){return _.every(a,function(a){var b=h[a.source];return"object"==typeof b&&(_.each(b,function(a,c){"number"==typeof b[c]&&b[c]>0&&b[c]--}),0===_.sum(_.values(b)))})})},this.getRuleSets=function(){return{A:{total:3,address:2,dob:1,name:1,govt:0},B:{total:3,address:1,dob:1,name:0,govt:0},C:{total:3,address:1,dob:1,name:1,govt:1},D:{total:2,address:0,dob:0,name:1,govt:1},E:{total:2,address:1,dob:1,name:1,govt:0},F:{total:2,address:1,dob:1,name:1,govt:1},G:{total:1,address:0,dob:0,name:0,govt:0},H:{total:2,address:0,dob:0,name:0,govt:1},I:{total:2,address:2,dob:1,name:2,govt:0},J:["F","I"],K:["I","Z"],M:{total:1,address:1,dob:1,name:1,govt:0},Z:{total:2,address:1,dob:2,name:2,govt:0}}},this.getSourceRuleSetWeightings=function(){return{actrego:{total:1,address:0,dob:1,name:1,govt:1},actregodvs:{total:1,address:0,dob:1,name:1,govt:1},aec:{total:1,address:1,dob:0,name:1,govt:0},birthcertificatedvs:{total:1,address:0,dob:1,name:1,govt:1},changeofnamecertificatedvs:{total:1,address:0,dob:1,name:1,govt:1},citizenshipcertificatedvs:{total:1,address:0,dob:1,name:1,govt:1},dnb:{total:1,address:1,dob:1,name:1,govt:0},immicarddvs:{total:1,address:0,dob:0,name:1,govt:1},marriagecertificatedvs:{total:1,address:0,dob:1,name:1,govt:1},medibank:{total:1,address:0,dob:1,name:1,govt:0},medicaredvs:{total:1,address:0,dob:1,name:1,govt:1},nswrego:{total:1,address:0,dob:0,name:0,govt:1},nswregodvs:{total:1,address:0,dob:1,name:1,govt:1},ntregodvs:{total:1,address:0,dob:1,name:1,govt:1},passport:{total:1,address:0,dob:1,name:1,govt:1},passportdvs:{total:1,address:0,dob:1,name:1,govt:1},qldrego:{total:1,address:0,dob:1,name:1,govt:1},qldregodvs:{total:1,address:0,dob:1,name:1,govt:1},sarego:{total:1,address:0,dob:1,name:0,govt:1},saregodvs:{total:1,address:0,dob:1,name:1,govt:1},tasregodvs:{total:1,address:0,dob:1,name:1,govt:1},vicec:{total:1,address:1,dob:1,name:1,govt:0},vicrego:{total:1,address:1,dob:1,name:0,govt:1},vicregodvs:{total:1,address:0,dob:1,name:1,govt:1},visa:{total:1,address:0,dob:1,name:0,govt:1},visadvs:{total:1,address:0,dob:1,name:1,govt:1},waec:{total:1,address:1,dob:1,name:1,govt:0},warego:{total:1,address:0,dob:1,name:0,govt:1},waregodvs:{total:1,address:0,dob:1,name:1,govt:1},wp:{total:1,address:1,dob:0,name:0,govt:0}}},this.getRuleSetOutstandingMatrix=function(a){void 0===a&&(a=this.options.ruleset);var b=(this.getRuleSets(),this.getMatrix(a)),c=this.getSourceRuleSetWeightings(),d=_.filter(this.getUserVerificationSources(),function(a){return"boolean"==typeof a.passed&&a.passed});if("object"==typeof b){for(var e,f=0,g=d.length;f<g;f++)if(e=d[f],"object"==typeof c[e.name])for(var h in c[e.name])c[e.name].hasOwnProperty(h)&&c[e.name][h]>0&&"number"==typeof b[h]&&b[h]>0&&--b[h];return b}},this.getMatrix=function(a){var b=this.getRuleSets(),c=b[a];if(_.isObject(c)&&!_.isArray(c))return c;if(_.isArray(c)){var d={percentage:-1,ruleset:""};return _.forEach(c,function(a){if(void 0!==b[a]){var c=b[a],e=_.sum(_.values(c)),f=e-_.sum(_.values(j.getRuleSetOutstandingMatrix(a))),g=10*Math.floor(f/e*10);g>d.percentage&&(d={percentage:g,ruleset:a})}}),this.getMatrix(d.ruleset)}return{}},this.greenIdSummary=function(){var a=(this.getRuleSets(),this.getMatrix(this.options.ruleset)),b=_.sum(_.values(a)),c=this.getRuleSetOutstandingMatrix(),d=_.values(c),e=_.sum(d),g=b-e,h=10*Math.floor(g/b*10);return 0===h?"":f('<div class="summary"> <div class="percentage-bar">   <div class="bar" style="width: <%this.percentage%>%"><%this.percentage%>% <%this.completeText%></div> </div> <%this.debug%></div>',{completeText:j.lang("completeText","complete"),debug:"",percentage:h})},this.isSkipped=function(){var a=fc.getValue(j.fieldId);return void 0!==a.skipped&&[!0,"true"].indexOf(a.skipped)>=0},this.getUserVerificationSources=function(){var a=fc.getValue(j.fieldId);try{var b=a.result.return.sourceList.sources}catch(g){return[]}for(var c,d={},e=0,f=b.length;e<f;e++)c=b[e],d[c.name]=c;return d},this.getSourceStatus=function(a){var b="available";return j.sourceIsVerified(a)?b="verified":j.sourceIsLocked(a)&&(b="locked-out"),b},this.getApplicationStatus=function(){var a=fc.getValue(j.fieldId),b=a.result.return.verificationResult.outcome;GREENID.STATE.PENDING;switch(b){case"VERIFIED":case"VERIFIED_ADMIN":case"VERIFIED_WITH_CHANGES":case"PENDING":return GREENID.STATE.VERIFIED;case"LOCKED_OUT":return GREENID.STATE.REJECTED;case"IN_PROGRESS":default:return GREENID.STATE.PENDING}},this.userHasSource=function(a){return j.getUserVerificationSources().hasOwnProperty(a)},this.sourceIsVerified=function(a){var b=j.getUserVerificationSources();if(!1===a.source){return"object"==typeof _.find(j.options.sources.active,function(c){return"string"==typeof c.source&&c.belongsTo===a.key&&j.userHasSource(c.source)&&e(b[c.source])})}return j.userHasSource(a.source)&&e(b[a.source])},this.sourceIsLocked=function(a){var b=j.getUserVerificationSources();return!!j.userHasSource(a.source)&&"LOCKED_OUT"===b[a.source].state},this.hasExtraData=function(){return _.isObject(this.options)&&_.isObject(this.options.sources)&&_.isArray(this.options.sources.extraData)&&this.options.sources.extraData.length>0},this.loading=function(a){return f('<div class="fc-green-id-summary"><%this.summary%></div><div class="fc-green-id initialising"> <div class="init">   <div class="fc-green-init-css">     <div></div>   </div>   <%this.text.init%> </div></div>',{summary:j.greenIdSummary(),text:{init:a}})},this.lang=function(a,b){return"function"==typeof GreenId.Overrides.Lang[a]?GreenId.Overrides.Lang[a]():"string"==typeof GreenId.Overrides.Lang[a]?GreenId.Overrides.Lang[a]:b},this.begin=function(){return j.loading(j.lang("startingUp","Starting up identity verification"))},this.configureEventListeners=function(){var b=j.getDomElements();b.on("click",".options li",function(){var b=a(this),c=b.attr("data-source");"available"===b.attr("data-status")&&j.events.publish(j.events.const.OPTION_CLICKED,{source:c})}),b.on("click",".fc-green-id .close",function(){return j.events.publish(j.events.const.READY_FOR_RENDER),!1}),b.on("click",".fc-green-id .source-submit .submit",function(){var b=a(this),c=b.attr("data-source"),d=_.find(j.options.sources.active,function(a){return a.key==c});d.dom=b.parent().parent(),j.events.publish(j.events.const.SOURCE_SUBMIT,d)}),b.on("click",".fc-green-id.extra-data-source .source-submit .links a",function(){var b=a(this),c=b.attr("data-method"),d=b.attr("data-for"),e=b.attr("data-continue");if(_.isString(e)&&"true"===e)return void j.events.publish(j.events.const.READY_FOR_RENDER);var f=_.find(j.options.sources.extraData,function(a){return a.key==d});if(void 0===f)return!1;var g=_.find(f.preAgree.buttons,function(a){return a.method==c});return void 0!==g&&(j.extraData=_.isObject(g.extra)?g.extra:{},Object.keys(j.extraData).length>0&&(j.extraData.source=d),j.render(j.loading(j.lang("initialising","Initialising..."))),j.events.publish(j.events.const.FETCH_RESULT_NOT_INITIALISED,b.data),!1)}),b.on("click",".fc-link.verification-skip",function(){var a=fc.getValue(j.fieldId);return"object"==typeof a&&(a.skipped=!0),fc.setVirtualValue(j.fieldId,a,fc.fields,!1,!1),j.events.publish(j.events.const.VERIFICATION_SKIPPED),!1}),j.setupEventListeners=!0},this.init=function(a,b){if("undefined"!=typeof _){if("boolean"==typeof j.setupEventListeners&&j.setupEventListeners||j.configureEventListeners(),"string"==typeof b&&fcGreenID.initialised.indexOf(b)<0&&fcGreenID.initialised.push(b),"boolean"!=typeof a&&(a=!0),a)return void fc.api("greenid/gateway-v2/fetch",{fieldId:this.fieldId},"POST",function(a){"boolean"!=typeof a.success||a.success?"object"==typeof a.data&&"boolean"==typeof a.data.initialised&&(a.data.initialised?j.events.publish(j.events.const.FETCH_RESULT_INITIALISED,a.data):j.hasExtraData()?j.events.publish(j.events.const.GET_EXTRA_DATA,a.data):j.events.publish(j.events.const.FETCH_RESULT_NOT_INITIALISED,a.data)):j.events.publish(j.events.const.FETCH_ERROR)});j.events.publish(j.events.const.FETCH_RESULT_INITIALISED,{})}},this.getDomElements=function(){for(var a=[],b=0,c=j.fieldIds.length;b<c;b++)a.push('[fc-data-group="'+j.fieldIds[b]+'"]');return fc.domContainer.find(a.join(","))},this.render=function(a){var b=j.getDomElements();if(0!==b.length){b.hasClass("fc-error")&&b.removeClass("fc-error");var c=f('<div class="fc-fieldgroup"> <div class="fc-field-element-contrainer">   <%this.html%>   <div class="fc-success-box"><span></span></div>   <div class="fc-error-box"><span></span></div> </div> <div class="fc-error-text"></div> <div class="fc-empty"></div></div>',{html:a});b.html(c)}},fcGreenID.sessions[i]=this},initialised:[],fieldIds:[],getSession:function(a){var b=fc.getFieldDefinition(a),e=c(b,a),f=d(JSON.stringify(e)),g=fcGreenID.sessions[f];return g.fieldIds.indexOf(a)<0&&g.fieldIds.push(a),g},sessions:{},template:f}}(jQuery);!function(a){"use strict";a(fc.jQueryContainer).trigger(fc.jsEvents.onGreenIdLoaded),fc.domContainer.on(fc.jsEvents.onVisibilityChanged,function(){fc.initGreenIdDOMFields()})}(jQuery);