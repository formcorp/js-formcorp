var html,LOADED_EVENT="formcorpLoaded";if("undefined"==typeof window.jQuery){var baseUrl="",currentScript=document.getElementById("fc-js-include");if("object"==typeof currentScript){var src=currentScript.src,link=document.createElement("a");link.href=src,baseUrl=link.protocol+"//"+link.hostname+":"+link.port}var script=document.createElement("script");script.src=baseUrl+"/lib/jquery.min.js",script.id="fc-jquery-include",script.addEventListener("load",function(a){html=jQuery("html"),html.trigger(LOADED_EVENT)},!1);var bodyScripts=document.getElementsByTagName("script"),insert=bodyScripts[bodyScripts.length-1];insert.parentNode.insertBefore(script,insert)}else html=jQuery("html"),html.trigger(LOADED_EVENT);Date.now||(Date.now=function(){"use strict";return(new Date).getTime()}),String.prototype.isJson=function(){"use strict";try{return jQuery.parseJSON(this),!0}catch(a){}return!1},String.prototype.escapeRegExp=function(){"use strict";return this.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")},function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){"use strict";function b(a){return encodeURIComponent(a)}function c(a){return decodeURIComponent(a)}function d(a){return b("boolean"==typeof g.json&&g.json?JSON.stringify(a):String(a))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return a=decodeURIComponent(a.replace(h," ")),g.json?JSON.parse(a):a}catch(b){}}function f(b,c){var d=g.raw?b:e(b);return a.isFunction(c)?c(d):d}var g,h=/\+/g;g=a.cookie=function(e,h,i){var j,k,l,m,n,o,p,q,r;if(arguments.length>1&&!a.isFunction(h))return i=a.extend({},g.defaults,i),"number"==typeof i.expires&&(j=i.expires,i.expires=new Date,k=i.expires,k.setTime(+k+864e5*j)),document.cookie=[b(e),"=",d(h),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join(""),document.cookie;for(l=e?void 0:{},m=document.cookie?document.cookie.split("; "):[],n=0,o=m.length;n<o;n+=1){if(p=m[n].split("="),q=c(p.shift()),r=p.join("="),e&&e===q){l=f(r,h);break}e||(r=f(r),void 0!==r&&(l[q]=r))}return l},g.defaults={},a.removeCookie=function(b,c){return void 0!==a.cookie(b)&&(a.cookie(b,"",a.extend({},c,{expires:-1})),!a.cookie(b))}});var formcorp=function(){var self=this;self.forms={};var getForms=function(){return self.forms},getForm=function(a){if("string"==typeof a&&"object"==typeof self.forms[a])return self.forms[a]},destroyForm=function(a){return"string"==typeof a&&"object"==typeof self.forms[a]&&(self.forms[a]=null,delete self.forms[a],!0)},create=function(id,$){"undefined"==typeof $&&($=jQuery),"string"==typeof id&&0!==id.length||(id="default");var fc=function($){"use strict";function getBase64(a,b,c){var d=a.size,e=16777216,f=0,g=null,h=function(a){return null!==a.target.error?void log("Read error: "+a.target.error):(f+=a.target.result.length,c(a.target.result,b),f>=d?void log("Done reading file"):void 0)};(g=function(a,b,c){var d=new FileReader,e=c.slice(a,b+a);d.onload=h,d.readAsDataURL(e)})(f,e,a)}var scriptUrl=document.getElementById("fc-js-include").getAttribute("src"),isDev=function(){return scriptUrl.indexOf("192.168.")>-1||"undefined"!=typeof fc&&"boolean"==typeof fc.dev&&fc.dev},baseUrl=function(a){if(isDev()){void 0===a&&(a=!0);var b=a?/\d+\.\d+\.\d+\.\d+[\:]{1}\d+/:/\d+\.\d+\.\d+\.\d+/,c=scriptUrl.match(b);if(c&&c.length>0)return c[0]}},apiUrl=function(){return isDev()?"string"==typeof fc.apiUrl?fc.apiUrl:"//"+baseUrl(!1)+":9001/":"//api.formcorp.com.au/"},isMinified=function(){return scriptUrl.indexOf(".min.js")>-1},cdnUrl=function(){var a=scriptUrl;return isDev()?"string"==typeof fc.cdnUrl?fc.cdnUrl:"//"+baseUrl(!1)+":9004/":(a=isMinified()?a.replace("formcorp.min.js",""):a.replace("formcorp.js",""),a=a.replace("https://","//").replace("http://","//"))},analyticsUrl=function(){return cdnUrl()+(isMinified()?"realtime.min.js":"realtime.js")},parserUrl=function(){return cdnUrl()+"lib/"+(isMinified()?"parser.min.js":"parser.js")},log=function(a){fc.config.debug},htmlEncode=function(a){return document.createElement("a").appendChild(document.createTextNode(a)).parentNode.innerHTML},loadCssFile=function(a,b,c,d){var e,f;void 0===b&&(b="all"),e=document.getElementsByTagName("head")[0],f=document.createElement("link"),"string"==typeof c&&c.length>0&&(f.id=c),f.rel="stylesheet",f.href=htmlEncode(a),f.media=b,e.appendChild(f),"function"==typeof d&&a.addEventListener("load",d)},loadJsFile=function(a,b){var c=document.createElement("script"),d=document.getElementsByTagName("script"),e=d[d.length-1];c.type="text/javascript",c.src=htmlEncode(a),c.async=1,"function"==typeof b&&c.addEventListener("load",b),e.parentNode.insertBefore(c,e)},addLib=function(a){"undefined"==typeof fc.libs2Load&&(fc.libs2Load=[]),"string"==typeof a&&a.length>0&&fc.libs2Load.indexOf(a)<0&&fc.libs2Load.push(a)},checkAllLibsLoaded=function(a){"undefined"==typeof a&&(a=fc.schema),"undefined"==typeof a&&(a=fc.schemaData);for(var b,c=$.extend([],fc.libs2Load),d=/(?:\.([^.]+))?$/,e=0;e<c.length;e+=1){var f=d.exec(c[e]);"undefined"!=typeof f[1]&&(b=f[1].toLowerCase(),"js"!==b&&delete c[e])}if(c=$.extend([],c),fc.loadedLibs.length>=c.length){if(fc.libsLoaded.length>0)for(var e=0;e<fc.libsLoaded.length;e+=1){var g=fc.libsLoaded[e];if($.isArray(fc.libraryCallbacks[g]))for(var h=0;h<fc.libraryCallbacks[g].length;h+=1){var i=fc.libraryCallbacks[g][h];"function"==typeof i&&i()}}return fc.config.autoDiscoverLibs&&sessionRequiresVerification(a)&&verifySession(),!0}return!1},registerLibLoaded=function(a){fc.loadedLibs.indexOf(a)&&fc.loadedLibs.push(a),checkAllLibsLoaded()},libHasLoaded=function(a){return fc.loadedLibs.indexOf(a)>=0},loadUrlLib=function(a){if(!libHasLoaded(a)){var b=a.split(".").slice(-1).pop().toLowerCase();switch(b){case"css":loadCssFile(cdnUrl()+a);break;default:loadJsFile(cdnUrl()+a,function(){registerLibLoaded(a)})}}},loadMaterialDatepicker=function(){"undefined"==typeof fc.materialDatepickers&&(fc.materialDatepickers={}),"boolean"==typeof fc.loadedMaterialDatepicker&&fc.loadedMaterialDatepicker||(loadCssFile("//fonts.googleapis.com/icon?family=Material+Icons"),loadCssFile("//fonts.googleapis.com/css?family=Roboto"),loadCssFile("//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"),loadCssFile(cdnUrl()+"lib/material_datetime/datepicker.css"),loadJsFile(cdnUrl()+"lib/material_datetime/"+(isMinified()?"datepicker.standalone.min.js":"datepicker.standalone.js"),function(){fc.loadedMaterialDatepicker=!0,registerLibLoaded(fc.libs.MATERIAL_DATEPICKER)})),fc.domContainer.on("click",".fc-field-date i.fa",function(a){var b=$(this).parent().find(".fc-fieldinput"),c=b.attr("formcorp-data-id");b.css("marginRight"),parseInt(b.width())-fc.config.datePickerIconOffset;return"undefined"!=typeof fc.materialDatepickers[c]&&fc.materialDatepickers[c].open(),!1})},loadIDMatrix=function(){"boolean"==typeof fc.loadedIDMatrix&&fc.loadedIDMatrix||(loadJsFile(cdnUrl()+"lib/global/lodash.core.min.js"),loadJsFile(cdnUrl()+"lib/global/twig.min.js"),loadJsFile(cdnUrl()+"lib/id-matrix/js/default.render.js"),loadCssFile(cdnUrl()+"lib/id-matrix/dist/main.css"),loadJsFile(cdnUrl()+"lib/id-matrix/js/"+(isMinified()?"idmatrix.min.js":"idmatrix.js"),function(){fc.loadedIDMatrix=!0,registerLibLoaded(fc.libs.IDMATRIX)}))},loadLib=function(a){if(!libHasLoaded(a))switch(a){case fc.libs.MATERIAL_DATEPICKER:loadMaterialDatepicker();break;case fc.libs.IDMATRIX:loadIDMatrix();break;default:loadUrlLib(a)}},loadLibs=function(){for(var a,b=0;b<fc.libs2Load.length;b+=1)a=fc.libs2Load[b],loadLib(a)},getId=function(a){return"object"==typeof a&&void 0!==a._id&&void 0!==a._id.$id?a._id.$id:""},getDataId=function(a){var b,c,d=[];if(a.indexOf(fc.constants.prefixSeparator)>=0){for(b=a.split(fc.constants.prefixSeparator),c=0;c<b.length;c+=1)d.indexOf(b[c])===-1&&d.push(b[c]);d.length>0&&(a=d.join(fc.constants.prefixSeparator))}return a},getConfig=function(a,b,c,d){var e;if(void 0===c&&(c=""),void 0===d&&(d=!1),void 0!==a&&"object"==typeof a.config&&void 0!==a.config[b]){if(d&&"string"==typeof a.config[b]&&["[","{"].indexOf(a.config[b].substring(0,1))>-1)try{e=$.parseJSON(a.config[b]),a.config[b]=e}catch(f){}return a.config[b]}return c},getSessionId=function(){return this.sessionId},getValue=function(a,b){log("getValue"),log(a),log(b),void 0===b&&(b="");var c,d,e;a=getDataId(a),c=fc.fieldSchema[a];for(var f=a.split(fc.constants.prefixSeparator),g=fc.fields,h=0;h<f.length;h++){if(d=g[f[h]],"undefined"==typeof d)return b;g=d}return void 0!==c&&(e=getConfig(c,"functionReference",""),e.length>0&&"function"==typeof window[e])?window[e](a):void 0!==d?d:b},getShortLabel=function(a){return getConfig(a,"shortLabel","").length>0?getConfig(a,"shortLabel"):getConfig(a,"label")},getCreditCardType=function(a){return/^5[1-5]/.test(a)?fc.cardTypes.mastercard:/^4/.test(a)?fc.cardTypes.visa:/^3[47]/.test(a)?fc.cardTypes.amex:""},api=function(a,b,c,d,e,f){void 0!==c&&"string"==typeof c&&["GET","POST","PUT"].indexOf(c.toUpperCase())!==-1||(c="GET"),c=c.toUpperCase(),void 0===b&&(b={}),void 0===b.sessionId&&(b.sessionId=fc.sessionId),void 0===b.form_id&&(b.form_id=fc.formId),void 0===b.branch&&"string"==typeof fc.branch&&(b.branch=fc.branch),void 0!==fc.channel&&"string"==typeof fc.channel&&fc.channel.length>0&&(b.channel=fc.channel),$.ajax({type:c,url:apiUrl()+a,data:b,beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+fc.publicKey)},success:function(a){if("function"==typeof d){if("string"==typeof a)try{a=$.parseJSON(a)}catch(b){}d(a)}},error:function(a){"function"==typeof e&&e(a)},xhr:f})},isMobile=function(){return parseInt($(window).width(),10)<fc.config.minSizeForMobile},processed=function(a,b){return void 0!==b&&"boolean"==typeof b||(b=!1),"boolean"==typeof fc.processedActions[a]?fc.processedActions[a]:b},getFieldTags=function(a,b,c){if(void 0===a)return{};void 0===b&&(b=""),void 0===c&&(c="");var d,e,f,g=getConfig(a,"tag",!1),h={},i=c;if(g&&(i+=getId(a),h[i]=b+g,d=getConfig(a,"grouplet",!1),d&&d.field&&$.isArray(d.field)&&d.field.length>0))for(f=0;f<d.field.length;f+=1)e=getFieldTags(d.field[f],h[i]+fc.constants.tagSeparator,i+fc.constants.prefixSeparator),Object.keys(e).length>0&&$.extend(h,e);return h},getFieldsSchema=function(a){if("object"!=typeof a)return{};var b,c,d={};for(b=0;b<a.length;b+=1)c=a[b],d[getId(c)]=c;return d},getAllFieldTags=function(a){void 0!==a&&"boolean"==typeof a||(a=!1);var b,c,d,e,f={};for(b in fc.fieldSchema)if(fc.fieldSchema.hasOwnProperty(b)&&(d=getFieldTags(fc.fieldSchema[b]),e={},Object.keys(d).length>0)){for(c in d)d.hasOwnProperty(c)&&(a?e[d[c]]=c:d.hasOwnProperty(c)&&void 0!==fc.fields[c]?e[c]=d[c]:e[c]=d[c]);$.extend(f,e)}return f},getFieldTagValues=function(){var a,b,c,d,e={};for(a in fc.fieldSchema)if(fc.fieldSchema.hasOwnProperty(a)&&(c=getFieldTags(fc.fieldSchema[a]),d={},Object.keys(c).length>0)){for(b in c)c.hasOwnProperty(b)&&void 0!==fc.fields[b]&&(d[c[b]]=fc.fields[b]);$.extend(e,d)}return e},getFieldValue=function(a){var b,c,d,e,f=[];if(a&&0!==a.length){if(a.is("input")||a.is("textarea")){if("radio"===a.attr("type"))return $("input[name="+$(a).attr("name")+"]:checked").length>0?$("input[name="+$(a).attr("name")+"]:checked").val():"";if("checkbox"===a.attr("type"))return b=$("input[formcorp-data-id="+$(a).attr("formcorp-data-id")+"]:checked"),0===b.length?"":(f=[],b.each(function(){f.push($(this).val())}),JSON.stringify(f));if(c=$(a).attr("formcorp-data-id"),"undefined"==typeof c)return a.val();if("undefined"!=typeof fc.fieldSchema[c]){if("undefined"!=typeof fc.fieldSchema[c]&&"matrix"===fc.fieldSchema[c].type)return parseMatrixField(a,!0);if("undefined"!=typeof fc.fieldSchema[c]&&"fileUpload"===fc.fieldSchema[c].type)return $("#"+c).val()}if(void 0!==fc.fieldSchema[c])return a.val()}if(a.is("select"))return $(a).val();if(a.is("button")){c=a.attr("formcorp-data-id").replace("_rootSelection","");var g=fc.fieldSchema[c];if("object"==typeof g&&"greenIdVerification"===g.type)return getValue(c);if(c)return getConfig(fc.fieldSchema[c],"allowMultiple",!1)?(d=[],$('.fc-button.checked[formcorp-data-id="'+c+'"]').each(function(){d.push(decodeURIComponent($(this).attr("data-field-value")))}),d):(e=$('.fc-button.checked[formcorp-data-id="'+c+'"]').attr("data-field-value"),e?decodeURIComponent(e):$('.fc-button.checked[formcorp-data-id="'+c+'"]').text())}var h=a.attr("data-reference");return"string"==typeof h&&h.length>0?h:(c=a.attr("fc-data-group"),(void 0!==fc.renderedSignatures&&void 0!==fc.renderedSignatures[c]||a.hasClass(fc.config.signatureClass))&&(void 0===c&&(c=$(a).attr("formcorp-data-id")),void 0!==fc.renderedSignatures&&void 0!==fc.renderedSignatures[c])?fc.renderedSignatures[c].getSignatureString():"")}},fieldIsEmpty=function(a){var b=getFieldValue(a);if(void 0!==b)return!b||0===b.length},getCustomErrors=function(a,b){var c,d,e,f,g,h,i,j,k,l,m=[];if(!getConfig(a,"required",!1)&&0===b.length)return[];if("string"==typeof a.config.validators&&["[","{"].indexOf(a.config.validators.substring(0,1))>-1)try{k=$.parseJSON(a.config.validators),a.config.validators=k}catch(n){}if("object"==typeof a.config.validators&&a.config.validators.length>0)for(c=0;c<a.config.validators.length;c+=1){e=a.config.validators[c],i=fc.toCamelCase(e.type),f=window;try{if(i===fc.constants.functionCallbackType&&$.isArray(e.params)&&e.params.length>0&&e.params[0].length>0){var o=e.params[0].split(".");if(o.length>0)for(var p,q=0;q<o.length;q+=1)p=o[q],"undefined"!=typeof f[p]&&(f=f[p]);"function"!=typeof f?log("Custom function '"+e.params[0]+"' callback not defined."):l=f(b)}else{for(j="formcorp.validators."+i,g=j.split("."),d=0;d<g.length;d+=1)f=f[g[d]];l=f(e.params,b)}"function"!=typeof f||l||(h="string"==typeof e.error&&e.error.length>0?e.error:fc.lang.defaultCustomValidationError,m.push(h))}catch(n){log("Exception raised while attempting custom validator.")}}return m},fieldErrors=function(a){var b,c,d,e,f,g,h,i,j,k=$('.fc-field[fc-data-group="'+a+'"]'),l=a,m=[];if(0===k.length)return[];if(k.hasClass("fc-hide"))return[];if(b=k.parent(),c=fc.fieldSchema[l],void 0!==fc.fields[l]&&(i=fc.fields[l]),j=getFieldValue(k.find(".fc-fieldinput")),d=void 0!==j&&""!==j?j:void 0!==i&&""!==i?i:"",void 0!==d&&null!==d||(d=""),b.hasClass("fc-hide"))return[];h=k;do if(e=h.attr("fc-belongs-to"),f=$('[fc-data-group="'+e+'"],[formcorp-data-id="'+e+'"]'),g=f.attr("fc-data-group"),void 0===g&&(g=f.attr("formcorp-data-id")),void 0!==g){if(f.hasClass("fc-hide"))return[];h=$('[fc-data-group="'+e+'"],[formcorp-data-id="'+e+'"]')}while(void 0!==g);if("date"===c.type){var n=/^(\d{4}((-\d{2}){2}|(\/\d{2}){2})|((\d{2}-){2}|(\d{2}\/){2})\d{4})(\s+\d{1,2}:(\d{2}))?$/;if(!n.test(j))return m.push(fc.lang.dateCorrectFormat),m}if("abnVerification"===c.type){if(fc.validAbns.indexOf(d)<0)return m.push(fc.lang.validAbnRequired),m}else{if("matrix"===c.type)return validateMatrixField(c);if("fileUpload"===c.type)return validateFileUpload(c,d).concat(evaluateRequiredLogic(c,JSON.parse(d)||""));m=evaluateRequiredLogic(c,d)}return fc.util.isEmpty(m)&&(m=getCustomErrors(c,d)),m},logEvent=function(a,b){void 0!==a&&fc.analytics&&fc.analytics.logEvent&&fc.analytics.logEvent(a,b)},showFieldError=function(a,b){var c,d=fc.domContainer.find('div[fc-data-group="'+a+'"]'),e="";if(fc.domContainer.trigger(fc.jsEvents.onFieldError,[a,b]),d.addClass("fc-error"),fc.config.inlineValidation===!0){for(c=0;c<b.length;c+=1)e+=b[c]+"<br>";d.find(".fc-error-text span").html(e)}},showFieldSuccess=function(a){var b=fc.domContainer.find('div[fc-data-group="'+a+'"]');fc.domContainer.trigger(fc.jsEvents.onFieldSuccess,[a]),b.addClass("fc-field-success")},getGroupletFields=function(a){if("grouplet"===a.type){var b,c,d,e=getConfig(a,"grouplet",{field:[]}),f=[];if(d=a._id.$id,"object"==typeof e&&"object"==typeof e.field&&$.isArray(e.field))for(b=0;b<e.field.length;b+=1)c=e.field[b],"grouplet"===c.type?f.concat(getGroupletFields(c)):f.push(d+fc.constants.prefixSeparator+c._id.$id);return f}return[]},readOnly=function(){fc.domContainer.find(":input").attr("readonly","readonly")},getFieldPageId=function(a,b){var c,d,e,f,g,h,i,j,k;if("boolean"!=typeof b&&(b=!1),void 0===fc.fieldPages&&(fc.fieldPages={}),void 0!==fc.fieldPages[a]&&"string"==typeof fc.fieldPages[a])return fc.fieldPages[a];if(b)return j=fc.domContainer.find('.fc-field[fc-data-group="'+a+'"]'),0===j.length?"":(i=fc.domContainer.find(".fc-section-"+j.attr("fc-belongs-to")),0===i.length?"":i.parent().hasClass("fc-page")?i.parent().attr("data-page-id"):"");for(c=0;c<fc.schema.stage.length;c+=1)for(d=0;d<fc.schema.stage[c].page.length;d+=1)for(h=fc.schema.stage[c].page[d],e=0;e<h.section.length;e+=1)if("object"==typeof h.section[e].field)for(i=h.section[e],f=0;f<i.field.length;f+=1)if(j=i.field[f],fc.fieldPages[getId(j)]=getId(h),"grouplet"===j.type)for(k=getGroupletFields(j),g=0;g<k.length;g+=1)fc.fieldPages[k[g]]=getId(h);return void 0!==fc.fieldPages[a]&&"string"==typeof fc.fieldPages[a]?fc.fieldPages[a]:""},setEntityTokens=function(a){"object"!=typeof a||$.isArray(a)||(fc.entityTokens=a)},setEntityToken=function(a,b){"undefined"==typeof fc.entityTokens&&(fc.entityTokens={}),fc.entityTokens[a]=b},getFieldByTag=function(a){var b,c;for(b in fc.fieldSchema)if(fc.fieldSchema.hasOwnProperty(b)&&(c=getConfig(fc.fieldSchema[b],"tag",""),c.length>0&&c===a))return fc.fieldSchema[b]},setMode=function(a){"undefined"!=typeof fc.domContainer&&fc.domContainer.find(".render").attr("data-mode",a),fc.mode=a},getMode=function(){return"string"==typeof fc.mode?fc.mode:fc.modes.DEFAULT},isDevelopmentBranch=function(){return fc.branch&&"string"==typeof fc.branch&&fc.branch.length>0&&fc.developmentBranches.indexOf(fc.branch)>-1},removeFieldError=function(a){fc.domContainer.find('div[fc-data-group="'+a+'"]').removeClass("fc-error");var b=fc.domContainer.find('div[fc-data-group="'+a+'"]');b.find(".fc-error-text span").html("")},removeFieldSuccess=function(a){fc.domContainer.find('div[fc-data-group="'+a+'"]').removeClass("fc-field-success")},enhancedSecurityError=function(a){return"object"==typeof a&&"boolean"==typeof a.success&&!a.success&&a.category===fc.constants.enhancedSecurity},showSecurityError=function(a){var b=$("<div></div>").addClass("fc-security-error"),c=$("<span></span>").text(a.message);b.prepend(c);var d=fc.domContainer.find(".fc-page:last .fc-pagination");d.length>0&&(d.find(".fc-security-error").remove(),d.prepend(b))},godFields=["richTextArea"],luhnCheck=function(a){var b,c,d=0;for(b=0;b<a.length;b+=1)c=parseInt(a.substr(b,1),10),b%2===0&&(c*=2,c>9&&(c=1+c%10)),d+=c;return d%10===0},validCreditCardField=function(a,b,c){var d,e,f,g,h,i,j=void 0===fc.fields[a]?"":fc.fields[a],k=[];return j.length>0?[]:(d=fc.domContainer.find('[fc-data-group="'+a+'"]'),0===d.length?(log("[FC] Unable to locate CC form"),[]):(e=d.find(".fc-cc-name input"),f=d.find(".fc-cc-number input"),g=parseInt(d.find(".fc-cc-expirydate option:selected").val(),0),h=parseInt(d.find(".fc-cc-expirydate-year option:selected").val(),0),i=d.find(".fc-cc-ccv input"),0===e.val().length&&k.push(fc.lang.creditCardMissingName),f=f.val().replace(/[^0-9]/g,"",f),0===f.length?k.push(fc.lang.creditCardMissingNumber):(f.length<fc.config.creditCardNumberLimits[0]||f.length>fc.config.creditCardNumberLimits[1]||!luhnCheck(f))&&k.push(fc.lang.invalidCardFormat),void 0===g||0===g.length||void 0===h||0===h.length||isNaN(g)||isNaN(h)?k.push(fc.lang.creditCardMissingExpiryDate):g<1||g>12?k.push(fc.lang.creditCardMissingExpiryDate):h<(new Date).getFullYear()||h>(new Date).getFullYear()+30?k.push(fc.lang.creditCardMissingExpiryDate):h===(new Date).getFullYear()&&g<(new Date).getMonth()+1&&k.push(fc.lang.creditCardExpired),i=i.val().replace(/[^0-9]/g,"",i),(0===i.length||i.length>fc.config.maxCreditCardCodeLength)&&k.push(fc.lang.creditCardMissingSecurityCode),k))},inModal=function(a){var b,c,d=a.parent().parent().parent().parent();return 0!==d.length&&(b=d.attr("fc-data-group"),!(void 0===b||null===b||(c=fc.fieldSchema[b],!getConfig(c,"repeatable",!1)))&&fc.constants.repeatableInModal.indexOf(parseInt(getConfig(c,"repeatableStyle",1)))>-1)},getFieldErrors=function(a,b,c){var d,e=[],f=fc.fieldSchema[a],g=!1;if("string"!=typeof c&&(c=""),void 0===f)return[];if("creditCard"===f.type)0!==b.length&&void 0!=b.success&&1==b.success||e.push(fc.lang.paymentRequired),g=!0;else if(["emailVerification","smsVerification"].indexOf(f.type)>-1)void 0!==fc.fields[getId(f)]&&validVerificationResult(fc.fields[getId(f)])?g=!0:e.push(fc.lang.fieldMustBeVerified);else if("signature"===f.type)void 0===fc.renderedSignatures||void 0===fc.renderedSignatures[a]?e.push("Field has not been initialised"):fc.renderedSignatures[a].validateForm()===!1?e.push(f.config.emptyErrorMessage||fc.lang.emptyFieldError):setVirtualValue(a,fc.renderedSignatures[a].getSignatureString()),g=!0;else if("fileUpload"===f.type){if("undefined"!=typeof b&&0!==b.length||e.push(f.config.emptyErrorMessage||fc.lang.emptyFieldError),"string"==typeof b)try{var h=JSON.parse(b);0==h.length&&e.push(f.config.emptyErrorMessage||fc.lang.emptyFieldError)}catch(i){e.push(f.config.emptyErrorMessage||fc.lang.emptyFieldError)}}else{if("grouplet"===f.type)return;if("greenIdVerification"===f.type){b=getValue(a);var j=fc.greenID.session(a);if("undefined"==typeof j)e.push("GreenID has not been initialised for field");else{var k=j.getApplicationStatus();k===GREENID.STATE.PENDING?e.push("You must verify your identity."):k===GREENID.STATE.VERIFIED||k===GREENID.STATE.REJECTED?g=!0:e.push("Please confirm your identity is verified.")}}else if("date"===f.type);else if("idmatrix"===f.type){if("undefined"==typeof formcorp.const.IDMatrix)return;if(b=getValue(a),"undefined"==typeof b||"string"!=typeof b.status)e.push("IDMatrix hasn't yet been initialised.");else switch(b.status){case formcorp.const.IDMatrix.State.Consent:case formcorp.const.IDMatrix.State.Ready:case formcorp.const.IDMatrix.State.Verification:e.push("You must go through electronic verification.")}}}return g||0!==e.length||(void 0!==f.config&&"boolean"==typeof f.config.repeatable&&f.config.repeatable?(d=$(this).attr("data-required"),"true"!==d||"object"==typeof b&&0!==b.length||e.push(f.config.emptyErrorMessage||fc.lang.emptyFieldError)):e=fieldErrors(a)),e=e.filter(function(a,b,c){return b==c.indexOf(a)})},validVerificationResult=function(a){return"string"==typeof a&&a.length>=48},validForm=function(a,b,c,d){if(fc.config.administrativeEdit)return!0;"boolean"!=typeof c&&(c=!1);var e={};void 0===a&&(a=fc.jQueryContainer),"boolean"!=typeof b&&(b=!0);var f,g="string"==typeof a?$(a):a;return f=g.find(".fc-field[fc-data-group]").length>0?g.find(".fc-field[fc-data-group]"):g.filter(".fc-field[fc-data-group]"),f.each(function(){var c,d,f,g=$(this),h=g.attr("fc-data-group"),i=g.parent(),j=fc.fieldSchema[h],k=void 0===fc.fields[h]?"":fc.fields[h],l=[],m="";if(!(g.parent().attr("class").indexOf("repeatable")>-1&&g.parent().attr("class").indexOf("fc-repeatable-row")===-1||g.hasClass("fc-hide")||g.hasClass("fc-already-initialised-verification")||inModal(g)||(f=g.attr("fc-belongs-to"),"string"==typeof f&&(i=fc.domContainer.find('.fc-section[formcorp-data-id="'+f+'"]'),i.length>0&&i.hasClass("fc-hide"))||h.indexOf(fc.constants.prefixSeparator)>-1&&(d=h.split(fc.constants.prefixSeparator),c=$(a).find('.fc-field[fc-data-group="'+d[0]+'"]'),c.hasClass("fc-hide"))))){void 0!==j&&h.indexOf(fc.constants.prefixSeparator)>=0&&(m=h.replace(getId(j),""));var n=getConfig(j,"required",!1);!n&&fc.util.isEmpty(getConfig(j,"requiredLogic",[]))||"string"==typeof j.type&&godFields.indexOf(j.type)!==-1||i.hasClass("fc-hide")||(l=getFieldErrors(h,k,m),l.length>0?(logEvent(fc.eventTypes.onFieldError,{fieldId:h,errors:l}),e[h]=l,removeFieldSuccess(h),b&&showFieldError(h,l)):b&&(removeFieldError(h),showFieldSuccess(h)))}}),d===!0&&flushVisibility(),c?Object.keys(e):0===Object.keys(e).length},getPageById=function(a){if("object"==typeof fc.pages[a])return fc.pages[a];var b,c,d,e;for(b=0;b<fc.schema.stage.length;b+=1)if(d=fc.schema.stage[b],"object"==typeof d.page&&d.page.length>0)for(c=0;c<d.page.length;c+=1)e=d.page[c],void 0===fc.pages[e._id.$id]&&(fc.pages[e._id.$id]={stage:d,page:e});return fc.pages[a]?fc.pages[a]:void 0},saveOriginalGroupletValue=function(a,b){var c,d,e;a.indexOf(fc.constants.prefixSeparator)>-1&&(c=a.split(fc.constants.prefixSeparator),c.length>1&&(d=c[c.length-2],e=c[c.length-1],void 0===fc.fields[d]&&setVirtualValue(d,{}),"object"==typeof fc.fields[d]&&(fc.fields[d][e]=b)))},getBooleanLogic=function(a){return"string"==typeof a&&a.isJson()?toBooleanLogic($.parseJSON(a)):a},toBooleanLogic=function(a){var b,c,d,e,f,g="",h="";if(a){if("string"==typeof a)return a.isJson()?toBooleanLogic($.parseJSON(a)):a;if(void 0!==a.condition&&(h="and"===a.condition.toLowerCase()?" && ":" || "),"object"==typeof a.rules){for(g+="(",b=0;b<a.rules.length;b+=1){if(c=a.rules[b],f=void 0!==c.condition?"and"===c.condition.toLowerCase()?" && ":" || ":h,0===f&&(f=" && "),0===b&&(f=""),"string"==typeof c.field&&void 0!==c.value){if(d="fc.comparison","string"==typeof c.operator&&c.operator.length>0&&(d+=c.operator.charAt(0).toUpperCase()+c.operator.slice(1)),"string"==typeof c.value&&["[","{"].indexOf(c.value.substring(0,1))>-1)try{e=$.parseJSON(c.value),c.value=e}catch(i){}"object"==typeof c.value?c.value=JSON.stringify(c.value):"string"==typeof c.value&&(c.value='"'+c.value+'"'),g+=f+d+'(getValue("'+c.field+'"), '+c.value+', "'+c.field+'")'}"object"==typeof c.rules&&c.rules.length>0&&(g+=(b>0?h:"")+toBooleanLogic(c))}g+=")"}return g}},updateFieldSchemas=function(a){var b,c,d,e,f,g=["visibility","validators"],h=["visibility"];if("object"==typeof a&&$.isArray(a)&&a.length>0)for(b=0;b<a.length;b+=1){if(c=a[b],d=getId(c),void 0===fc.fieldSchema[d]){for(e=0;e<g.length;e+=1)void 0!==c.config[g[e]]&&c.config[g[e]].length>0&&(c.config[g[e]]=$.parseJSON(c.config[g[e]]),h.indexOf(g[e])>=0&&(c.config[g[e]]=toBooleanLogic(c.config[g[e]],!0)));fc.fieldSchema[d]=c}"grouplet"===c.type&&(f=getConfig(c,"grouplet",{field:[]}),updateFieldSchemas(f.field))}},initAnalytics=function(){fc.domContainer.on(fc.jsEvents.onAnalyticsLoaded,function(){fc.analytics=fcAnalytics,fc.analytics.init()}),loadJsFile(analyticsUrl())},updateFieldSchema=function(a){var b,c,d,e,f,g,h,i=["visibility","validators"],j=["visibility"];if(void 0!==a.page)for(b=0;b<a.page.length;b+=1)if(e=a.page[b],void 0!==e.section){if("object"==typeof e.toCondition&&Object.keys(e.toCondition).length>0)for(d in e.toCondition)if(getPageById(d)&&e.toCondition.hasOwnProperty(d))try{e.toCondition[d]=toBooleanLogic($.parseJSON(e.toCondition[d]))}catch(k){}for(c=0;c<e.section.length;c+=1)if(g=e.section[c],void 0!==g.field&&0!==g.field.length){for(h=0;h<i.length;h+=1)if(f=i[h],"string"==typeof g[f])try{g[f]=$.parseJSON(g[f])}catch(k){}for(h=0;h<j.length;h+=1)"object"==typeof g[j[h]]&&(g[j[h]]=toBooleanLogic(g[j[h]]));void 0===fc.sections[getId(g)]&&(fc.sections[getId(g)]=g),updateFieldSchemas(g.field)}}},getGroupletTags=function(a){var b,c,d,e,f=fc.fieldSchema[a],g={};if(void 0===f||"grouplet"!==f.type)return[];if(b=getConfig(f,"grouplet"),"object"==typeof b&&void 0!==b.field&&b.field.length>0)for(c=0;c<b.field.length;c+=1)d=b.field[c],e=getConfig(d,"tag",""),e.length>0&&(g[d._id.$id]=e);return g},getGroupletRowTags=function(a,b){var c,d,e,f={};if("object"==typeof a)for(c in a)a.hasOwnProperty(c)&&(c.indexOf(fc.constants.prefixSeparator)>-1?(d=c.split(fc.constants.prefixSeparator),e=d[d.length-1]):e=c,b.hasOwnProperty(e)?f[b[e]]=a[c]:f[e]=a[c]);return f},hasLib=function(a){return"string"==typeof a&&0!==a.length&&fc.loadedLibs.indexOf(a)>=0},scrollToOffset=function(a){void 0!==fc.midScroll&&fc.midScroll===!0||(fc.midScroll=!0,$("html,body").stop(!0,!0).animate({scrollTop:a+"px"},fc.config.scrollDuration,function(){fc.midScroll=!1,fc.activeScroll=""}))},replaceTokens=function(a,b,c){return tokenise(a,b,c)},replaceTokensInDom=function(a,b){return void 0!==b&&b!==!1||(b=getFieldTagValues()),void 0===a&&(a=fc.domContainer),a.find("span.fc-token").each(function(){var a=$(this).attr("data-token");a&&a.length>0&&void 0!==b[a]&&$(this).html(htmlEncode(b[a]))}),a},setLanguageAlias=function(a,b){"undefined"==typeof fc.languageAliasMaps&&(fc.languageAliasMaps={}),fc.languageAliasMaps[a]=b},loadLanguagePack=function(a){fc.languagePacks=a;var b,c,d,e,f,g,h;if("object"==typeof fc.languageAliasMaps&&Object.keys(fc.languageAliasMaps).length>0)for(var i in fc.languageAliasMaps)if(fc.languageAliasMaps.hasOwnProperty(i)){for(c=i,b=fc.languageAliasMaps[i],g=b.split(fc.constants.tagSeparator),e=fc.languagePacks,d=0;d<g.length&&(e=e[g[d]],"undefined"!=typeof e);d+=1);if("undefined"!=typeof e){for(g=c.split(fc.constants.tagSeparator),f=fc.languagePacks,d=0;d<g.length;d+=1)h=g[d],"object"!=typeof f[h]&&(f[h]={}),d<g.length-1&&(f=f[h]);f[h]=e}}},getPageVisibleFieldsFromDom=function(a){var b;if(b="undefined"==typeof a?fc.domContainer:fc.domContainer.find('.fc-page[data-page-id="'+a+'"]'),0===b.length)return!1;if(b.length>0){var c=b.find(".fc-section:visible:not(.fc-hide)");if(c.length>0){var d=c.find(".fc-field:visible:not(.fc-hide) [formcorp-data-id]");return 0!==d.length&&d}}return!1},groupletLength=function(a){var b=fc.fields[a];return $.isArray(b)?b.length:0},isFormula=function(a){var b=fc.constants.formulaPrefix.length;return a.length>b&&a.substr(0,b).toLowerCase()===fc.constants.formulaPrefix.toLowerCase()},fieldIdByTag=function(a){var b=getAllFieldTags();return Object.keys(b).filter(function(c){return b[c]===a})[0]},getContentRadioListMeta=function(a,b){var c,d,e,f,g=getValue(a,""),h=fc.fieldSchema[a],i=getConfig(h,"options","").split("\n");if(void 0===g||""===g)return"";if($.isArray(i))for(c=0;c<i.length;c+=1)if(i[c].isJson()&&(d=$.parseJSON(i[c]),f=d[0],"string"==typeof f&&f===g&&"object"==typeof d[5]&&(e=d[5],void 0!==e[b])))return e[b]},shuffle=function(a){for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a},getHashVar=function(a,b){var c,d=window.location.hash,e=d.indexOf(a);return"undefined"==typeof b&&(b=""),e<0?b:(e+=a.length,c=d.indexOf(fc.config.hashSeparator,e),c<0&&(c=d.length),d.substring(e,c))},setHashVar=function(a,b,c){var d,e,f=window.location.hash,g=f,h="",i="";return"boolean"!=typeof c&&(c=!0),0===getHashVar(a).length?(f.length>0&&(g+=fc.config.hashSeparator),g+=a+b):(d=g.indexOf(a)+a.length,e=g.indexOf(fc.config.hashSeparator,d),h=g.substr(0,d),e>=0&&(i=g.substr(d+getHashVar(a).length)),g=h+b+i),c&&(window.location.hash=g),g},removeHashVar=function(a){var b=setHashVar(a,"",!1).replace(a,"");window.location.hash=b},formulaToPrice=function(a){isFormula(a)&&(a=a.substr(fc.constants.formulaPrefix.length));try{return fc.parser.parse(a).evaluate()}catch(b){return 0}},getPaymentAmount=function(fieldId){var schema,price,conditionalPrices,booleanLogic,conditionalPrice,iterator;if(schema=fc.fieldSchema[fieldId],void 0!==schema){if(price=getConfig(schema,"defaultPrice",0),conditionalPrices=getConfig(schema,"conditionalPrice",[],!0),"object"==typeof conditionalPrices&&conditionalPrices.length>0)for(iterator=0;iterator<conditionalPrices.length;iterator+=1)conditionalPrice=conditionalPrices[iterator],"object"==typeof conditionalPrice.conditions&&(booleanLogic=toBooleanLogic(conditionalPrice.conditions),eval(booleanLogic)&&(price=conditionalPrice.price));return $.isNumeric(price)?price:isFormula(price)?formulaToPrice(price):price}},renderRepeatableTable=function(a,b){var c,d="",e=getGroupletTags(a),f=fc.fieldSchema[a],g=getConfig(f,fc.constants.configKeys.summaryLayout,"");if(0===g.length)return"";for(d+="<div class='fc-summary-table'>",d+="<table class='fc-summary'><tbody>",c=0;c<b.length;c+=1)d+="<tr><td>",d+=replaceTokens(g,getGroupletRowTags(b[c],e)),d+="<div class='fc-summary-options' data-field-id='"+a+"' data-index='"+c+"'><a href='#' class='fc-edit'>"+fc.lang.edit+"</a> &nbsp; <a href='#' class='fc-delete'>"+fc.lang.delete+"</a></div>",
d+="</td></tr>";return d+="</tbody></table>",d+="</div>"},fieldIsRepeatable=function(a){var b=fc.fieldSchema[a];return b&&"boolean"==typeof b.config.repeatable&&b.config.repeatable},fieldParentIsRepeatable=function(a){var b,c;return b=a.split(fc.constants.prefixSeparator),b.pop(),0!==b.length&&(c=b.join(fc.constants.prefixSeparator),!!fc.fieldSchema[c]&&fieldIsRepeatable(c))},setRangeValue=function(a){var b=parseInt(a.val()),c=a.parent().find(".fc-numeric-outcome");c.length>0&&c.html(b)},setDomValue=function(a,b,c){"undefined"==typeof c&&(c=!0);var d,e=$(a).find(".fc-fieldgroup"),f=e.find("input[type=text],input[type=tel],textarea,input[type=range],input[type=hidden]");f.length>0?(f.val(b),"string"==typeof b&&b.length>0&&c&&f.trigger("blur"),"range"===f.attr("type")&&setRangeValue(f)):e.find("select").length>0?e.find("select").val(b):e.find("input[type=radio]").length>0||e.find("input[type=checkbox]").length>0?e.find('input[value="'+encodeURIComponent(b)+'"]').prop("checked",!0):(d=e.find('.fc-fieldinput.fc-button[data-value="'+encodeURIComponent(b)+'"]'),d.length>0&&d.addClass("checked"))},setFieldValue=function(a,b,c){log("setFieldValue"),log(a),log(b);var d,e,f,g,h,i=fc.fieldSchema[b],j=["emailVerification","smsVerification"];if("undefined"==typeof c&&(c=!0),d=getValue(b),util.isEmpty(util.trim(d))&&void 0!==i){if(h=getConfig(i,"populateFrom",""),h.length>0&&!$.isNumeric(h)&&"grouplet"!==i.type&&void 0!==fc.fields[h]){d=fc.fields[h],getConfig(i,"maxLength",!1)&&(d=d.slice(0,getConfig(i,"maxLength",-1))),setVirtualValue(b,d,fc.fields,!1,!1);var k=fc.domContainer.find('div[fc-data-group="'+b+'"]');if(k.length>0&&(setDomValue(k,d,c),c)){var l=getFieldErrors(b,d,"");void 0!==l&&l.length>0?(removeFieldSuccess(b),showFieldError(b,l)):(removeFieldError(b),showFieldSuccess(b))}var m=getConfig(i,"prePopulate",[]);if(!$.isArray(m)||0===m.length)return;prepopulate(i,d,c)}void 0!==d&&""!==d||(g=getDefaultValue(b),g.length>0&&(d=g,getConfig(i,"maxLength",!1)&&(d=d.slice(0,getConfig(i,"maxLength",-1)))))}if(void 0!==d){if(i=fc.fieldSchema[b],j.indexOf(i.type)>=0)return;if("grouplet"!==i.type||fieldIsRepeatable(b))if(fieldIsRepeatable(b))getConfig(i,"renderRepeatableTable",!1)&&"object"==typeof d&&$('[fc-data-group="'+b+'"] .fc-summary').html(renderRepeatableTable(b,d));else if("contentRadioList"===i.type)if("object"==typeof d)for(e=0;e<d.length;e+=1)f=$('.fc-button[data-field-value="'+encodeURIComponent(d[e])+'"]'),f&&f.length>0&&f.addClass("checked");else f=$('.fc-button[data-field-value="'+encodeURIComponent(d)+'"]'),f&&f.length>0&&f.addClass("checked");else"matrix"===i.type?loadMatrixFieldValues(b,d):"fileUpload"===i.type?(setDomValue(a,d,c),d.length>2&&buildFileList(b,d)):setDomValue(a,d,c);else log("restore grouplet that isnt repeatable")}},setFieldValues=function(a){var b;void 0===a&&(a=fc.domContainer),a.find("div[fc-data-group]").each(function(){b=$(this).attr("fc-data-group"),setFieldValue(this,b,!1)})},renderTextfield=function(a,b){void 0===b&&(b="");var c="",d="boolean"==typeof a.config.required&&a.config.required,e=b+getId(a),f="",g="text";getConfig(a,"isPassword",!1)&&(g="password");var h=getConfig(a,"displayCharCounter",!1),i=getConfig(a,"displayWordCounter",!1);(h||i)&&(fc.domContainer.on("keypress","#fc-field-"+a._id.$id,function(a){var b=0,c=0;h&&"string"==typeof this.value&&(b=this.value.length),i&&null!=this.value.match(/\S+/g)&&(c=this.value.match(/\S+/g).length)}),fc.domContainer.on("keyup","#fc-field-"+a._id.$id,function(a){8==a.keyCode||46==a.keyCode})),getConfig(a,"isNumeric",!1)&&(fc.domContainer.on("onFinishFormRender",function(){var b=getConfig(a,"acceptedCharacters","")+"1234567890";fc.domContainer.find("#fc-field-"+e).unbind("keypress").on("keypress",function(a){var c=b.split("");if(c.length>0)return c.indexOf(a.key)>=0})}),c=" fc-fieldinput-numeric");var j=getConfig(a,"maxLength","");return j.length>0&&(j='maxlength="'+j+'"'),f='<input class="fc-fieldinput'+c+'" id="fc-field-'+e+'" type="'+g+'" formcorp-data-id="'+e+'" data-required="'+d+'" placeholder="'+getConfig(a,"placeholder")+'" '+(a.config.readOnly?"readonly ":"")+j+">"},renderDropdown=function(a,b){void 0===b&&(b="");var c,d,e,f="boolean"==typeof a.config.required&&a.config.required,g=b+a._id.$id,h='<select id="fc-field-'+g+'" class="fc-fieldinput" formcorp-data-id="'+g+'" data-required="'+f+'" '+k+">",i=getConfig(a,"options",""),j=!1,k=a.config.readOnly?"disabled":"";if(getConfig(a,"placeholder","").length>0&&(h+='<option value="" disabled selected>'+htmlEncode(getConfig(a,"placeholder"))+"</option>"),i.length>0){for(i=i.split("\n"),c=0;c<i.length;c+=1)d=i[c],d=d.replace(/(\r\n|\n|\r)/gm,""),d.match(/^\[\[(.*?)\]\]$/g)?(j&&(h+="</optgroup>"),e=d.substring(2,d.length-2),h+='<optgroup label="'+e+'">'):h+='<option value="'+htmlEncode(d)+'">'+htmlEncode(d)+"</option>";j&&(h+="</optgroup>")}return h+="</select>"},renderTextarea=function(a,b){void 0===b&&(b="");var c,d,e="boolean"==typeof a.config.required&&a.config.required,f=b+getId(a),g=a.config.readOnly?"readonly":"",h=getConfig(a,"displayCharCounter",!1),i=getConfig(a,"displayWordCounter",!1);return(h||i)&&(fc.domContainer.on("keypress","#fc-field-"+a._id.$id,function(a){var b=0,c=0;h&&"string"==typeof this.value&&(b=this.value.length),i&&null!=this.value.match(/\S+/g)&&(c=this.value.match(/\S+/g).length)}),fc.domContainer.on("keyup","#fc-field-"+a._id.$id,function(a){8==a.keyCode||46==a.keyCode})),d=getConfig(a,"default","").length>0?getConfig(a,"default"):"",c="<textarea",getConfig(a,"readOnly",!1)&&(c+=" readonly"),c+=' id="fc-field-'+f+'" class="fc-fieldinput" formcorp-data-id="'+f+'" data-required="'+e+'" placeholder="'+getConfig(a,"placeholder")+'" rows="'+getConfig(a,"rows",3)+'" '+g+">"+htmlEncode(d)+"</textarea>"},renderContentRadioList=function(a,b){b||(b="");var c,d,e,f,g,h,i,j,k,l,m,n="boolean"==typeof a.config.required&&a.config.required,o=getConfig(a,"options",""),p=b+getId(a),q="";if(o.length>0){for(o=o.split("\n"),d=getConfig(a,"inline",!1)===!0?"fc-inline":"fc-block",q+='<div class="fc-col-'+htmlEncode(getConfig(a,"boxesPerRow"))+'">',c=0;c<o.length;c+=1)if(e=o[c].replace(/(\r\n|\n|\r)/gm,""),0!==e.length){i="",j="",h="",k="",l="",m={};try{g=$.parseJSON(e)}catch(r){continue}try{h=g[0]||"",i=g[1]||"",k=g[2]||"",j=g[3]||"",l=g[4]||"",m=g[5]||{},"object"!=typeof m&&(m={})}catch(r){}f=getConfig(a,"default")===e?" checked":"",q+='<div class="fc-content-radio-item fc-col '+l+'">',q+='<div class="fc-content-title">'+htmlEncode(h)+"</div>",q+='<div class="fc-content-content">',q+='<div class="fc-content-desc">'+i+"</div>",q+='<div class="fc-content-icon"><i class="'+htmlEncode(k)+'"></i></div>',q+='<div class="fc-option-buttons '+d+'">',q+='<button class="fc-fieldinput fc-button" id="'+getId(a)+"_"+c+'" formcorp-data-id="'+p+'" data-value="'+encodeURIComponent(e)+'" data-field-value="'+encodeURIComponent(h)+'" data-required="'+n+'"'+f+">"+htmlEncode(getConfig(a,"buttonText"))+"</button>",!fc.config.helpAsModal&&j&&j.length>0&&(q+='<div class="fc-help">',q+=j,q+="</div>"),q+="</div>",q+="</div>",q+="</div>"}q+='<div class="fc-clear"></div>',q+="</div>"}return q},renderOptionTable=function(a,b){var c,d,e,f,g,h="boolean"==typeof a.config.required&&a.config.required,i=getConfig(a,"jsonOptions","[]"),j=b+a._id.$id,k="";if("string"==typeof i&&(i=$.parseJSON(i)),!i||!i.rows)return"";for(k+='<table class="fc-table"',i.cellspacing&&(k+=' cellspacing="'+htmlEncode(i.cellspacing)+'"'),i.cellpadding&&(k+=' cellpadding="'+htmlEncode(i.cellpadding)+'"'),k+=">",d=0;d<i.rows.length;d+=1){if(f=i.rows[d],k+="<tr>","object"==typeof f&&f.length>0)for(e=0;e<f.length;e+=1)g=f[e],k+=g.head?"<th":"<td",g.class&&g.class.length>0&&(k+=' class="'+htmlEncode(g.class)+'"'),g.colspan&&(k+='colspan="'+htmlEncode(g.colspan)+'"'),k+=">",g.label&&(k+='<span class="fc-table-label">'+tokenise(g.label)+"</span>"),g.option&&(c=getConfig(a,"default")===g.option.value?" checked":"",k+='<div class="fc-option-buttons">',k+='<button class="fc-fieldinput fc-button" id="'+getId(a)+"_"+d+"_"+e+'" formcorp-data-id="'+j+'" data-value="'+encodeURIComponent(g.option.value)+'" data-field-value="'+encodeURIComponent(g.option.value)+'" data-required="'+h+'"'+c+">"+htmlEncode(g.option.text)+"</button>",k+="</div>"),k+=g.head?"</th>":"</td>";k+="</tr>"}return k+="</table>"},getOptions=function(a,b){var c,d,e={},f=[];if("boolean"!=typeof b&&(b=!1),"string"==typeof a){var g,h,i;c=a.split("\n");for(var j=0;j<c.length;j++)g=c[j],h=c[j],g.indexOf(fc.constants.optionValueSeparator)>=0&&(i=g.split(fc.constants.optionValueSeparator),g=i[0],h=i[1]),e[fc.lang.optionPrefix+g]=h.replace(/(\r\n|\n|\r)/gm,"").trim()}for(var k in e)e.hasOwnProperty(k)&&(d={},d[k.trim()]=e[k],f.push(d));return b&&(f=shuffle(f)),b?shuffle(f):f},renderRadioList=function(a,b){void 0===b&&(b="");var c,d,e,f,g,h,i,j,k,l,m="boolean"==typeof a.config.required&&a.config.required,n=getOptions(getConfig(a,"options",""),getConfig(a,"randomiseOptions",!1)),o=b+a._id.$id,p="",q=[],r=a.config.readOnly?"disabled":"";if(h=fc.fields[o],d=getConfig(a,"inline",!1)===!0?"fc-inline":"fc-block",e=0,"object"==typeof n&&$.isArray(n)&&n.length>0)for(getConfig(a,"asButton",!1)&&(p+='<div class="fc-radio-option-buttons">'),i=0;i<n.length;i+=1)if(f=n[e],"object"==typeof f)for(c in f)f.hasOwnProperty(c)&&(g=b+getId(a)+"_"+e++,l=htmlEncode(c.trim().substr(fc.lang.optionPrefix.length)),k=l==h||getConfig(a,"default")===f?" checked":"",getConfig(a,"asButton",!1)?(j='<div class="fc-option-buttons '+d+'">',j+='<button class="fc-fieldinput fc-button'+k+'" id="'+g+'" formcorp-data-id="'+o+'" data-value="'+l+'" data-required="'+m+'">'+htmlEncode(f[c])+"</button>",j+="</div>"):(j='<div class="'+d+'">',j+='<input class="fc-fieldinput" type="radio" id="'+g+'" formcorp-data-id="'+o+'" name="'+o+'" value="'+l+'" data-required="'+m+'"'+k+" "+r+">",j+='<label title="'+htmlEncode(f[c])+'" for="'+g+'"><span><i>&nbsp;</i></span><em>'+htmlEncode(f[c])+'</em><span class="fc-end-radio-item"></span></label>',j+="</div>"),(fc.mode!==formcorp.MODE_REVIEW||k)&&q.push(j));return p+=q.join(""),getConfig(a,"asButton",!1)&&(p+="</div>"),p},renderCheckboxList=function(a,b){void 0===b&&(b="");var c,d,e,f,g,h,i,j,k,l="boolean"==typeof a.config.required&&a.config.required,m=getOptions(getConfig(a,"options",""),getConfig(a,"randomiseOptions",!1)),n=b+a._id.$id,o=[],p=[],q=a.config.readOnly?"disabled":"";if(void 0!==fc.fields[n]&&"string"==typeof fc.fields[n])try{i=$.parseJSON(fc.fields[n]),o=i}catch(r){}else o=getValue(n);d=getConfig(a,"inline",!1)===!0?"fc-inline":"fc-block";var s=!1;if(f=0,"object"==typeof m&&$.isArray(m)&&m.length>0)for(e=0;e<m.length;e+=1)if(g=m[f],"object"==typeof g)for(c in g)g.hasOwnProperty(c)&&(j=c.trim().substr(fc.lang.optionPrefix.length),h=b+getId(a)+"_"+f++,k='<div class="'+d+'">',k+='<input class="fc-fieldinput" type="checkbox" id="'+h+'" formcorp-data-id="'+n+'" name="'+n+'[]" value="'+htmlEncode(j)+'" data-required="'+l+'" '+q+" ",o.indexOf(j)>-1?(s=!0,k+=' checked="checked"'):s=!1,fc.mode===formcorp.MODE_REVIEW&&(k+=' readonly="readonly" onclick="return false;"'),k+=">",k+='<label title="'+htmlEncode(g[c])+'" for="'+h+'">',k+="<span><b><i></i><i></i></b></span><em>"+htmlEncode(g[c])+"</em>",k+='<span class="fc-end-checkbox-item"></span>',k+="</label>",k+="</div>",(fc.mode!==formcorp.MODE_REVIEW||s)&&p.push(k));return p.join("")},renderHiddenField=function(a,b){void 0===b&&(b="");var c=b+a._id.$id,d='<input class="fc-fieldinput" type="hidden" formcorp-data-id="'+c+'" value="'+getConfig(a,"value")+'">';return d},renderRichText=function(a){if("string"!=typeof a.config.rich)return"";var b=a.config.rich,c=b.match(/(<[^\/][^>]+)/g);if("object"==typeof c&&$.isArray(c)&&c.length>0)for(var d,e=0,f=c.length;e<f;e++)c[e].indexOf("{{")>=0&&(d=replaceTokens(c[e],getFieldTagValues(),!1),b=b.replace(new RegExp(c[e],"g"),d),b.indexOf("{{")>=0&&(b=b.replace(c[e],d)));return b=replaceTokens(b,getFieldTagValues(),!0),'<div class="fc-richtext">'+b+"</div>"},createDynamicFormFromData=function(a,b,c){var d,e,f,g,h;if(g=fc.fieldSchema[a],void 0!==g){h=getConfig(g,"environment",fc.environments.sandbox)===fc.environments.sandbox?b.action.sandbox:b.action.live,d=$(document.createElement("form")),$(d).attr("action",h),$(d).attr("method",b.method);for(f in c)c.hasOwnProperty(f)&&(e=$("<input>").attr("type","hidden").attr("name",f).val(c[f]),$(d).append($(e)));return $(d)}},forceUpdateFieldValue=function(a,b){log("forceUpdateFieldValue"),log(a),log(b),"string"==typeof a&&a.length>0&&!$.isNumeric(a)&&setVirtualValue(a,b)},initPaycorpGateway=function(a,b){var c,d,e,f,g;switch(void 0!==b.vars&&"string"==typeof b.vars.clientId&&0!==b.vars.clientId.length||log("Malformed paycorp client id"),e=a.find(".fc-cc-expirydate-month").val(),1===e.length&&(e="0"+e),g=a.find(".fc-cc-number input").val().replace(/[^0-9]+/g,""),getCreditCardType(g)){case fc.cardTypes.mastercard:f="MASTERCARD";break;case fc.cardTypes.visa:f="VISA";break;case fc.cardTypes.amex:f="AMEX";break;default:f="MASTERCARD"}return c={clientIdHash:b.vars.clientId,cardType:f,cardHolderName:a.find(".fc-cc-name input").val(),cardNo:g,cardExpiryMM:e,cardExpiryYYYY:a.find(".fc-cc-expirydate-year").val(),cardSecureId:a.find(".fc-cc-ccv input").val().replace(/[^0-9]+/g,""),paymentAmount:getPaymentAmount(a.attr("fc-data-group")),metaData1:a.attr("fc-data-group"),metaData2:fc.sessionId},d=createDynamicFormFromData(a.attr("fc-data-group"),fc.gateways.paycorp,c),d.submit(),!1},registerCreditCardListeners=function(){fc.domContainer.on("click",".fc-submit-payment .fc-btn",function(){var a,b,c,d,e;if(a=$(this).attr("data-for"),void 0===a)return!1;if(b=$('[fc-data-group="'+a+'"]'),0===b.length)return!1;if(d=fc.fieldSchema[a],void 0===d)return!1;if(e=validCreditCardField(a,d,b.parent()),e.length>0)return logEvent(fc.eventTypes.onFieldError,{fieldId:a,errors:e}),removeFieldSuccess(a),showFieldError(a,e),!1;if(showFieldSuccess(a),removeFieldError(a),removeFieldError(a),c=getConfig(d,"paymentGateway",{},!0),"string"!=typeof c.gateway)return!1;switch(c.gateway){case"paycorp":initPaycorpGateway(b,c);break;default:log("No gateway to use")}return!1}),fc.processedActions[fc.processes.creditCardListeners]=!0},renderPaymentSummary=function(a){var b,c;return c=parseFloat(getPaymentAmount(getId(a))).toFixed(2),b="<div class='fc-table-summary'>",getConfig(a,"paymentSummaryTitle","").length>0&&(b+="<label>"+htmlEncode(getConfig(a,"paymentSummaryTitle",""))+"</label>"),getConfig(a,"paymentSummaryDescription","").length>0&&(b+="<label>"+getConfig(a,"paymentSummaryDescription","")+"</label>"),b+='<table class="fc-table fc-summary"><thead><tr>',b+="<th>"+fc.lang.description+'</th><th class="fc-total">'+fc.lang.total+"</th></tr></thead>",b+="<tbody>",getConfig(a,"includeGST",!1)?(b+="<tr><td>"+fc.lang.paymentDescription+'<em class="fc-text-right fc-right">'+fc.lang.paymentSubTotal+"</em>",b+="</td><td>",b+=fc.lang.currencySymbol.concat(parseFloat(c/11*10).toFixed(2)),b+="</td></tr>",b+='<tr><td class="fc-text-right"><em>'+fc.lang.paymentGst+"</em></td><td>",b+=fc.lang.currencySymbol.concat(parseFloat(c/11).toFixed(2))+"</td></tr>",b+='<tr><td class="fc-text-right"><em>'+fc.lang.paymentTotal+"</em></td><td>"+fc.lang.currencySymbol.concat(c)+"</td></tr>"):(b+="<tr><td>"+fc.lang.paymentDescription+'<em class="fc-text-right fc-right">'+fc.lang.paymentTotal+"</em>",b+="</td><td>",b+=fc.lang.currencySymbol.concat(c),b+="</td></tr>"),b+="</tbody>",b+="</table>",b+="</div>"},renderCreditCard=function(a){var b,c,d,e,f="",g=(new Date).getFullYear();if(getConfig(a,"showPaymentSummary",!1)&&(f+=renderPaymentSummary(a)),f+='<div class="fc-creditCard-header">',getConfig(a,"showLabel",!1)===!0&&getConfig(a,"label","").length>0&&(f+="<label>"+htmlEncode(getConfig(a,"label")),fc.config.asterisksOnLabels&&getConfig(a,"required",!1)&&(f+='<span class="fc-required-caret">'+fc.lang.requiredAsterisk+"</span>"),fc.config.colonAfterLabel&&(f+=fc.lang.labelColon),f+="</label>"),getConfig(a,"label","").length>0&&(f+=getConfig(a,"description")),f+="</div>",d=fc.fields[getId(a)],void 0!==d&&1==d.success)return f+=renderCompletedPayment(d);if(e=fc.getUrlParameter(fc.config.creditCardErrorUrlParam),void 0!==e&&e.length>0&&(f+='<div class="fc-error"><label>'+htmlEncode(e)+"</label></div>"),processed(fc.processes.creditCardListeners)||registerCreditCardListeners(),"securepay"===getConfig(a,"paymentGateway","",!0).gateway)return renderSecurePayIFrame(a),f+='<div class="fc-securepay-iframe"></div>';for(f+='<div class="fc-payment">',f+='<div class="fc-cc-name"><label>'+fc.lang.creditCardNameText+'</label><input type="text" class="fc-fieldinput"></div>',f+='<div class="fc-cc-number"><label>'+fc.lang.creditCardNumberText+'</label><input type="text" class="fc-fieldinput"></div>',f+='<div class="fc-cc-expirydate"><label>'+fc.lang.creditCardExpiryDateText+"</label>",f+='<select class="fc-cc-expirydate-month"><option value="" disabled selected>Please select...</option>',b=1;b<=12;b+=1)f+='<option value="'+b+'">'+fc.lang.monthNames[b-1]+"</option>";for(f+="</select>",f+='<select class="fc-cc-expirydate-year"><option value="" disabled selected>Please select...</option>',c=g;c<=g+20;c+=1)f+='<option value="'+c+'">'+c+"</option>";return f+="</select></div>",f+='<div class="fc-cc-ccv">',f+="<label>"+fc.lang.creditCardSecurityCodeText+'</label><input type="text" class="fc-fieldinput">',null===fc.config.cvvImage&&(f+='<img src="'+cdnUrl()+'/img/cvv.gif" alt="cvv">'),f+="</div>",f+='<div class="fc-submit-payment">',f+='<input class="fc-btn" data-for="'+getId(a)+'" type="'+fc.config.buttonInputType+'" value="'+fc.lang.payNow+'"><div class="fc-loading fc-hide"></div>',f+="</div>",f+="</div>"},renderSecurePayIFrame=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p="";n=getConfig(a,"defaultPrice"),isFormula(n)&&(b=formulaToPrice(n)),c=getConfig(a,"paymentGateway","",!0).vars.currency,""===c&&(c="AUD"),d=getConfig(a,"paymentGateway","",!0).vars.display_receipt,""===d&&(d="yes"),e=getConfig(a,"paymentGateway","",!0).vars.return_url,f=getConfig(a,"paymentGateway","",!0).vars.return_url_text,g=getConfig(a,"paymentGateway","",!0).vars.return_url_target,""===g&&(g="self"),h=getConfig(a,"paymentGateway","",!0).vars.confirmation,""===h&&(h="yes"),i=getConfig(a,"paymentGateway","",!0).vars.template,""===i&&(i="iframe"),j=getConfig(a,"paymentGateway","",!0).vars.page_header_image,k=getConfig(a,"paymentGateway","",!0).vars.page_title,l=getConfig(a,"paymentGateway","",!0).vars.page_style_url,m=getConfig(a,"paymentGateway","",!0).vars.display_cardholder_name,""===m&&(m="yes"),o=getConfig(a,"environment",fc.environments.sandbox)===fc.environments.sandbox?fc.gateways.securepay.action.sandbox:fc.gateways.securepay.action.live,api("securepay/default/index",{field_id:a._id.$id},fc.gateways.securepay.method,function(a){p+='<iframe scrolling="no" frameborder="0" style="width: 100%;height: 500px" src="',p+=o,p+="&merchant_id="+a.merchant_id,p+="&fingerprint="+a.fingerprint,p+="&fp_timestamp="+a.timestamp,p+="&primary_ref="+a.primary_ref,p+="&amount="+a.amount,p+="&txn_type="+a.txn_type,p+="&currency="+c,p+="&display_receipt="+d,p+="&return_url="+e,p+="&return_url_text="+f,p+="&return_url_target="+g,p+="&confirmation="+h,p+="&template="+i,p+="&page_header_image="+j,p+="&page_title="+k,p+="&page_style_url="+l,p+="&display_cardholder_name="+m,p+='"></iframe>',$('.fc-section [fc-data-group="'+a.fieldId+'"] .fc-securepay-iframe').append(p),waitForSecurePayVerification(a.fieldId)})},waitForSecurePayVerification=function(a){api("securepay/default/verify",{fieldId:a},"POST",function(b){return"object"==typeof b&&void 0!==b.success&&b.success===!0?(setVirtualValue(a,b),$('[fc-data-group="'+a+'"] .fc-securepay-iframe iframe').remove(),$('[fc-data-group="'+a+'"] .fc-securepay-iframe').append(renderCompletedPayment(b)),fc.nextPageButtonClicked=!0,void fc.functions.loadNextPage(!1)):void setTimeout(function(){waitForSecurePayVerification(a)},5e3)})},renderCompletedPayment=function(a){var b="";return b+='<div class="fc-payment">',b+='<div class="fc-success">'+fc.lang.creditCardSuccess+"</div>",b+="</div>"},renderAbnField=function(a,b){void 0===b&&(b="");var c="boolean"==typeof a.config.required&&a.config.required,d=b+a._id.$id,e="fc-button",f='<input class="fc-fieldinput" type="text" formcorp-data-id="'+d+'" data-required="'+c+'" placeholder="'+getConfig(a,"placeholder")+'">';return fc.fields[d]&&fc.fields[d].length>0&&fc.validAbns.indexOf(fc.fields[d])>-1&&(e+=" fc-hide"),f+='<a class="'+e+'">'+fc.lang.validate+"</a>",f+='<div class="fc-loading fc-hide"></div>'},hideModal=function(){fc.activeModalField=null,fc.modalState=null,fc.modalMeta={},$(".fc-modal.fc-show").get(0).className="fc-modal"},verifyCode=function(a){var b,c;return b=fc.fieldSchema[fc.modalMeta.fieldId],void 0!==b&&(c={fieldId:fc.modalMeta.fieldId,code:a},$(".fc-modal .modal-footer .fc-loading").removeClass("fc-hide"),$(".fc-modal .modal-footer .fc-error").html("").addClass("fc-hide"),void api("verification/verify",c,"POST",function(a){"object"!=typeof a||void 0===a.success?$(".fc-modal .modal-footer .fc-error").html("An unknown error occurred communicating with the API server").removeClass("fc-hide"):a.success||"string"!=typeof a.message?a.success&&"object"==typeof a&&"string"==typeof a.verificationCode&&a.verificationCode.length>0&&($('[fc-data-group="'+fc.modalMeta.fieldId+'"]').addClass("fc-verified"),setVirtualValue(fc.modalMeta.fieldId,a.verificationCode),valueChanged(fc.modalMeta.fieldId,a.verificationCode,!0),hideModal()):$(".fc-modal .modal-footer .fc-error").html(a.message).removeClass("fc-hide"),$(".fc-modal .modal-footer .fc-loading").addClass("fc-hide")}))},verifyEmailAddress=function(){verifyCode($(".fc-email-verification-submit input[type=text], .fc-email-verification-submit input[type=tel], .fc-email-verification-submit").val())},showEmailVerificationModal=function(a){fc.modalState=fc.states.EMAIL_VERIFICATION_CODE,fc.modalMeta={fieldId:a};var b="<p>To verify your email, input the code sent to your e-mail address in the area below, and click the 'Verify email' button.</p>";return b+='<div class="fc-email-verification-submit"><input class="fc-fieldinput" type="text" placeholder="Enter verification code..."></div>',$(".fc-modal .modal-header h2").text("Success!"),$(".fc-modal .modal-body").html(b),$(".fc-modal .modal-footer .fc-btn-add").text("Verify").show(),$(".fc-modal").addClass("fc-show"),!1},waitForVerification=function(a){api("verification/is-verified",{fieldId:a},"POST",function(b){return"object"==typeof b&&void 0!==b.success&&b.success===!0?($('[fc-data-group="'+a+'"]').addClass("fc-verified"),setVirtualValue(a,"1"),void hideModal()):void setTimeout(function(){waitForVerification(a)},5e3)})},setValue=function(a,b,c){if(log("setValue("+a+","+b+","+c+")"),"boolean"!=typeof c&&(c=!0),forceUpdateFieldValue(a,b),c){var d=fc.domContainer.find('div[fc-data-group="'+a+'"]');d.length>0&&setDomValue(d,b)}valueChanged(a,b,!0)},registerEmailVerificationListeners=function(){fc.domContainer.on("click",".fc-email-verification .fc-send-email input[type="+fc.config.buttonInputType+"]",function(){var a,b,c=$(this).parent();return c.find(".fc-loading").removeClass("fc-hide"),c.parent().addClass("loading"),b=c.parent().attr("fc-belongs-to"),a={field:b},api("verification/callback",a,"POST",function(a){c.find(".fc-loading").addClass("fc-hide"),c.parent().removeClass("loading"),"object"==typeof a&&void 0!==a.success&&a.success&&(showEmailVerificationModal(b),waitForVerification(b))}),!1}),fc.domContainer.on("click",".fc-email-verification.fc-verify-inline .fc-email-verification-verify",function(){var a,b=$(this),c=b.parent().parent(),d=c.attr("fc-belongs-to"),e=c.find('input[type="text"], input[type="tel"], input[type="number"]'),f=e.val();return 0===f.length?(c.addClass("error"),void e.attr("placeholder",fc.lang.verificationErrorPrefix+fc.lang.verificationEmptyCode)):(a={fieldId:d,code:f},c.removeClass("error").addClass("loading"),e.attr("placeholder",""),api("verification/verify",a,"POST",function(a){if("object"==typeof a){var b=a.message||"";c.removeClass("loading"),e.val("").attr("placeholder",fc.lang.verificationErrorPrefix+b),"object"!=typeof a||void 0===a.success?c.addClass("error"):a.success||"string"!=typeof a.message?a.success&&($('[fc-data-group="'+d+'"]').addClass("fc-verified"),setVirtualValue(d,a.verificationCode),valueChanged(d,a.verificationCode,!0)):c.addClass("error"),$(".fc-modal .modal-footer .fc-loading").addClass("fc-hide")}}),!1)}),fc.domContainer.on("click",".fc-email-verification-modal",function(){var a=$(this).attr("data-for");return showEmailVerificationModal(a),!1}),fc.processedActions[fc.processes.emailListeners]=!0},renderEmailVerification=function(a){processed(fc.processes.emailListeners)||registerEmailVerificationListeners();var b,c="",d=fc.fields[getId(a)],e=validVerificationResult(d),f=getConfig(a,"sendButtonText",""),g=getConfig(a,"verificationButtonText","");return 0===f.length&&(f=fc.lang.sendEmail),e||(b=getConfig(a,"renderAsModal",!0)?"fc-verify-as-modal":"fc-verify-inline",c+='<div class="fc-email-verification '+b+'" fc-belongs-to="'+getId(a)+'">',getConfig(a,"renderAsModal",!0)&&g.length>0?c+='<div class="fc-verify-email"><input class="fc-btn fc-email-verification-modal" data-for="'+getId(a)+'" type="'+fc.config.buttonInputType+'" value="'+g+'"></div>':(c+='<div class="fc-verify-email-input-code"><input type="text" class="fc-verify-email-input fc-fieldinput" value=""></div>',c+='<div class="fc-verify-email-button"><input class="fc-btn fc-email-verification-verify" data-for="'+getId(a)+'" type="'+fc.config.buttonInputType+'" value="'+fc.lang.verify+'"></div>'),c+='<div class="fc-send-email">',c+='<input class="fc-btn" type="'+fc.config.buttonInputType+'" value="'+f+'"><div class="fc-loading fc-hide"></div>',c+="</div>",c+='<div class="fc-clear"></div>',c+="</div>"),c+='<div class="fc-success'+(e?" fc-force-show":"")+'">',c+=fc.lang.fieldValidated,c+="</div>",!e&&void 0===d&&getConfig(a,"autoDeliverOnFirstRender",!1)&&api("verification/callback",{field:getId(a)},"POST",function(b){"object"==typeof b&&void 0!==b.success&&b.success&&(getConfig(a,"autoShowModalDialog",!1)&&showEmailVerificationModal(getId(a)),waitForVerification(getId(a)),forceUpdateFieldValue(getId(a),"0"))}),c},verifyMobileNumber=function(){verifyCode($(".fc-sms-verification-submit input[type=text], .fc-sms-verification-submit input[type=tel], .fc-sms-verification-submit").val())},showSmsVerificationModal=function(a){fc.modalState=fc.states.SMS_VERIFICATION_CODE,fc.modalMeta={fieldId:a};var b="<p>To verify your mobile, input the code sent to you via SMS in the area below, and click the 'Verify mobile' button.</p>";return b+='<div class="fc-sms-verification-submit"><input class="fc-fieldinput" type="text" placeholder="Enter verification code..."></div>',$(".fc-modal .modal-header h2").text("Success!"),$(".fc-modal .modal-body").html(b),$(".fc-modal .modal-footer .fc-btn-add").text("Verify").show(),$(".fc-modal").addClass("fc-show"),!1},registerSmsVerificationListeners=function(){fc.domContainer.on("click",".fc-sms-verification .fc-send-sms input[type="+fc.config.buttonInputType+"]",function(){var a,b,c=$(this).parent();return c.find(".fc-loading").removeClass("fc-hide"),c.parent().addClass("loading"),b=c.parent().attr("fc-belongs-to"),a={field:b},api("verification/callback",a,"POST",function(a){c.find(".fc-loading").addClass("fc-hide"),c.parent().removeClass("loading"),"object"==typeof a&&void 0!==a.success&&a.success&&(fc.config.verificationModal&&showSmsVerificationModal(b),waitForVerification(b))}),!1}),fc.domContainer.on("click",".fc-sms-verification.fc-verify-inline .fc-sms-verification-verify",function(){var a,b=$(this),c=b.parent().parent(),d=c.attr("fc-belongs-to"),e=c.find('input[type="text"], input[type="tel"], input[type="number"]'),f=e.val();return 0===f.length?(c.addClass("error"),void e.attr("placeholder",fc.lang.verificationErrorPrefix+fc.lang.verificationEmptyCode)):(a={fieldId:d,code:f},c.removeClass("error").addClass("loading"),e.attr("placeholder",""),api("verification/verify",a,"POST",function(a){if("object"==typeof a){var b=a.message||"";c.removeClass("loading"),e.val("").attr("placeholder",fc.lang.verificationErrorPrefix+b),"object"!=typeof a||void 0===a.success?c.addClass("error"):a.success||"string"!=typeof a.message?a.success&&("preVerification"===d?preVerificationComplete():($('[fc-data-group="'+d+'"]').addClass("fc-verified"),setVirtualValue(d,a.verificationCode),valueChanged(d,a.verificationCode,!0))):c.addClass("error"),$(".fc-modal .modal-footer .fc-loading").addClass("fc-hide")}}),!1)}),fc.domContainer.on("click",".fc-sms-verification-modal",function(){var a=$(this).attr("data-for");return showSmsVerificationModal(a),!1}),fc.processedActions[fc.processes.smsListeners]=!0},renderSmsVerification=function(a){processed(fc.processes.smsListeners)||registerSmsVerificationListeners();var b="",c=fc.fields[getId(a)],d=validVerificationResult(c),e=getConfig(a,"renderAsModal",!0)?"fc-verify-as-modal":"fc-verify-inline",f=getConfig(a,"verificationButtonText","");return d||(b+='<div class="fc-sms-verification '+e+'" fc-belongs-to="'+getId(a)+'">',getConfig(a,"renderAsModal",!0)&&f.length>0?b+='<div class="fc-verify-sms"><input class="fc-btn fc-sms-verification-modal" data-for="'+getId(a)+'" type="'+fc.config.buttonInputType+'" value="'+f+'"></div>':(b+='<div class="fc-sms-loader fc-loader"></div>',b+='<div class="fc-verify-sms-input-code"><input type="tel" class="fc-verify-sms-input fc-fieldinput" value=""></div>',b+='<div class="fc-verify-sms-button"><input class="fc-btn fc-sms-verification-verify" data-for="'+getId(a)+'" type="'+fc.config.buttonInputType+'" value="'+fc.lang.verify+'"></div>'),b+='<div class="fc-send-sms">',b+='<input class="fc-btn" type="'+fc.config.buttonInputType+'" value="'+fc.lang.sendSms+'"><div class="fc-loading fc-hide"></div>',getConfig(a,"renderAsModal",!1)&&(b+='<div class="fc-clear fc-verification-options">',b+='<p><small>Already have a verification code? Click <a href="#" class="fc-sms-verification-modal" data-for="'+getId(a)+'">here</a> to validate.</small></p>',b+="</div>"),b+="</div>",b+="</div>"),b+='<div class="fc-success'+(d?" fc-force-show":"")+'">',b+=fc.lang.fieldValidated,b+="</div>",!d&&void 0===c&&getConfig(a,"autoDeliverOnFirstRender",!1)&&api("verification/callback",{field:getId(a)},"POST",function(b){"object"==typeof b&&void 0!==b.success&&b.success&&(getConfig(a,"autoShowModalDialog",!1)&&showEmailVerificationModal(getId(a)),waitForVerification(getId(a)),forceUpdateFieldValue(getId(a),"0"))}),b},renderReviewTableString=function(a,b){var c,d,e,f="";if(void 0===a||!a.type)return"";if(["emailVerification","smsVerification","signature","creditCard"].indexOf(a.type)>-1)return"";if(getConfig(a,"readOnly",!1))return"";if(f+="<tr><td>"+getShortLabel(a)+"</td><td>",["[","{"].indexOf(b.substring(0,1))>-1)try{c=$.parseJSON(b),b=c}catch(g){}if("string"==typeof b)f+=a.config.class?a.config.class.indexOf("fc-input-symbol-dollar")>-1?'<span class="'+a.config.class+'">$ '+htmlEncode(b)+"</span>":a.config.class.indexOf("fc-input-symbol-percent")>-1?'<span class="'+a.config.class+'">'+htmlEncode(b)+" %</span>":'<span class="'+a.config.class+'">'+htmlEncode(b)+"</span>":htmlEncode(b);else if("object"==typeof b){for(f+="<ul class='fc-list'>",d=0;d<b.length;d+=1)e=b[d],f+="<li>"+htmlEncode(e)+"</li>";f+="</ul>"}return f+="</td></tr>"},renderReviewTableArray=function(a,b){var c,d,e,f,g,h="";for(c=0;c<b.length;c+=1)if("object"==typeof b[c]){h+="<tr><th colspan='2'>"+htmlEncode(getShortLabel(a))+"</th></tr>";for(e in b[c])if(b[c].hasOwnProperty(e)&&Array.isArray(b[c][e])&&b[c][e].length>0){e.indexOf(fc.constants.prefixSeparator)>-1?(d=e.split(fc.constants.prefixSeparator),f=d[d.length-1]):f=e;var g=fc.fieldSchema[f];if("undefined"==typeof g&&"object"==typeof a&&"object"==typeof a.config&&"undefined"==typeof a.config.grouplet)for(var i in a.config.grouplet.field)if(a.config.grouplet.field.hasOwnProperty(i)){
var j=a.config.grouplet.field[i],k=getId(j);"undefined"==typeof fc.fieldSchema[k]&&(fc.fieldSchema[k]=j)}g=fc.fieldSchema[f],"object"==typeof g&&"object"==typeof g.config&&(h+="<tr><td>"+getShortLabel(fc.fieldSchema[f]),h+='</td><td><span class="'+fc.fieldSchema[f].config.class+'">'+htmlEncode(b[c][e])+"</span></td></tr>")}}return h},renderReviewTableGrouplet,renderSummaryField,renderReviewTable=function(fieldId,callback){var html="",stageIterator,stage,pageIterator,page,sectionIterator,section,fieldIterator,field,pageHtml,fieldHtml;for(html+='<div class="fc-form-summary fc-review-table">',html+='<table class="fc-table"><thead><tr><th class="fc-field-col">Field</th><th>Value</th></tr></thead><tbody>',stageIterator=0;stageIterator<fc.schema.stage.length;stageIterator+=1)if(stage=fc.schema.stage[stageIterator],void 0!==stage&&void 0!==stage.page&&"object"==typeof stage.page)for(pageIterator=0;pageIterator<stage.page.length;pageIterator+=1)if(page=stage.page[pageIterator],void 0!==page&&void 0!==page.section&&"object"==typeof page.section){for(pageHtml="",sectionIterator=0;sectionIterator<page.section.length;sectionIterator+=1)if(section=page.section[sectionIterator],void 0!==section&&void 0!==section.field&&"object"==typeof section.field)for(fieldIterator=0;fieldIterator<section.field.length;fieldIterator+=1){field=section.field[fieldIterator];var visible=function(visibilityLogic){var parsedLogic;if(util.isEmpty(visibilityLogic))return!0;try{parsedLogic=JSON.parse(visibilityLogic)}catch(ignore){}return!("undefined"==typeof parsedLogic||!util.isEmpty(parsedLogic))||eval(getBooleanLogic(visibilityLogic))}(getConfig(field,"visibility",""));visible&&(fieldHtml=$("<div></div>").append(renderSummaryField(field)),fieldHtml.find("tr").length>0&&fieldHtml.find("tr").attr("data-page",getId(page)).attr("data-section",getId(section)).attr("data-id",getId(field)),pageHtml+=fieldHtml.html())}pageHtml.length>0&&(html+="<tr><th colspan='2' data-page="+getId(page)+">"+tokenise(htmlEncode(page.label))+"</th></tr>",html+=pageHtml)}return html+="</tbody></table></div>"},getSaveQueue=function(a){a===!0&&Object.keys(fc.saveQueue).forEach(function(a){0===a.length&&delete fc.saveQueue[a]})},isSubmitPage=function(a){return"object"==typeof a&&void 0!==a.completion&&(a.completion===!0||"string"==typeof a.completion&&["1","true"].indexOf(a.completion.toLowerCase())!==-1)},deleteSession=function(a){"boolean"!=typeof a&&(a=!0);for(var b=0;b<fc.intervals.length;b+=1)clearInterval(fc.intervals[b]);fc.intervals=[],$.removeCookie(fc.config.sessionIdName),a&&($(fc.jQueryContainer+" .render").html(fc.lang.sessionExpiredHtml),fc.domContainer.trigger(fc.jsEvents.onFormExpired)),fc.expired=!0},timeout=function(){if(fc.config.timeUserOut===!0){var a,b=(new Date).getTime()-fc.lastActivity;b>1e3*fc.config.timeOutAfter?deleteSession():b>1e3*fc.config.timeOutWarning&&(a=confirm("Your session is about to expire. Do you want to extend your session?"),b=(new Date).getTime()-fc.lastActivity,a===!0&&b<1e3*fc.config.timeOutAfter?api("page/ping",{},"put",function(a){"object"==typeof a&&a.success===!0&&(fc.lastActivity=(new Date).getTime())}):deleteSession())}},nextVisibleField=function(a,b){var c,d=!1;return"boolean"!=typeof b&&(b=!0),$(".fc-section:not(.fc-hide) div.fc-field:not(.fc-hide)").each(function(){var e=$(this).attr("fc-data-group");if(!d&&e===a)return void(d=!0);if(d&&!c){if(b&&!fc.fields[e])return void(c=e);b||(c=e)}}),c},smoothScrollToPage=function(a){var b,c;fc.lastCompletedField&&fc.fieldSchema[fc.lastCompletedField]&&!getConfig(fc.fieldSchema[fc.lastCompletedField],"allowAutoScroll",!0)||fc.activeScroll.length>0||(fc.activeScroll=a,c=$(".fc-page:last"),c.length>0&&c.attr("data-page-id")===a&&(b=parseInt(c.offset().top,10)+parseInt(fc.config.scrollOffset,10),0===$(document).scrollTop()&&(b+=fc.config.initialScrollOffset),void 0!==fc.config.conditionalHtmlScrollOffset.class&&$("html").hasClass(fc.config.conditionalHtmlScrollOffset.class)&&(b+=fc.config.conditionalHtmlScrollOffset.offset),scrollToOffset(b)))},validateAbn=function(a,b,c){var d=function(a){if("string"==typeof a)try{a=$.parseJSON(a)}catch(b){}c&&"function"==typeof c&&c(a)};api("verification/abn",{abn:b},"POST",d)},setFieldSchemas=function(a){var b,c;if("object"==typeof a){if(a.config&&a.type&&a._id&&a._id.$id)return void(fc.fieldSchema[getId(a)]=a);if("object"==typeof a)for(b in a)a.hasOwnProperty(b)&&(c=a[b],"object"==typeof c&&setFieldSchemas(c))}},autoScrollToField=function(a,b){var c,d,e;if(void 0!==b)c=$('.fc-field[fc-data-group="'+b+'"]'),c&&c.length>0&&(e=c.attr("fc-belongs-to"),e!==$('.fc-field[fc-data-group="'+a+'"]').attr("fc-belongs-to")&&(c=$('.fc-section[formcorp-data-id="'+e+'"]')),c&&c.length>0&&(d=parseInt(c.offset().top,10)+fc.config.scrollOffset,parseInt($(document).scrollTop(),10)<d&&scrollToOffset(d)));else{try{c=$('.fc-field[fc-data-group="'+a+'"]')}catch(f){}void 0!==c&&c&&0!==c.length||(c=$(a)),c&&c.length>0&&(d=parseInt(c.offset().top,10)+fc.config.scrollOffset,scrollToOffset(d))}},sessionRequiresVerification=function(a){return"object"==typeof a&&"object"==typeof a.verify&&a.verify.perform===!0},getTokens=function(){var a=$.extend({},getFieldTagValues(),fc.languagePacks);return a},stringHasTokens=function(a){var b=a.match(/\{\{[a-zA-Z\_\-0-9\.]+\}\}/g);return"object"==typeof b&&$.isArray(b)&&b.length>0},tokenise=function(a,b,c){b||(b={}),"boolean"!=typeof c&&(c=!0);var d,e,f,g,h=a,i=a.match(/\{\{([a-zA-Z0-9-_.]+)\}\}/g),j=0,k=getTokens(),l="";if(i&&$.isArray(i)&&i.length>0)for(j=0;j<i.length;j+=1){for(d=i[j].replace(/[\{\}]+/g,""),e=d.split(fc.constants.tagSeparator),g=k,f=0;f<e.length&&(g=g[e[f]],"object"==typeof g);f++);l=void 0!==g?g:"",stringHasTokens(l)&&(l=tokenise(l)),c&&(l='<span class="fc-token" data-token="'+htmlEncode(d)+'">'+l+"</span>"),h=h.replace(new RegExp(i[j].escapeRegExp(),"g"),l)}return h},fieldIsVisible=function(a){var b;return"string"==typeof a&&a.length>0&&(b=$('.fc-field[fc-data-group="'+a+'"]'),b.length>0&&!b.hasClass("fc-hide"))},scrollToFirstError=function(){var a,b,c=fc.domContainer.find(".fc-field.fc-error");c.length>0&&c.each(function(){void 0===b&&(a=$(this).attr("fc-data-group"),fieldIsVisible(a)&&(b=a))}),void 0!==b&&autoScrollToField(b)},showModal=function(a){var b={addButton:!0,closeButton:!0,className:"",body:"",title:fc.lang.defaultModalTitle||!1,addButtonText:fc.lang.addModalText,closeButtonText:fc.lang.closeModalText},c=$.extend({},b,a),d={addButton:fc.domContainer.find(".fc-modal .modal-footer .fc-btn-add"),closeButton:fc.domContainer.find(".fc-modal .modal-footer .fc-btn-close")};"string"==typeof c.className&&($(".fc-modal").get(0).className="fc-modal "+c.className),d.addButton.length>0&&d.addButton.html(c.addButtonText),d.closeButton.length>0&&d.closeButton.html(c.closeButtonText),c.addButton===!1?d.addButton.hide():d.addButton.show(),c.closeButton===!1?d.closeButton.hide():d.closeButton.show(),c.title?$(".fc-modal .modal-header h2").text(c.title):$(".fc-modal .modal-header h2 ").hide(),$(".fc-modal .modal-body").html(c.body),$(".fc-modal").addClass("fc-show")},initGreenIdDOMFields=function(){if(void 0!==fc.greenID){var a=fc.domContainer.find(".fc-field-greenIdVerification");a.length>0&&a.each(function(){var a=$(this),b=a.attr("fc-data-group"),c=a.attr("fc-belongs-to");if(!(a.hasClass("fc-hide")||fc.domContainer.find('[formcorp-data-id="'+c+'"]').hasClass("fc-hide")||fcGreenID.initialised.indexOf[b]>=0)){var d=fcGreenID.getSession(b);"object"==typeof d&&d.init(!0,b)}})}},initGreenId=function(){"boolean"==typeof fc.initialisedGreenId&&fc.initialisedGreenId||(fc.domContainer.on(fc.jsEvents.onGreenIdLoaded,function(){fc.greenID=fcGreenID,fc.greenID.init(),initGreenIdDOMFields()}),fc.initialisedGreenId=!0)},flushActivePageForField=function(a,b){var c,d,e=!1;"boolean"!=typeof b&&(b=!1),d=getFieldPageId(a,b),"string"!=typeof d||0===d.length||d.indexOf(fc.constants.prefixSeparator)>-1||(fc.currentPage=d,$('.fc-page[data-page-id="'+fc.currentPage+'"] .fc-pagination').show(),$(".fc-page").each(function(){c=$(this).attr("data-page-id"),e&&c!==fc.currentPage?$(this).remove():c===fc.currentPage&&(e=!0)}),fc.pageOrders.indexOf(fc.currentPage)!==fc.pageOrders.length-1&&(fc.pageOrders=fc.pageOrders.splice(0,fc.pageOrders.indexOf(fc.currentPage)+1)))},setFormState=function(a){var b=fc.formState;fc.formState=a,fc.domContainer.attr("data-form-state",a),fc.domContainer.find("[data-form-state]").attr("data-form-state",a),fc.domContainer.trigger(fc.jsEvents.onFormStateChange,[a,b])},addTag=function(a){"undefined"==typeof fc.tags&&(fc.tags=[]),"string"==typeof a&&fc.tags.indexOf(a)===-1&&fc.tags.push(a)},removeTag=function(a){if("undefined"!=typeof fc.tags){var b;"string"==typeof a&&(b=fc.tags.indexOf(a))>=0&&fc.tags.splice(b,1)}},setTags=function(a){$.isArray(a)&&(fc.tags=a)},getTags=function(){return"undefined"==typeof fc.tags&&(fc.tags=[]),fc.tags},objectHasTag=function(a,b){return"string"!=typeof b&&(b="tags"),"object"==typeof a&&"object"==typeof a[b]&&$.isArray(a[b])&&a[b].length>0},hasTag=function(a){return"string"==typeof a&&"undefined"!=typeof fc.tags&&(0===a.length||fc.tags.indexOf(a)>=0)},hasTags=function(a){if("object"!=typeof a||!$.isArray(a)||"undefined"==typeof fc.tags)return!1;for(var b=a.length;b;)if(!hasTag(a[--b]))return!1;return!0},haveTags=function(){return"object"==typeof fc.tags&&fc.tags.length>0},setVirtualValue=function(a,b,c,d,e){if(log("setVirtualValue"),log(a),log(b),"undefined"==typeof e&&(e=fc.config.realTimeValidation),"boolean"!=typeof d&&(d=!1),"object"!=typeof c&&(c=fc.fields),"string"==typeof a&&a.length>0&&!$.isNumeric(a)){a=a.replace("_rootSelection","");var f=a.split(fc.constants.prefixSeparator),g=c,h=a;if(f.length>1){for(var i=f[0],j=fc.fieldSchema[i],k=0;k<f.length-1;k++){var l=f[k];("undefined"==typeof g[l]||k<f.length-1&&"object"!=typeof g[l])&&("undefined"==typeof l||getConfig(j,"repeatable",!1)&&!$.isNumeric(l)?g[l]=[]:g[l]={}),g=g[l],e&&!getConfig(j,"repeatable",!1)&&validForm($('.fc-field[fc-data-group="'+l+'"]'))}h=f[f.length-1],fc.config.saveInRealTime&&(fc.saveQueue[f[0]]=c[f[0]])}else fc.config.saveInRealTime&&(fc.saveQueue[a]=b);if(g[h]=b,e&&validForm($('.fc-field[fc-data-group="'+h+'"]')),d)try{var m=fc.fieldSchema[h];"object"==typeof m&&prepopulate(m,b)}catch(n){}}},getPreviousPages=function(a){"object"!=typeof a&&(a=fc);for(var b=[],c=a.currentPage;a.prevPages[c];)b.push(a.prevPages[c]),c=a.prevPages[c].page._id.$id;return b||[]},getPreviousPage=function(a,b){"object"!=typeof b&&(b=fc),"string"!=typeof a&&(a=b.currentPage);var c=(Object.keys(b.fields),Object.keys(b.prevPages));return!!Array.isArray(c)&&(!(c.length<1)&&("object"==typeof b.prevPages[a]&&b.prevPages[a].page._id.$id))},getNextPages=function(a){"undefined"==typeof a&&(a=fc.currentPage);for(var b=[],c=nextPage(!1,!0,getPageById(a));c&&"0"===c.page.completion;)b.push(c),c=nextPage(!1,!0,c.page._id.$id);return b},setCompletionCondition=function(a,b){b()&&render(a)},updateMobileFieldsVisibility,renderGrouplet,getNumericTagValue,outputRepeatablePreDetermined,renderFields,renderPageSections,generateRandomString,loadCssFiles,addModalWindow,pruneNonPageFields,removeInvisibleSectionFields,pruneInvisibleFields,fieldIsValid,formFieldsValid,checkAutoLoad,getFirstPageId,getFirstPage,loadSettings,initRender,autoLoadLibs,setSchemaData,verifySession,preVerificationComplete,loadSchema,hasNextPage,loadNextPage,loadPrevPage,processSaveQueue,showDeleteDialog,showRepeatableEditDialog,addRepeatableRow,editRepeatableRow,deleteRepeatableRow,registerRepeatableGroupletListeners,registerOnePageListeners,registerEventListeners,nextPage,render,afterRender,renderPage,flushVisibility,flushRepeatableGroupletVisibility,flushSectionVisibility,flushFieldVisibility,setValueUpdate,setFileUploadUpdate,registerValueChangedListeners,valueChanged,validateModal,orderSchema,renderSignature,loadSignatureLibs,orderObject,renderRepeatableIterator,renderApiLookupField,initGreenIdFieldInDOM,greenIdFieldHeader,renderGreenIdField,renderIDMatrixField,renderNumericSliderField,validateMatrixField,loadMatrixFieldValues,parseMatrixField,buildMatrixTable,renderMatrixField,isValidFile,validateFileUpload,evaluateRequiredLogic,getDefaultValue,deleteFileUpload,renderFileUpload,buildFileList,renderDigitalSignatureField,renderDateField,renderDownloadField,registerDownloadListeners,registerDeleteFileListeners,registerRemoveFileErrorListeners,downloadFieldFile,renderCustomerRecord,registerApiLookupListener,renderAutoCompleteWidget,removeAutoCompleteWidget,moveSelectionAutoCompleteWidget,enterSelectionAutoCompleteWidget,selectRowAutoCompleteWidget,getPagesByTag,progressBar,progressBarFactory,progressBarStickClass,progressBarPristineClass,progressBarUnstickClass,progressBarBodyStickClass,progressBarOffset,getCurrentSection,setCurrentSection,util;progressBarFactory=function(a,b){return{schema:a,hash:function(a){var b={},c=0;for(var d in a){c++;for(var e in a[d])b[e]={label:a[d][e]||d,index:c,step:a[d]}}return b}(a),getStep:function(a){return!!this.hash[a]&&{label:this.hash[a].label,step:this.hash[a].index}},stepCount:function(a){var b=0;for(var c in a)b++;return b}(a),stickynessTimeout:!1,progressBarStick:b.progressBarStick,progressBarStickClass:b.progressBarStickClass,progressBarPristineClass:b.progressBarPristineClass,progressBarUnstickClass:b.progressBarUnstickClass,progressBarBodyStickClass:b.progressBarBodyStickClass,progressBarOffset:b.progressBarOffset,scrollInterval:!1,sectionChangeEventHandler:!1,destroy:function(){fc.domContainer.off(fc.jsEvents.onSectionChange,this.updateSection.bind(this)),this.$barContainer.remove()},init:function(){this.renderContainer(),this.renderProgress(),this.setPage(getFirstPageId()),b.sectionManagement&&fc.domContainer.on(fc.jsEvents.onSectionChange,function(){fc.progressBar.updateSection()}),this.progressBarStick&&$window.scroll(function(){$(".fc-progress-bar-container:visible").length>0&&(this.stickynessTimeout&&clearTimeout(this.stickynessTimeout),this.stickynessTimeout=setTimeout(function(){return $window.scrollTop()<this.progressBarOffset||0==$window.scrollTop()||$window.scrollTop()>$("#formcorp-form").offset().top+$("#formcorp-form").height()?($(".fc-progress-bar-container").removeClass(this.progressBarStickClass+" "+this.progressBarPristineClass).addClass(this.progressBarUnstickClass),void $("body").removeClass(this.progressBarBodyStickClass)):void(!$(".fc-progress-bar-container").hasClass(this.progressBarStickClass)&&$window.scrollTop()>=$(".fc-progress-bar-container").offset().top&&(this.progressBarOffset=$(".fc-progress-bar-container").offset().top,$(".fc-progress-bar-container").addClass(this.progressBarStickClass).removeClass(this.progressBarPristineClass+" "+this.progressBarUnstickClass),$("body").addClass(this.progressBarBodyStickClass)))}.bind(this),10))}.bind(this))},setPage:function(a){this.currentPage=getPageById(a),this.currentStep=this.getStep(a),this.$barContainer.show(),this.currentStep||fc.config.hideProgressBarIfPageNotInSchema&&this.$barContainer.hide(),this.currentStepNumber=this.currentStep.step,this.$stepCount.html("Step "+this.currentStepNumber+" of "+this.stepCount+": "+this.currentStep.label),this.render(),this.update(this.currentStepNumber,this.stepCount,this.currentStep.label)},updateSection:function(){if(fc.config.sectionManagement){var a=this.currentStepNumber-1,b=this.stepCount,c=a/(b-1)*100,d=$(".fc-current-section"),e=$(".fc-page-"+this.currentPage.page._id.$id).find(".fc-section:visible"),f=e.index(d)+1,g=$(".fc-page-"+this.currentPage.page._id.$id).find(".fc-section:visible").length+1;this.currentStepNumber<this.stepCount?c+=100/(b-1)/g*f:c=100,this.$path.css({width:c+"%"})}},$barContainer:null,$bar:null,$stepCount:null,$currentStep:null,$stepsBar:null,$path:null,renderContainer:function(){this.$stepCount=$('<div class="fc-step-count"></div>'),this.$stepsBar=$('<div class="fc-steps-bar"></div>'),this.$bar=$('<div class="fc-progress-bar"></div>'),this.$progress=$('<div class="fc-progress"></div>'),this.$path=$('<div class="fc-complete-path"></div>'),this.$barContainer=$('<div class="fc-progress-bar-container"></div>').append(this.$stepCount).append(this.$bar.append(this.$stepsBar).append(this.$progress)),fc.domContainer.prepend(this.$barContainer)},render:function(){var a="",b=0;for(var c in this.schema)a+=this.renderSteps(b,this.stepCount,c),b++;this.$stepsBar.html(a)},update:function(a,b,c){a--;var d=a/(b-1)*100,e=function(c){return 0===a||a===b-1?-50:c}(d-100);this.$currentStep.css({left:d+"%",transform:"translate("+e+"%, 0px)"}),this.$currentStep.find(".progress-bar-label").html(c),this.updateSection()},groupLabelAlignment:function(a,b){return a<b/2?"fc-pb-group-label-pull-right":"fc-pb-group-label-pull-left"},renderProgress:function(){this.$currentStep=$('<div class="progress-bar-group progress-bar-current-group"><span class="progress-bar-label"></span></div>'),this.$progress.html(this.$currentStep).prepend(this.$path)},groupStatusClasses:function(a,b){return a++,a<b?"progress-bar-group complete":"progress-bar-group uncomplete"},renderSteps:function(a,b,c){var d=a/(b-1)*100,e=function(c){return 0===a||a===b-1?-50:c}(d-100);return'<div style="left:'+d+"%;transform:translateX("+e+'%)" class="'+this.groupStatusClasses(a,this.currentStepNumber)+" "+this.groupLabelAlignment(a,b)+'"><span class="progress-bar-label">'+c+"</span></div>"}}},getPagesByTag=function(a){return function(b){return a.stage.reduce(function(a,c){return a.concat(function(a){return a.page.filter(function(a){return fc.util.inArray(a.tags)(b)})}(c))},[])}},util={inArray:function(a){return Array.isArray(a)?function(b){return a.length>0&&a.filter(function(a){return b===a}).length>0}:function(){return!1}},arrayFrom:function(a){var b=[];for(var c in a)b.push(a[c]);return b},trim:function(a){return"string"!=typeof a?a:a.trim()},isEmpty:function(a){return"undefined"==typeof a||("string"==typeof a?0===a.length:"object"==typeof a?null===a||(Array.isArray(a)?0===a.length:0===Object.keys(a).length):"boolean"==typeof a?a:"number"==typeof a?!isNaN(a):!a)},isNotEmpty:function(a){return!this.isEmpty(a)},intersectArray:function(a,b){return a.filter(function(a){return b.filter(function(b){return a===b}).length>0})}},loadSignatureLibs=function(){var a;fc.domContainer.on(fc.jsEvents.onFinishRender,function(){var b;a=fc.domContainer.find("."+fc.config.signatureClass),a.length>0&&a.each(function(){b=$(this).attr("data-for"),fc.renderedSignatures[b]=$(this).signaturePad({drawOnly:!0,onDrawEnd:function(){var a,b;for(a in fc.renderedSignatures)fc.renderedSignatures.hasOwnProperty(a)&&(b=fc.renderedSignatures[a].getSignatureString(),void 0!==fc.fields[a]&&fc.fields[a]===b||valueChanged(a,b))}}),void 0!==fc.fields[b]&&fc.fields[b].length>0&&fc.renderedSignatures[b].regenerate(fc.fields[b])})}),fc.processedActions[fc.processes.loadSignatureLibs]=!0},renderSignature=function(a,b){var c="";return processed(fc.processes.loadSignatureLibs)||loadSignatureLibs(),c='<div class="'+fc.config.signatureClass+'" formcorp-data-id="'+b+getId(a)+'" data-for="'+b+getId(a)+'"> <ul class="sigNav"> <li class="clearButton"><a href="#clear">Clear</a></li> </ul> <div class="sig sigWrapper"> <div class="typed"></div> <canvas class="pad" width="400" height="75"></canvas> <input type="hidden" name="output" class="output"> </div></div>'},renderReviewTableGrouplet=function(a,b,c,d){var e,f="";isNaN(parseInt(d))||(d++,"string"==typeof c&&(f+="<tr><th colspan='2'>"+c.replace(/ ?grouplet ?$/i,"")+" "+d+"</th></tr>"));for(e in b)b.hasOwnProperty(e)&&(f+=renderSummaryField(fc.fieldSchema[e],b[e],c,e));return"object"==typeof a?f+'<tr><th colspan="2" class="fc-end-of-grouplet"></th></tr>':f},renderSummaryField=function(a,b,c,d){var e,f,g,h="";return e=getId(a),void 0===b&&(b=getConfig(a,"isPassword",!1)?fc.lang.passwordHidden:fc.fields[e]),void 0!==b&&(f="object"==typeof b&&($.isArray(b)&&b.length>0||!$.isEmptyObject(b)),g="string"==typeof b&&b.length>0,(f||g)&&(g?h+=renderReviewTableString(a,b):f&&($.isArray(b)&&"grouplet"!==a.type?h+=renderReviewTableArray(a,b):("object"==typeof a&&(c=getShortLabel(a)),h+=renderReviewTableGrouplet(a,b,c,d))))),h},renderGrouplet=function(a){var b,c=a._id.$id,d="";return"object"==typeof a.config.grouplet&&(b=a.config.grouplet.field,d+=renderFields(b,a,[c])),getConfig(a,"repeatable",!1)===!0&&(d='<div class="fc-data-repeatable-grouplet" formcorp-data-id="'+c+'">'+d+"</div>"),d},getNumericTagValue=function(a){var b;return $.isNumeric(a)?a:(b=getFieldTagValues(),"object"==typeof b&&"undefined"!==b[a]&&$.isNumeric(b[a])?b[a]:0)},outputRepeatablePreDetermined=function(a,b,c){var d,e="",f="",g=fc.fieldSchema[a];getFieldTagValues();$.isNumeric(b)||(void 0===fc.reRenderOnValueChange[b]&&(fc.reRenderOnValueChange[b]=[]),fc.reRenderOnValueChange[b].indexOf(getId(g))<0&&fc.reRenderOnValueChange[b].push(getId(g))),void 0!==b&&$.isNumeric(b)||(b=getNumericTagValue(b));var h=getValue(a);if("object"==typeof h&&$.isArray(h)&&h.length>b&&(h.splice(b,h.length-b),setVirtualValue(a,h)),void 0===g.config)return e;if(void 0!==g.config.grouplet&&"object"==typeof g.config.grouplet&&void 0!==g.config.grouplet.field)for(d=0;d<b;d+=1)f=renderFields(g.config.grouplet.field,c,[a,d,""].join(fc.constants.prefixSeparator)),e+='<div class="fc-repeatable-row fc-row-'+(d+1)+'">',e+=f,e+='<div class="fc-end-repeatable-row"></div>',e+="</div>",e=e.replace(/\{iterator\}/gi,d+1,e);return e},renderFields=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y="",z=!0;if("boolean"!=typeof d&&(d=!1),void 0===c?c="":"object"==typeof c&&(c=c.join(fc.constants.prefixSeparator)+fc.constants.prefixSeparator),c.length>0)for(m=c.substr(-1)===fc.constants.prefixSeparator?c.substr(0,c.length-1):c,f=0;f<a.length;f+=1)g=a[f],fc.fieldGrouplets[m]||(fc.fieldGrouplets[m]=[]),fc.fieldGrouplets[m].indexOf(getId(g))===-1&&fc.fieldGrouplets[m].push(getId(g));for(f=0;f<a.length;f+=1){if(g=a[f],h=getConfig(g,"required",!1),l=c+getId(g),i='<div class="',d&&(fc.withinIterator[l]=!0),getConfig(g,"tag","").length>0&&(i+="fc-tag-"+getConfig(g,"tag","")+" "),getConfig(g,"repeatable",!1)===!0&&(i+="fc-repeatable-container "),getConfig(g,"mobileOnly",!1)===!0?i+="fc-mobile-field ":getConfig(g,"desktopOnly",!1)===!0&&(i+="fc-desktop-field "),x=getConfig(g,"class",""),x.length>0&&(x=tokenise(x,{},!1),i+=x+" "),p=getValue(l,!1),"boolean"==typeof p&&!p){var A=getConfig(g,"default",!1);"string"==typeof A&&A.length>0&&setVirtualValue(l,A)}if(i+="fc-field fc-field-"+g.type+'" fc-data-group="'+l+'" data-required="'+h+'" data-field-count="'+fc.fieldCount+'" data-form-state="'+fc.formState+'"',void 0!==b&&"object"==typeof b&&(i+=' fc-belongs-to="'+getId(b)+'"'),i+=">",c&&c.length>0&&getConfig(g,"visibility","").length>0&&!d&&(n=getConfig(g,"visibility"),o=n.match(/"([a-zA-Z0-9]{24})"/g),o&&o.length>0))for(q=0;q<o.length;q+=1)r=o[q].replace(/"/g,""),w=c+r,fc.fieldGrouplets[m].indexOf(r)>=0&&g.config.visibility.indexOf(w)<0&&(s=new RegExp(r,"g"),g.config.visibility=g.config.visibility.replace(s,w));k=l,void 0===fc.fieldSchema[k]&&(fc.fieldSchema[k]=g),["creditCard"].indexOf(g.type)===-1&&fc.config.descriptionBeforeLabel===!0&&getConfig(g,"description").replace(/(<([^>]+)>)/gi,"").length>0&&(i+='<div class="fc-desc">'+getConfig(g,"description")+"</div>");var B=function(a){return"string"==typeof a&&a.length>0?"fc-filled":"fc-pristine"}(getValue(util.isEmpty(getValue(g._id.$id))?getConfig(g,"populateFrom",""):g._id.$id));switch(i+='<div class="fc-fieldcontainer '+B+'">',t="",["creditCard"].indexOf(g.type)===-1&&(i+='<label for="fc-field-'+g._id.$id+'" class="'+(getConfig(g,"showLabel",!1)===!0&&getConfig(g,"label","").length>0?"":"fc-hide")+'">',getConfig(g,"showLabel",!1)===!0&&getConfig(g,"label","").length>0?(i+=tokenise(g.config.label),fc.config.colonAfterLabel&&(i+=fc.lang.labelColon)):fc.config.renderEmptyLabels&&(i+="&nbsp;"),fc.config.asterisksOnLabels&&getConfig(g,"required",!1)&&(i+='<span class="fc-required-caret">'+fc.lang.requiredAsterisk+"</span>"),fc.config.helpAsModal&&getConfig(g,"help").replace(/(<([^>]+)>)/gi,"").length>0&&(void 0===fc.helpData&&(fc.helpData=[],fc.helpTitle=[]),t=getConfig(g,"helpTitle",""),0===t.length&&fc.config.helpDefaultWhenNoTitleText===!1&&(t=fc.lang.helpModalLink),t.length>0?(fc.helpData.push(getConfig(g,"help")),fc.helpTitle.push(t),fc.config.staticHelpModalLink&&(t=fc.lang.helpModalLink),z=!1,i+=' <a class="fc-help-link" tabindex="-1" href="#" data-for="'+(fc.helpData.length-1)+'">'+t+"</a>"):z=!0),i+="</label>",fc.config.descriptionBeforeLabel===!1&&getConfig(g,"description").replace(/(<([^>]+)>)/gi,"").length>0&&(i+='<div class="fc-desc">'+tokenise(getConfig(g,"description"))+"</div>")),getConfig(g,"repeatable",!1)===!0&&(v=parseInt(getConfig(g,"repeatableStyle",0)),i+='<div class="fc-repeatable',parseInt(v)===parseInt(fc.constants.repeatablePredetermined)&&(i+=" fc-repeatable-predetermined"),fc.constants.repeatableInDOM.indexOf(parseInt(v))>=0&&(i+=" fc-repeatable-in-dom"),i+='">',getConfig(g,"renderRepeatableTable",!1)&&(i+='<div class="fc-summary"></div>')),i+='<div class="fc-fieldgroup">',i+='<div class="fc-field-element-container">',g.type){case"text":j=renderTextfield(g,c);break;case"dropdown":j=renderDropdown(g,c);break;case"textarea":j=renderTextarea(g,c);break;case"radioList":j=renderRadioList(g,c);break;case"checkboxList":j=renderCheckboxList(g,c);break;case"hidden":j=renderHiddenField(g,c);break;case"richTextArea":j=renderRichText(g,c);break;case"grouplet":j=renderGrouplet(g,c);break;case"creditCard":j=renderCreditCard(g,c);break;case"emailVerification":j=renderEmailVerification(g,c);break;case"smsVerification":j=renderSmsVerification(g,c);break;case"reviewTable":j=renderReviewTable(g,c);break;case"signature":j=renderSignature(g,c);break;case"contentRadioList":j=renderContentRadioList(g,c);break;case"optionTable":j=renderOptionTable(g,c);break;case"abnVerification":j=renderAbnField(g,c);break;case"repeatableIterator":j=renderRepeatableIterator(g,c,b);break;case"apiLookup":j=renderApiLookupField(g,c);break;case"greenIdVerification":j=renderGreenIdField(g,c);break;case"numericSlider":j=renderNumericSliderField(g,c);break;case"matrix":j=renderMatrixField(g,c);break;case"fileUpload":j=renderFileUpload(g,c);break;case"digsigCollect":j=renderDigitalSignatureField(g,c);break;case"groupletReference":j='<div formcorp-data-id="'+c+getId(g)+'" data-reference="'+getConfig(g,"groupletReference")+'"></div>';break;case"fieldReference":j='<div formcorp-data-id="'+c+getId(g)+'" data-reference="'+getConfig(g,"fieldReference")+'"></div>';break;case"formReference":case"functionReference":j="";break;case"customerRecord":j=renderCustomerRecord(g,c);break;case"date":j=renderDateField(g,c);break;case"download":j=renderDownloadField(g,c);break;case"idmatrix":j=renderIDMatrixField(g,c);break;default:log("Unknown field type: "+g.type)}fc.fieldCount+=1,void 0===j||"string"==typeof j&&0===j.length||(i+=j,i+='<div class="fc-lock-icon"><span></span></div>',i+='<div class="fc-success-box"><span></span></div>',i+='<div class="fc-error-box"><span></span></div>',i+="</div>",fc.config.helpAsModal||(z=!0),z&&getConfig(g,"help").replace(/(<([^>]+)>)/gi,"").length>0&&(i+='<div class="fc-help">'+getConfig(g,"help")+"</div>"),i+='<div class="fc-error-text"><i class="fc-error-icon"></i><span></span></div>',getConfig(g,"repeatable",!1)===!0&&(i+="</div>",fc.constants.repeatableInDOM.indexOf(parseInt(v))>=0&&(i+='<div class="fc-repeatable-rows">'),fc.constants.repeatableInDOM.indexOf(parseInt(v))>-1&&(parseInt(v)===fc.constants.repeatablePredetermined?i+=outputRepeatablePreDetermined(getId(g),getConfig(g,fc.constants.repeatableLinkedTo,1),b):(u=void 0!==fc.fields[getId(g)]&&$.isArray(fc.fields[getId(g)])?fc.fields[getId(g)].length:getConfig(g,fc.constants.repeatableLinkedTo,1),i+=outputRepeatablePreDetermined(getId(g),u,b))),fc.constants.repeatableInDOM.indexOf(parseInt(v))>=0&&(i+="</div>")),getConfig(g,"repeatable",!1)&&(0===v.length||fc.constants.repeatableWithButton.indexOf(v)>=0)&&(i+='<div class="fc-link"><a href="#" class="fc-click fc-add" data-id="'+k+'">',i+=getConfig(g,"addButtonText","").length>0?getConfig(g,"addButtonText"):fc.lang.addFieldTextValue,i+="</a></div>",1===parseInt(v)&&(i+='<div class="fc-link"><a href="#" class="fc-click fc-remove',u<=getNumericTagValue(getConfig(g,"repeatableLinkedTo"))&&(i+=" fc-hide"),i+='" data-id="'+k+'">',i+=getConfig(g,"removeButtonText","").length>0?getConfig(g,"removeButtonText"):fc.lang.removeFieldTextValue,i+="</a></div>")),i+='<div class="fc-empty"></div>',i+="</div></div></div>",y+=i)}return y},renderRepeatableIterator=function(a,b,c){void 0===b&&(b="");var d,e,f,g,h,i,j,k,l=(getConfig(a,"required",!1),b+getId(a)),m="",n=getConfig(a,"sourceField","");if(void 0===fc.fields[n])return m;if(d=fc.fields[n],!$.isArray(d)||0===d.length)return"";for(g=getAllFieldTags(),j=getFieldTagValues(),m+='<div class="fc-iterator">',e=0;e<d.length;e+=1){f=fc.fields[n][e];for(h in f)f.hasOwnProperty(h)&&void 0!==g[h]&&(f[g[h]]=f[h]);i=$.extend({},j,f),k='<div class="fc-iterator-row">',k+=renderFields(a.config.targetGrouplet.field,c,[l,e],!0,getId(a)),k+="</div>",k=replaceTokensInDom($(k),i),m+=k.prop("outerHTML")}return m+="</div>"},renderApiLookupField=function(a,b){void 0===b&&(b="");var c="boolean"==typeof a.config.required&&a.config.required,d=b+a._id.$id,e='<input id="fc-field-'+d+'" class="fc-fieldinput" type="text" formcorp-data-id="'+d+'" data-required="'+c+'" placeholder="'+getConfig(a,"placeholder")+'">';return e},renderNumericSliderField=function(a,b){void 0===b&&(b="");var c="boolean"==typeof a.config.required&&a.config.required,d=getConfig(a,"step",1),e=getConfig(a,"min",1),f=getConfig(a,"max",10),g='<input class="fc-fieldinput" type="range" min="'+e+'" max="'+f+'" step="'+d+'" formcorp-data-id="'+getId(a)+'" data-required="'+c+'" placeholder="'+getConfig(a,"placeholder")+'">';return g+='<span class="fc-numeric-outcome"></span>'},validateMatrixField=function(a){var b=[];try{var c=$.parseJSON(a.config.validation)}catch(d){return log("Malformed JSON string passed for validatoin"),b}if(void 0!==c){var e=$("input[formcorp-data-id="+a._id.$id+"]"),f={};e.each(function(){var a=$(this).attr("formcorp-matrix-header"),b=$(this).attr("formcorp-matrix-field");void 0===f[a]&&(f[a]={}),f[a][b]=$(this).val()})}for(var g in f)if(f.hasOwnProperty(g)){var h=0,i=[],j=0;for(var a in f[g])f[g].hasOwnProperty(a)&&(j++,$.isNumeric(f[g][a])||""==f[g][a]||b.push("Field value for "+g+"-"+a+" must be numeric"),void 0!==c.headers&&void 0!==c.headers.header&&(void 0!==c.headers.header.integerOnly&&"true"==c.headers.header.integerOnly&&$.isNumeric(f[g][a])&&Math.floor(f[g][a])!=f[g][a]&&b.push("Field value for "+g+"-"+a+" must be an integer"),void 0!==c.headers.header.min&&parseFloat(f[g][a])<c.headers.header.min&&""!=f[g][a]&&b.push("Field value for "+g+"-"+a+" can be no less than "+c.headers.header.min),void 0!==c.headers.header.max&&parseFloat(f[g][a])>c.headers.header.max&&""!=f[g][a]&&b.push("Field value for "+g+"-"+a+" can be no greater than "+c.headers.header.max)),$.isNumeric(f[g][a])&&(h+=parseFloat(f[g][a])),void 0!==c.headers&&void 0!==c.headers.header&&void 0!==c.headers.header.ordered&&"true"==c.headers.header.ordered&&i.push(parseFloat(f[g][a])));if(void 0!==c.headers&&void 0!==c.headers.header&&void 0!==c.headers.header.ordered&&"true"==c.headers.header.ordered){for(var k=!0,l=1;l<=j;l++)i.indexOf(l)==-1&&(k=!1);0==k&&b.push("Fields values for "+g+" are not in order from 1 to "+j)}void 0!==c.headers&&void 0!==c.headers.total&&(void 0!==c.headers.total.equals&&h!=c.headers.total.equals&&b.push("Totals for "+g+" do not equal "+c.headers.total.equals),void 0!==c.headers.total.min&&h<c.headers.total.min&&b.push("Totals for "+g+" can be no less than "+c.headers.total.min),void 0!==c.headers.total.max&&h>c.headers.total.max&&b.push("Totals for "+g+" can be no greater than "+c.headers.total.max))}return b},loadMatrixFieldValues=function(a,b){if(!("string"!=typeof b||b.length<0||"{"!==b.substr(0,1))){
b=JSON.parse(b);var c=$("input[formcorp-data-id="+a+"]");c.each(function(){var a=$(this).attr("formcorp-matrix-header"),c=$(this).attr("formcorp-matrix-field");$(this).val(b[a][c]);var d=0;$('input[data-matrix-name^="fc-'+$(this).attr("formcorp-matrix-header")+'"]').each(function(){$.isNumeric($(this).val())&&(d+=parseFloat($(this).val()))}),$('input[data-matrix-total^="fc-'+$(this).attr("formcorp-matrix-header")+'"]').val()})}},parseMatrixField=function(a,b){var c=$("input[formcorp-data-id="+$(a).attr("formcorp-data-id")+"]"),d={};return c.each(function(){var a=$(this).attr("formcorp-matrix-header"),b=$(this).attr("formcorp-matrix-field");void 0===d[a]&&(d[a]={}),d[a][b]=$(this).val()}),b===!0?JSON.stringify(d):d},buildMatrixTable=function(a,b,c,d,e,f,g){var h='<table class="fc-matrixtable">';h+="<tr>",h+='<th style="width:25%;">'+a.config.title+"</th>";for(var i=0;i<b.length;i++)h+='<th style="width:'+d+'%;" class="fc-matrix-headerrow">'+b[i]+"</th>";h+="</tr>";for(var j=0;j<c.length;j++){h+="<tr>",h+='<td class="fc-matrix-fieldcolumn">'+c[j]+"</td>";for(var i=0;i<b.length;i++)h+='<td class="fc-matrix-field"><input class="fc-fieldinput fc-matrixfieldinput" data-matrix-name="fc-'+b[i]+'" type="text" formcorp-matrix-header="'+b[i]+'" formcorp-matrix-field="'+c[j]+'" formcorp-data-id="'+e+'" data-required="'+g+'"></td>';h+="</tr>"}if(1==a.config.summaryWidget){h+="<tr>",h+='<th class="fc-matrix-fieldcolumn">Total</th>';for(var i=0;i<b.length;i++)h+='<td class="fc-matrix-field"><input class="fc-fieldinput fc-headerstotal" type="text" data-matrix-total="fc-'+b[i]+'" value="0" readonly="true"></td>';h+="</tr>"}return h+="</table>"},renderMatrixField=function(a,b){void 0===b&&(b="");var c="boolean"==typeof a.config.required&&a.config.required,d=b+getId(a),e="",f="text";e="";try{$.parseJSON(a.config.validation)}catch(g){log("Malformed JSON string passed for validation")}if($.isNumeric(a.config.columns)&&a.config.columns>1)var h=parseInt(a.config.columns);else var h=1;if(a.config.headers.length>0&&a.config.fields.length>0){var i=a.config.headers.split("|"),j=a.config.fields.split("|"),k=75/i.length;if(i.length>0&&j.length>0){if(h>1){var l=Math.ceil(j.length/h),m=j.length%h,n=j;e="";for(var o=0;o<h;o++){o==m&&l--;var p=n.splice(0,l);e+='<div class="fc-matrixtable-column" style="float:left; padding-left:15px; padding-right: 15px; width:'+100/h+'%;">',e+=buildMatrixTable(a,i,p,k,d,f,c),e+="</div>"}}else e=buildMatrixTable(a,i,j,k,d,f,c);fc.domContainer.on("change",".fc-matrixfieldinput",function(){if($.isNumeric($(this).val())||""==$(this).val()){var a=0;$('input[data-matrix-name^="'+$(this).data("matrix-name")+'"]').each(function(){$.isNumeric($(this).val())&&(a+=parseFloat($(this).val()))}),$('input[data-matrix-total^="'+$(this).data("matrix-name")+'"]').val(a)}})}}return e},isValidFile=function(a,b){var c=[];if(void 0!==a.config&&(void 0!==a.config.maxFileSize||void 0!==a.config.fileTypes)&&(void 0!==a.config.maxFileSize&&$.isNumeric(a.config.maxFileSize)&&a.config.maxFileSize>0&&b.size/1e3>a.config.maxFileSize&&c.push(fc.lang.fileFieldSizeError+parseInt(a.config.maxFileSize/1024)+"MB"),void 0!==a.config.fileTypes&&a.config.fileTypes.length>0)){var d=a.config.fileTypes.toLowerCase().split(",").map(function(a){return a.replace(/\W/,"")});d.indexOf(b.extension.toLowerCase())==-1&&c.push("is of unallowed file type. Accepted File Types: "+d.join(", "))}return c},getDefaultValue=function(a){if("string"==typeof a&&(a=fc.fieldSchema[a]),"object"!=typeof a)return"";var b="",c=a.config.hasOwnProperty("defaultValue");return c&&(b=getConfig(a,"defaultValue","")),fc.util.isNotEmpty(getConfig(a,"value",""))&&(b=getConfig(a,"value","")),b},evaluateRequiredLogic=function(field,value){if("584791135acf7081538b47cb"===getId(field))var a="a";var requiredByDefault=Boolean(getConfig(field,"required",!1)),requiredLogicList=getConfig(field,"requiredLogic",[]),requiredLogicResult=[],defaultErrorMessage=getConfig(field,"emptyErrorMessage","").length>0?getConfig(field,"emptyErrorMessage",""):fc.lang.emptyFieldError,isEmptyString=function(a){return"string"==typeof a&&0===a.length},evaluateLogicStatement=function(statement){return!!(eval(getBooleanLogic(statement.condition))&&Boolean(statement.required)||!eval(getBooleanLogic(statement.condition))&&!Boolean(statement.required))&&value.length<1},getErrorMessage=function(a){return function(b){return"string"==typeof b.message&&b.message.length>0?b.message:a}};return Array.isArray(requiredLogicList)&&requiredLogicList.length>0?requiredLogicResult=requiredLogicList.filter(evaluateLogicStatement).map(getErrorMessage(defaultErrorMessage)):requiredByDefault&&value.length<1?[defaultErrorMessage]:[]},validateFileUpload=function(a,b){for(var c=[],d=JSON.parse(b),e=0;e<d.length;e++){var f=isValidFile(a,d[e]);f.length>0&&$.merge(c,f)}return c.length>0&&(c=[fc.lang.invalidFiles]),c},renderFileUpload=function(a,b){var c;void 0===b&&(b="");var d="boolean"==typeof a.config.multiple&&1==a.config.multiple?"multiple":"",e="boolean"==typeof a.config.required&&a.config.required,f="string"==typeof a.config.fileTypes?a.config.fileTypes.split(",").map(function(a){return"."+a}).join(","):"",g=a.config.readOnly?"disabled":"";return c='<input class="fc-fieldinput" formcorp-data-id="'+getId(a)+'" type="hidden" id="'+getId(a)+'" '+g+" />",c+='<input class="fc-fieldinput" formcorp-file-id="'+getId(a)+'" type="file" id="file-'+getId(a)+'" '+d+' style="display:none;" + accept=" '+f+' " />',c+='<span class="fc-fieldinput-attachButton-wrapper fc-btn"><input class="fc-fieldinput fc-fieldinput-attachButton fc-btn" formcorp-fileinput-id="'+getId(a)+'" type="button" id="fileinput-'+getId(a)+'" value="'+fc.lang.fileUploadCopy+'" data-required="'+e+'" onclick="document.getElementById(\'file-'+getId(a)+"').click();\"></span>",c+='<div class="fc-file-list"></div>',c+='<div class="fc-progress-list" id="fc-progress-list-'+getId(a)+'"></div>',fc.registeredDeleteFileListeners!==!0&&registerDeleteFileListeners(),fc.registeredRemoveFileErrorListeners!==!0&&registerRemoveFileErrorListeners(),c},deleteFileUpload=function(a,b){var c=fc.domContainer.find('[formcorp-data-id="'+a+'"]'),d=c.val(),e=JSON.parse(d);e.splice(b,1),d=JSON.stringify(e),c.val(d),valueChanged(a,d),buildFileList(a,d)},buildFileList=function(a,b){for(var c=fc.fieldSchema[a],d=fc.domContainer.find('[fc-data-group="'+a+'"]'),e=d.find(".fc-file-list"),f=JSON.parse(b),g=[],h="",i=!1,j=!1,k=("boolean"==typeof c.config.multiple&&1==c.config.multiple,0);k<f.length;k++){var l=isValidFile(c,f[k]);if(0==l.length)h+='<div class="fc-file-item"><div class="fc-delete-file-upload" title="Remove this file" data-file-list-key="'+k+'" data-for="'+a+'" style="cursor:pointer;">&#10006;</div> '+f[k].filename+" ("+parseFloat(f[k].size/1e3).toFixed(0)+" KB)</div>",g.push(f[k]),i=!0;else{j=!0;var m="",n="";m+='<div class="fc-file-item fc-file-item-error"><span class="fc-file-upload-error">'+n+"<span>"+fc.lang.fileFriendlyFieldErrorPrefix+"</span> "+f[k].filename+" ("+parseFloat(f[k].size/1e3).toFixed(0)+" KB)",m+=" <span>";for(var o=0;o<l.length;o++)m+=l[o]+". ";m+="</span><span class=\"fc-dismiss-upload-error-message\" onclick=\"$(this).parents('.fc-file-item').remove(); $('#fileinput-"+a+"').prop('disabled', false); $('#fileinput-"+a+"').css('background-color', '');\" style=\"text-decoration:underline;cursor:pointer;\"> Dismiss</span> </span></div>",h+=m}}var p=$("#"+a);p.val(JSON.stringify(g)),valueChanged(a,JSON.stringify(g)),e.html(h),i===!0||void 0!==typeof c.config&&0==c.config.required?(removeFieldError(a),showFieldSuccess(a)):(showFieldError(a,[fc.lang.noValidFiles]),removeFieldSuccess(a))},registerRemoveFileErrorListeners=function(){fc.registeredRemoveFileErrorListeners||(fc.domContainer.on("click",".fc-fieldinput-attachButton",function(){setTimeout(function(){$(".fc-file-upload-error").remove()},1e3)}),fc.registeredRemoveFileErrorListeners=!0)},registerDeleteFileListeners=function(){fc.registeredDeleteFileListeners||(fc.domContainer.on("click",".fc-field-fileUpload .fc-delete-file-upload",function(){var a=$(this),b=a.attr("data-for"),c=a.attr("data-file-list-key");return deleteFileUpload(b,c),!1}),fc.registeredDeleteFileListeners=!0)},renderDigitalSignatureField=function(a,b){var c,d;return void 0===b&&(b=""),c={values:fc.fields},d='<a class="fc-button">Sign Document</a>',fc.domContainer.on("click",".fc-field-digsigCollect .fc-button",function(){var b,c,e,f={},g=($(this),getPageVisibleFieldsFromDom(fc.currentPage));g!==!1&&g.each(function(){var a=$(this);e=a.attr("formcorp-data-id"),a.hasClass("fc-data-repeatable-grouplet")?void 0===f[e]&&(f[e]=fc.fields[e]):(c=getFieldValue(a),fc.fields[e]!==c&&setVirtualValue(e,c),f[e]=c)}),b={form_id:fc.formId,page_id:fc.currentPage,form_values:f},api("page/submit",b,"put",function(b){"object"==typeof b&&b.success===!0&&api("digsig/gateway/upload",{field_id:a._id.$id},"POST",function(b){if("object"==typeof b&&b.success===!0){$.featherlight({iframe:b.data.url,iframeWidth:800,iframeHeight:600});var c=setInterval(function(){api("digsig/gateway/data",{field_id:a._id.$id,uuid:b.data.data},"POST",function(a){if(a.data.data.signed_at>0){$(".fc-field-digsigIframe").remove(),clearInterval(c);var b="You have successfully signed:";d="<span>"+b+"</span>",d+='<div class="fc-signed"><img src="'+a.data.data.signature.signature+'"></div>';var e=$(".fc-field-digsigCollect");e.html().indexOf(b)==-1&&e.append(d);var f=$.featherlight.current();f.close()}})},1e3)}else d="<span>There was an error connecting to OmniSign</span>",$(".fc-field-digsigCollect").append(d),$(".fc-field-digsigCollect .fc-fieldcontainer .fc-fieldgroup").remove()})})}),d},renderDateField=function(a,b){"undefined"==typeof b&&(b="");var c,d="boolean"==typeof a.config.required&&a.config.required,e=b+getId(a),f="",g="text";hasLib(fc.libs.MATERIAL_DATEPICKER)&&"undefined"==typeof fc.materialDatepickers[e]&&(c=setInterval(function(){"boolean"==typeof fc.loadedMaterialDatepicker&&fc.loadedMaterialDatepicker&&(fc.materialDatepickers[e]=new MaterialDatePicker({format:"dd/MM/YY"}),fc.materialDatepickers[e].on("submit",function(a){var b=a._d,c=("0"+b.getDate()).slice(-2),d=b.getMonth(),f=("0"+ ++d).slice(-2),g=b.getFullYear(),h=("0"+b.getHours()).slice(-2),i=("0"+b.getMinutes()).slice(-2),j=fc.fieldSchema[e];if("object"==typeof j){var k=getConfig(j,"dateFormat","DD/MM/YYYY"),l=getConfig(j,"timeFormat","hh:mm"),m=getConfig(j,"displayTimePicker",!1),n=[k];m&&n.push(l);var o=n.join(" ");o=o.replace(/DD/g,c,o),o=o.replace(/MM/g,f,o),o=o.replace(/YYYY/g,g,o),o=o.replace(/hh/g,h,o),o=o.replace(/mm/g,i,o),setValue(e,o),fc.saveQueue[e]=o}}),clearInterval(c))},50));var h=[];return getConfig(a,"displayTimePicker",!1)&&h.push("time-picker"),f='<input class="fc-fieldinput '+h.join(" ")+'" type="'+g+'" formcorp-data-id="'+e+'" data-required="'+d+'" placeholder="'+getConfig(a,"placeholder")+'"><i class="fa fa-calendar"></i>'},downloadFieldFile=function(a){var b=fc.fieldSchema[a];if("object"!=typeof b||"download"!==b.type)return!1;var c=getConfig(b,"fileSource",!1);if(!c)return!1;var d=getConfig(b,"attachmentKey",!1);return!!d&&void api("download/attachment?key="+d,{},"post",function(a){if("object"==typeof a&&a.success){var b=a.key,c=apiUrl()+"download/download-attachment?key="+b;$("body").append("<iframe src='"+c+"' style='display: none;' ></iframe>")}})},registerDownloadListeners=function(){fc.registeredDownloadButtonListeners||(fc.domContainer.on("click",".fc-field-download .fc-button",function(){var a=$(this),b=a.attr("data-for");return downloadFieldFile(b),!1}),fc.registeredDownloadButtonListeners=!0)},renderDownloadField=function(a,b){var c=b+getId(a),d=getConfig(a,"deliveryMethod"),e=(getConfig(a,"fileSource"),"");switch(d){case"BUTTON":var f=getConfig(a,"buttonText",fc.lang.downloadButtonText);e+='<button class="fc-button" data-for="'+c+'">'+f+"</button>",fc.registeredDownloadButtonListeners!==!0&&registerDownloadListeners();break;case"AUTO":downloadFieldFile(c)}return e},renderCustomerRecord=function(a,b){getConfig(a,"showLoadingScreen",!1)&&fc.domContainer.find(".fc-loading-screen").addClass("show");var c=function(a,b){if(b)if(b.success&&b.data&&"object"==typeof b.data.values){var c,d,e,a,f,g,h={};for(g=fc.fields.entities,"undefined"==typeof g&&(g=[]),g.indexOf(b.recordId)&&g.push(b.recordId),setValue("entities",g),fc.saveQueue.entities=g,getConfig(a,"showLoadingScreen",!1)&&fc.domContainer.find(".fc-loading-screen").removeClass("show"),f=fc.domContainer.find('[fc-data-group="'+getId(a)+'"]'),e=0;e<b.fields.length;e+=1)a=b.fields[e],h[a.id]=a.machineName;for(c in b.data.values)b.data.values.hasOwnProperty(c)&&(d=b.data.values[c],setValue(c,d),fc.fieldSchema[c]={_id:{$id:c},config:{tag:h[c],type:"entityRecord"}});setFormState(""),f.length>0&&f.addClass("fc-hide"),setFieldValues(),flushVisibility()}else if(!b.success){var f=fc.domContainer.find('[fc-data-group="'+getId(a)+'"]');f.length>0&&f.find(".fc-entity-record").addClass("fc-error").html("<label>"+b.message+"</label>")}replaceTokensInDom(),fc.domContainer.trigger(fc.jsEvents.onCustomerAuthResult,[b])};getConfig(a,"preventRenderUntilComplete",!1)&&setFormState(fc.constants.stateLoadingEntityRecord);var d="";if(getConfig(a,"fetchFromSecureToken",!1)&&(d=getConfig(a,"uniqueIdentifier")).length>0){var e=fc.entityTokens[d];if("string"==typeof e){var f={method:"token",token:e,id:getId(a),group:getConfig(a,"customerGroupId",0)};api("customer/gateway/record",f,"post",function(b){c(a,b)})}else log("Missing token for id: "+d)}else if(getConfig(a,"fetchIdentifierFromUrl",!1)){var g=getHashVar(fc.config.entityPrefix);if("string"==typeof g&&g.length>0){var f={method:"url",id:getId(a),identifier:g};api("customer/gateway/record",f,"post",function(b){c(a,b)})}}else if(getConfig(a,"fetchInBg",!1)){var h=fc.fields[getConfig(a,"populateFrom")],f={id:getId(a),value:void 0===h?"":h};api("customer/gateway/record",f,"post",function(b){c(a,b)})}return'<div class="fc-entity-record">'+fc.lang.loading+"</div>"},initGreenIdFieldInDOM=function(a,b){var c="";return"string"!=typeof b&&(b=""),c+='<div class="fc-init-green-id" fc-prefix="'+b+'">Initialising...</div>'},greenIdFieldHeader=function(a){var b="",c="",d="",e=getValue(a);if("object"!=typeof e)return"";var f=e.values;return"string"==typeof f.title&&f.title.length>0&&(c+=(c.length>0?" ":"")+f.title),"string"==typeof f.firstName&&f.firstName.length>0&&(c+=(c.length>0?" ":"")+f.firstName),"string"==typeof f.middleName&&f.middleName.length>0&&(c+=(c.length>0?" ":"")+f.middleName),"string"==typeof f.surname&&f.surname.length>0&&(c+=(c.length>0?" ":"")+f.surname),"string"==typeof f.address&&f.address.length>0&&(d+=(d.length>0?" ":"")+f.address),"string"==typeof f.suburb&&f.suburb.length>0&&(d+=(d.length>0?", ":"")+f.suburb),"string"==typeof f.postcode&&f.postcode.length>0&&(d+=(d.length>0?", ":"")+f.postcode),"string"==typeof f.state&&f.state.length>0&&(d+=(d.length>0?"<br>":"")+f.state),"string"==typeof f.country&&f.country.length>0&&(d+=(d.length>0?", ":"")+f.country),b="<h5>Complete verification for: </h5><p>"+c+"<br>"+d+"</p>"},renderGreenIdField=function(a,b,c){"boolean"!=typeof c&&(c=!1),"string"!=typeof b&&(b="");var d=b+getId(a),e=(getValue(d),new fc.greenID.session(d));return e.begin()},renderIDMatrixField=function(a,b,c){"boolean"!=typeof c&&(c=!1),"string"!=typeof b&&(b="");var d=b+getId(a),e=new formcorp.modules.IDMatrix.Session(d,fc,formcorp.Renderer.IDMatrix.Default);if(Object.keys(e.callbacks).length>0)for(var f in e.callbacks)e.callbacks.hasOwnProperty(f)&&"function"==typeof e.callbacks[f]&&("undefined"==typeof fc.callbacks[f]&&(fc.callbacks[f]=[]),fc.callbacks[f].push(e.callbacks[f]));return e.init()},renderPageSections=function(a,b,c){var d,e,f,g,h,i="";for(d=0;d<a.length;d+=1){e=a[d];var j="undefined"!=typeof e.class&&e.class.length>0?" "+e.class:"";if(f='<div class="fc-section fc-section-'+getId(e)+j+'" formcorp-data-id="'+getId(e)+'" data-form-state="'+fc.formState+'">',f+='<div class="fc-section-container"><div class="fc-section-header">',"string"==typeof e.label&&e.label.length>0&&(f+='<div class="fc-section-label">',f+="<h4>"+tokenise(e.label)+"</h4>",f+="</div>"),"string"==typeof e.description&&e.description.length>0&&(f+='<div class="fc-section-desc">',f+="<p>"+tokenise(e.description)+"</p>",f+="</div>"),f+="</div>",f+='<div class="fc-section-body">',void 0!==e.field&&e.field.length>0&&(g=e.randomOrder===!0,h=g?shuffle(e.field):e.field,f+=renderFields(h,e)),f+="</div>",fc.config.showNextSectionButtons){var k="Next";"object"==typeof fc.config.showNextSectionButtons&&(k=fc.config.showNextSectionButtons[getId(e)]||"Next"),"string"==typeof fc.config.showNextSectionButtons&&""!==fc.config.showNextSectionButtons&&(k=fc.config.showNextSectionButtons);var l=!1;fc.config.hideLastNextSectionButton&&("object"==typeof c||isSubmitPage(b)===!1&&c===!1)&&(isSubmitPage(b)===!1&&c===!1||"object"==typeof c.page&&isSubmitPage(c.page))&&(l=!0),l||(f+='<div class="fc-section-end">                  <span class="fc-next-section-button-wrapper"><input type="button" value="'+k+'" class="fc-next-section-button"></span>                </div>')}f+="</div></div>",i+=f}return i},hasNextPage=function(){return nextPage(!1)},renderPage=function(a,b){var c,d=function(a){return a?b?a.next.nextPageAnimation:a.prev.nextPageAnimation:""}(fc.config.pageAnimations),e="undefined"!=typeof a.page.class&&a.page.class.length>0?" "+a.page.class:"",f='<div class="fc-page fc-page-'+getId(a.page)+e+'" data-page-id="'+getId(a.page)+'" data-form-state="'+fc.formState+'" style="animation:'+d+'">',g=fc.lang.submitText,h=["fc-submit"];return f+="<h1>"+tokenise(a.stage.label)+"</h1>",a=a.page,fc.pageId=a._id.$id,"string"==typeof a.label&&a.label.length>0&&(f+="<h2>"+tokenise(a.label)+"</h2>"),"string"==typeof a.description&&a.description.length>0&&(f+="<h3>"+tokenise(a.description)+"</h3>"),a.section.length>0&&(f+=renderPageSections(orderObject(a.section),a,c)),c=nextPage(!1,!0),("object"==typeof c||isSubmitPage(a)===!1&&c===!1)&&((isSubmitPage(a)===!1&&c===!1||"object"==typeof c.page&&isSubmitPage(c.page))&&(g=fc.lang.submitFormText,h.push("fc-submit-form")),isSubmitPage(a)||(f+='<div class="fc-pagination" data-form-state="'+fc.formState+'">',fc.config.showPrevPageButton===!0&&"object"==typeof getPageById(getPreviousPage())&&(f+='<div class="fc-prev-page">',f+='<input type="'+fc.config.buttonInputType+'" value="'+fc.lang.prevButtonText+'" class="fc-btn">',f+="</div>"),f+='<div class="'+h.join(" ")+'">',f+='<input type="'+fc.config.buttonInputType+'" value="'+g+'" class="fc-btn">',f+="</div>")),f+='<div class="fc-break"></div></div>',f+="</div>"},flushSectionVisibility=function(){fc.domContainer.find(".fc-section").each(function(){var dataId=$(this).attr("formcorp-data-id"),section,visible;"string"==typeof dataId&&0!==dataId.length&&"object"==typeof fc.sections[dataId]&&(section=fc.sections[dataId],fc.config.useTags&&objectHasTag(section)&&(visible=hasTags(section.tags)),"boolean"!=typeof visible&&(visible=!("string"==typeof section.visibility&&section.visibility.length>0)||eval(section.visibility)),visible?$("div.fc-section[formcorp-data-id="+dataId+"]").removeClass("fc-hide"):$("div.fc-section[formcorp-data-id="+dataId+"]").addClass("fc-hide"))})},flushRepeatableGroupletVisibility=function(dataId,field){var visible,groupletID,index,fieldID,parts,visibility,re;dataId.indexOf(fc.constants.prefixSeparator)>-1&&(parts=dataId.split(fc.constants.prefixSeparator),parts.length>=2&&(groupletID=parts[0],field=fc.fieldSchema[groupletID],void 0!==field&&"grouplet"===field.type&&getConfig(field,"repeatable",!1)&&fc.constants.repeatableInDOM.indexOf(parseInt(getConfig(field,"repeatableStyle",0)))>=0&&(index=parts[1],fieldID=parts[2],void 0!==fc.fieldSchema[fieldID]&&(visibility=getConfig(fc.fieldSchema[fieldID],"visibility",""),visibility.length>0&&(re=new RegExp(groupletID+fc.constants.prefixSeparator,"g"),visibility=visibility.replace(re,"####"),visibility=visibility.replace(/#{4,}/g,[groupletID,index,""].join(fc.constants.prefixSeparator)),visible=eval(visibility),"boolean"==typeof visible&&(visible?$('div[fc-data-group="'+dataId+'"]').removeClass("fc-hide"):$('div[fc-data-group="'+dataId+'"]').addClass("fc-hide")))))))},flushFieldVisibility=function(){fc.domContainer.find(".fc-field").each(function(){var dataId=$(this).attr("fc-data-group"),field,visible,logic,logicMatches,processed=[],temporaryId,iter,parts,replace,re;if("string"==typeof dataId&&0!==dataId.length&&"object"==typeof fc.fieldSchema[dataId]){if(field=fc.fieldSchema[dataId],fc.config.useTags&&objectHasTag(field.config)&&(visible=hasTags(field.config.tags)),"boolean"!=typeof visible){if("string"==typeof field.config.visibility&&field.config.visibility.length>0?logic=toBooleanLogic(field.config.visibility):"object"==typeof field.config.visibility&&(logic=field.config.visibility),"undefined"!=typeof logic&&"string"==typeof dataId&&fc.withinIterator[dataId]===!0&&(logicMatches=logic.match(/"[a-f0-9]{24}"/g),$.isArray(logicMatches)&&logicMatches.length>0))for(processed=[],iter=0;iter<logicMatches.length;iter+=1)temporaryId=logicMatches[iter].replace(/"/g,"",logicMatches[iter]),processed.indexOf(temporaryId)<0&&(void 0===fc.fieldSchema[temporaryId]&&(parts=dataId.split(fc.constants.prefixSeparator),parts.length>=2&&(replace=[parts[0],parts[1],temporaryId].join(fc.constants.prefixSeparator),re=new RegExp(temporaryId,"g"),logic=logic.replace(re,replace))),processed.push(temporaryId));visible=eval(logic)}"boolean"==typeof visible&&(visible?$('div[fc-data-group="'+dataId+'"]').removeClass("fc-hide"):$('div[fc-data-group="'+dataId+'"]').addClass("fc-hide")),flushRepeatableGroupletVisibility(dataId,field)}})},flushVisibility=function(){flushSectionVisibility(),flushFieldVisibility(),updateMobileFieldsVisibility(),fc.domContainer.trigger(fc.jsEvents.onVisibilityChanged)},updateMobileFieldsVisibility=function(){fc.domContainer.find(".fc-field.fc-mobile-field").each(function(){fc.mobileView===!0&&$(this).hasClass("fc-hide")?$(this).removeClass("fc-hide"):fc.mobileView!==!1||$(this).hasClass("fc-hide")||$(this).addClass("fc-hide")}),fc.domContainer.find(".fc-field.fc-desktop-field").each(function(){fc.mobileView!==!0||$(this).hasClass("fc-hide")?fc.mobileView===!1&&$(this).hasClass("fc-hide")&&$(this).removeClass("fc-hide"):$(this).addClass("fc-hide")}),fc.inMobileView=fc.mobileView},render=function(a,b,c){if(fc.expired!==!0){if(c&&$("html, body").scrollTop(fc.config.initialScrollOffset),fc.domContainer.find('.fc-page[data-page-id="'+a+'"]').length>0)return!1;var d=getPageById(a),e="";return void 0===d?void log("FC Error: Page not found"):void("object"==typeof d.stage&&(b===!0&&void 0!==fc.currentPage&&(fc.prevPages[a]=getPageById(fc.currentPage)),fc.config.progressBar&&"object"!=typeof fc.progressBar&&(fc.progressBar=progressBarFactory(fc.config.progressBar,fc.config),fc.progressBar.init()),fc.progressBar&&fc.config.progressBar&&"function"==typeof fc.progressBar.setPage&&fc.progressBar.setPage(a),updateFieldSchema(d.stage),fc.currentPage=a,e+=renderPage(d,b),!fc.config.onePage||isSubmitPage(d.page)?$(fc.jQueryContainer+" .render").html(e):($(fc.jQueryContainer+" .render").append(e),fc.pageOrders.push(a),fc.domContainer.find(".fc-pagination").hide(),fc.domContainer.find(".fc-page:visible:last .fc-pagination").show()),fc.domContainer.trigger(fc.jsEvents.onPageRender,[a]),fc.functions.afterRender(a)))}},afterRender=function(a){setFieldValues(),flushVisibility(),fc.ignoreHashChangeEvent=!0,fc.config.updateHash&&setHashVar(fc.config.hashPrefix,a),updateMobileFieldsVisibility(),fc.domContainer.trigger(fc.jsEvents.onFinishRender),initGreenIdDOMFields();for(var b=0,c=fc.callbacks.afterRender.length;b<c;b++)fc.callbacks.afterRender[b]();fc.isRendered=!0},nextPage=function(shouldRender,returnPage,pageId){"boolean"!=typeof shouldRender&&(shouldRender=!0),"boolean"!=typeof returnPage&&(returnPage=!1),"string"!=typeof pageId&&(pageId=fc.currentPage);var currentPage=getPageById(pageId),id,foundStage=!1,x,y,condition,stage,foundPage=!1,pageToRender;if(currentPage&&currentPage.page){if("object"==typeof currentPage.page.toCondition&&Object.keys(currentPage.page.toCondition).length>0)for(id in currentPage.page.toCondition)if(getPageById(id)&&currentPage.page.toCondition.hasOwnProperty(id)&&(condition=currentPage.page.toCondition[id],eval(getBooleanLogic(condition))))return shouldRender&&render(id,!0),!returnPage||getPageById(id);if("string"==typeof currentPage.page.nextPageDefault&&currentPage.page.nextPageDefault.length>0)return shouldRender&&render(currentPage.page.nextPageDefault,!0),!returnPage||getPageById(currentPage.page.nextPageDefault);for(x=0;x<fc.schema.stage.length;x+=1)if(stage=fc.schema.stage[x],!fc.config.useTags||!objectHasTag(stage)||hasTags(stage.tags)){if(!fc.config.renderOnlyVertical&&getId(stage)===getId(currentPage.stage)&&"object"==typeof stage.page&&stage.page.length>0){for(y=0;y<stage.page.length;y+=1){if(foundPage&&"undefined"==typeof pageToRender){if(!fc.config.useTags||!objectHasTag(stage.page[y])){pageToRender=stage.page[y];break}if(hasTags(stage.page[y].tags)){pageToRender=stage.page[y];break}}getId(stage.page[y])==getId(currentPage.page)&&(foundPage=!0)}foundPage=!1}if("undefined"==typeof pageToRender&&foundStage&&"object"==typeof stage.page&&stage.page.length>0){if(!fc.config.useTags||!objectHasTag(stage.page[0])){pageToRender=stage.page[0];break}if(hasTags(stage.page[0].tags)){pageToRender=stage.page[0];break}}getId(stage)===getId(currentPage.stage)&&(foundStage=!0)}return"object"==typeof pageToRender&&(shouldRender&&render(getId(pageToRender),!0,!fc.config.onePage),!returnPage||getPageById(getId(pageToRender)))}},checkAutoLoad=function(a){if("boolean"!=typeof a&&(a=!1),fc.config.autoLoadPages||a)return!(!hasNextPage()||!validForm(fc.currentPage,!1))&&(fc.functions.loadNextPage(!1),!0)};var prepopulate=function(a,b,c,d){if("undefined"==typeof d&&(d=!0),"object"!=typeof c&&(c=fc.fields),"string"==typeof a&&(a=fc.fieldSchema[a]),"object"==typeof a&&"undefined"!=typeof b){var e=getConfig(a,"prePopulate",[]);if($.isArray(e)&&0!==e.length){for(var f,g,h=0,i=e.length;h<i;h++)if(f=e[h],g=fc.fieldSchema[f],f.length>0&&"undefined"!=typeof g){var j=getValue(f,"");if(getConfig(a,"forcePrePopulate",!1)||""===j||j===getDefaultValue(f)){setVirtualValue(f,b,c,!0);var k=fc.domContainer.find('div[fc-data-group="'+f+'"]');if(k.length>0&&(setDomValue(k,b,d),d)){var l=getFieldErrors(f,b,"");void 0!==l&&l.length>0?(removeFieldSuccess(f),showFieldError(f,l)):(removeFieldError(f),showFieldSuccess(f))}return[f,b]||!1}}return!1}}};return valueChanged=function(a,b,c){log("valueChanged("+a+","+b+","+c+")");var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=fc.fieldSchema[a],s=!1;if(fc.domContainer.trigger(fc.jsEvents.onPreValueChange,[a,b,c]),"boolean"!=typeof c&&(c=!1),!c&&void 0===r)return void log("Schema not defined");if("string"==typeof b&&prepopulate(r,b),log($.extend({},fc.fields)),fc.domContainer.trigger(fc.jsEvents.onFieldValueChange,[a,b]),a.indexOf(fc.constants.prefixSeparator)!=-1||fieldIsRepeatable(a)||fieldParentIsRepeatable(a)||("string"==typeof a&&a.length>0&&!$.isNumeric(a)&&setVirtualValue(a,b,fc.fields,!0),a.indexOf(fc.constants.prefixSeparator)>-1&&saveOriginalGroupletValue(a,b),flushVisibility()),log($.extend({},fc.fields)),a.indexOf(fc.constants.prefixSeparator)>-1&&setVirtualValue(a,b,fc.fields,!0),flushActivePageForField(a,!0),!fieldIsRepeatable(a)){if("string"==typeof a&&a.length>0&&!$.isNumeric(a)&&a.indexOf(fc.constants.prefixSeparator)==-1&&setVirtualValue(a,b,fc.fields,!0),flushVisibility(),d=fieldErrors(a),fc.config.realTimeValidation===!0){var t=$('.fc-field[fc-data-group="'+a+'"]'),u=t.addBack(t.prevAll(".fc-field")),v=t.closest(".fc-section").filter(u);validForm(v,!0),void 0!==d&&d.length>0?(logEvent(fc.eventTypes.onFieldError,{fieldId:a,errors:d}),removeFieldSuccess(a),showFieldError(a,d)):(showFieldSuccess(a),removeFieldError(a))}else removeFieldError(a);fc.config.saveInRealTime===!0&&a.indexOf(fc.constants.prefixSeparator)==-1&&(fc.saveQueue[a]=b),g=nextVisibleField(a),e={fieldId:a,success:!d||0===d.length},g&&(e.nextField=g),e.success&&(e.completionTime=(Date.now()-fc.lastCompletedTimestamp)/1e3,fc.lastHesitationTime>0&&(e.completionTime-=fc.lastHesitationTime),fc.lastCompletedField=a,fc.lastCompletedTimestamp=Date.now()),logEvent(fc.eventTypes.onValueChange,e)}if(f=getFieldPageId(a),i=getPageById(f),h=!i||!i.page||!i.page.preventAutoLoad||"1"!==i.page.preventAutoLoad,fc.config.autoLoadPages&&f===fc.currentPage&&h&&(s=checkAutoLoad()),getConfig(fc.fieldSchema[a],"allowAutoScroll",!0)&&fc.config.autoScrollToNextField&&!s&&g&&g.length>0&&autoScrollToField(a,g),k=getConfig(r,"tag",""),k.length>0&&void 0!==fc.reRenderOnValueChange[k])for(j=0;j<fc.reRenderOnValueChange[k].length;j+=1)l=fc.reRenderOnValueChange[k][j],m=fc.domContainer.find('.fc-field[fc-data-group="'+l+'"]'),m.length>0&&(q=m.attr("fc-belongs-to"),p=fc.fieldSchema[l],void 0!==p&&"grouplet"===p.type&&(n=renderFields([p],q),n.length>0&&(o=$(n),m.html($(n).html()),setFieldValues(m))));fc.domContainer.trigger(fc.jsEvents.onValueChanged,[a,b,c])},setValueUpdate=function(a){log("setvalueUpdate()"),log(a);var b,c=a.val(),d=a.attr("formcorp-data-id"),e=fc.fieldSchema[d];return e&&e.type&&"abnVerification"===e.type?(b=a.parent().find(".fc-button"),0===c.length||fc.validAbns.indexOf(c)===-1?b.hasClass("fc-hide")&&b.removeClass("fc-hide"):(b.addClass("fc-hide"),valueChanged(d,c),removeFieldError(d)),void("string"==typeof d&&d.length>0&&!$.isNumeric(d)&&setVirtualValue(d,c,fc.fields,!0))):e&&e.type&&"matrix"===e.type?void valueChanged(d,parseMatrixField(a,!0)):void(c!==fc.fields[d]&&valueChanged(d,c))},setFileUploadUpdate=function(a){var b=a.attr("formcorp-file-id"),c=document.getElementById("file-"+b).files;if(c.length>0)for(var d=[],e=[],f=[],g=0;g<c.length;++g){d[g]={},d[g].filename=c[g].name.replace(/^.*[\\\/]/,""),d[g].extension=d[g].filename.split(".").pop(),d[g].size=c[g].size,d[g].field_id=b;var h="<span>"+d[g].filename+"."+d[g].extension+"</span>";f[g]=$(h+'<progress class="fc-file-upload-progress" value="0" max="100"></progress><br/>'),$("#fc-progress-list-"+b).append(f),getBase64(c[g],g,function(g,h){if(e[h]=g,d[h].contents=g,e.length==c.length){for(var i=!0,j=0;j<d.length;j++)void 0!=d[j].contents&&0!=d[j].contents.length||(i=!1);if(i){var k=[];for(j=0;j<d.length;j++){var l={form_id:fc.formId,page_id:fc.currentPage,file:d[j],j:j},m=fc.fieldSchema[d[j].field_id];if(d[j].size>1024*m.config.maxFileSize){f[h].fadeOut(function(){$(this).remove()});var n=d[j].field_id,o=JSON.stringify([{filename:d[j].filename,extension:d[j].extension,size:d[j].size,field_id:d[j].field_id}]);buildFileList(n,o)}else api("page/store-upload",l,"post",function(c){if("object"==typeof c&&c.success===!0&&void 0!==c.submission_values.upload_id.$id?k.push({upload_id:c.submission_values.upload_id.$id,extension:c.submission_values.extension,size:c.submission_values.size,filename:c.submission_values.filename,field_id:c.submission_values.field_id}):k.push({extension:c.submission_values.extension,size:c.submission_values.size,filename:c.submission_values.filename}),k.length==d.length){var e=$("#"+b),f=e.val();if(f.length>0){var g=a.attr("id").replace(/file-/,"");if(fc.fieldSchema[g].config.multiple){var h=JSON.parse(f);$.merge(h,k);var i=JSON.stringify(h)}else var i=JSON.stringify(k)}else var i=JSON.stringify(k);e.val(i),valueChanged(b,i),buildFileList(b,i)}},void 0,function(){var a=j,b=$.ajaxSettings.xhr();return b.upload.onprogress=function(b){var c=b.loaded/b.total*100;f[a].attr("value",c)},b.upload.onload=function(){f[a].fadeOut(function(){$(this).remove()})},b})}}}})}},registerValueChangedListeners=function(){fc.config.autoShiftFocusOnEnter&&fc.domContainer.on("keypress","input[type=text].fc-fieldinput, input[type=tel].fc-fieldinput",function(a){if(a.which===fc.constants.enterKey){var b,c=$(this).attr("formcorp-data-id"),d=nextVisibleField(c,!1),e=!1,f=$(this).val(),g=$(this).attr("formcorp-data-id");
if(!fieldIsValid(g,f))return;d&&d.length>0&&(b=$('.fc-fieldinput[type=text][formcorp-data-id="'+d+'"], .fc-fieldinput[type=tel][formcorp-data-id="'+d+'"]'),b.length>0&&(b.focus(),e=!0)),e||$(this).blur(),f!==fc.fields[g]&&valueChanged(g,f),d&&d.length>0&&fc.config.autoScrollToNextField&&autoScrollToField(c,d)}}),fc.domContainer.on("change","textarea.fc-fieldinput, input[type=text].fc-fieldinput, input[type=tel].fc-fieldinput, input[type=radio].fc-fieldinput, input[type=range].fc-fieldinput",function(){setValueUpdate($(this))}),fc.domContainer.on("change","input[type=file].fc-fieldinput",function(){setFileUploadUpdate($(this))}),fc.domContainer.on("focus","input[type=text].fc-fieldinput,input[type=tel].fc-fieldinput,textarea.fc-fieldinput",function(){var a=$(this),b=a.val(),c=a.attr("formcorp-data-id");fc.domContainer.trigger(fc.jsEvents.onFieldFocus,[c,b,a])}),fc.domContainer.on("input","input[type=range].fc-fieldinput",function(){setRangeValue($(this))}),fc.domContainer.on("change paste blur",".fc-field-text input[type=text].fc-fieldinput, .fc-field-text input[type=tel].fc-fieldinput",function(){var a=$(this),b=a.val(),c=a.attr("formcorp-data-id");fc.domContainer.trigger(fc.jsEvents.onFieldBlur,[c,b,a]),b!==fc.fields[c]&&valueChanged(c,b)}),fc.domContainer.on("click",".fc-field-abnVerification .fc-button",function(){var a,b=$(this).parent().find("input.fc-fieldinput"),c=b.attr("formcorp-data-id"),d=b.parent().find(".fc-loading"),e=this;return removeFieldError(c),d&&d.length>0&&d.removeClass("fc-hide"),validateAbn(c,b.val(),function(f){var g,h,i,j;d&&d.length>0&&d.addClass("fc-hide"),"object"==typeof f&&(f.success&&[!0,"true"].indexOf(f.success)>-1?(a=getConfig(fc.fieldSchema[c],"mapBusinessName",""),a.length>0&&f.entityName&&f.entityName.length>0&&(g=getFieldByTag(a),g&&null!==g&&"object"==typeof g&&(h=getId(g),h.length>0&&(!fc.fields[h]||"string"==typeof fc.fields[h]&&0===fc.fields[h].length)&&(i="object"==typeof f.businessName&&f.businessName.length>0?f.businessName[0]:f.entityName,"string"==typeof h&&h.length>0&&!$.isNumeric(h)&&setVirtualValue(h,i),j=$('.fc-field[fc-data-group="'+h+'"]'),setFieldValue(j,h)))),fc.validAbns.push(b.val()),$(e).remove(),valueChanged(c,b.val())):showFieldError(c,[f.message]))}),!1}),fc.domContainer.on("click","button.fc-fieldinput.fc-button",function(){var a,b=$(this).text(),c=$(this).attr("formcorp-data-id"),d=$(this).parent().parent(),e=$('.fc-field[fc-data-group="'+c+'"]'),f=$(this).hasClass("checked");return $(this).attr("data-field-value")&&(b=decodeURIComponent($(this).attr("data-field-value"))),fc.fieldSchema[c]&&fc.fieldSchema[c].type?(["contentRadioList","optionTable"].indexOf(fc.fieldSchema[c].type)>-1?(b=decodeURIComponent($(this).attr("data-field-value")),getConfig(fc.fieldSchema[c],"allowMultiple",!1)?(a=fc.fields[c]||[],a.indexOf(b)<0?f||a.push(b):f&&delete a[a.indexOf(b)],b=a):e.find("button.checked").removeClass("checked")):d.hasClass("fc-radio-option-buttons")&&d.find(".checked").removeClass("checked"),$(this).toggleClass("checked"),valueChanged(c,b),!1):void fc.domContainer.trigger(fc.jsEvents.onButtonUnknownClick,[$(this)])}),fc.domContainer.on("change","select.fc-fieldinput",function(){valueChanged($(this).attr("formcorp-data-id"),$(this).find("option:selected").val())}),fc.domContainer.on("change",".fc-field-checkboxList :checkbox",function(){valueChanged($(this).attr("formcorp-data-id"),getFieldValue($(this)))})},validateModal=function(a){var b,c,d,e,f=!0,g={};return"boolean"!=typeof a&&(a=!1),$(".fc-modal [formcorp-data-id]").each(function(){if("true"===$(this).attr("data-required")){if(fieldIsEmpty($(this)))return void(f=!1);b=$(this).attr("formcorp-data-id"),c=getFieldValue($(this)),d=fc.fieldSchema[b],e=getCustomErrors(d,c),e.length>0?(f=!1,g[b]=e,a&&(removeFieldSuccess(b),showFieldError(b,e))):(showFieldSuccess(b),removeFieldError(b))}}),f},showDeleteDialog=function(){return $(".fc-modal .modal-header h2").text(fc.lang.deleteDialogHeader),$(".fc-modal .modal-body").html(fc.lang.deleteSignatoryDialogText),$(".fc-modal .modal-footer .fc-btn-add").text(fc.lang.confirm),$(".fc-modal").addClass("fc-show"),!1},showRepeatableEditDialog=function(){var a=$("<div />").append($('[fc-data-group="'+fc.modalMeta.fieldId+'"] > .fc-fieldcontainer').clone()),b={},c=$(".fc-modal .modal-body");return a.find(".fc-data-repeatable-grouplet").removeClass("fc-data-repeatable-grouplet"),fc.fields[fc.modalMeta.fieldId]&&fc.fields[fc.modalMeta.fieldId][fc.modalMeta.index]&&(b=fc.fields[fc.modalMeta.fieldId][fc.modalMeta.index]),$(".fc-modal .modal-header h2").text(fc.lang.editDialogHeader),c.html(a.html()),c.find("div[fc-data-group]").each(function(){var a=$(this).attr("fc-data-group");void 0!==b[a]&&setDomValue(this,b[a])}),$(".fc-modal .modal-footer .fc-btn-add").text(fc.lang.confirm),$(".fc-modal").addClass("fc-show"),!1},registerRepeatableGroupletListeners=function(){fc.domContainer.on("click",".fc-summary-options .fc-delete",function(){return fc.modalState=fc.states.DELETE_REPEATABLE,fc.modalMeta={index:$(this).parent().attr("data-index"),fieldId:$(this).parent().attr("data-field-id")},showDeleteDialog(),!1}),fc.domContainer.on("click",".fc-summary-options .fc-edit",function(){return fc.modalState=fc.states.EDIT_REPEATABLE,fc.modalMeta={index:$(this).parent().attr("data-index"),fieldId:$(this).parent().attr("data-field-id")},showRepeatableEditDialog(),!1})},addRepeatableRow=function(){var a=validateModal(),b={},c=$(".fc-modal .modal-body > div");return a?(c.removeClass("fc-error"),fc.domContainer.find(".fc-modal [formcorp-data-id]").each(function(){var a=$(this).attr("formcorp-data-id");b[a]=getFieldValue($(this))}),"object"!=typeof fc.fields[fc.activeModalField]&&"string"==typeof fc.activeModalField&&fc.activeModalField.length>0&&!$.isNumeric(fc.activeModalField)&&setVirtualValue(fc.activeModalField,[]),$.isArray(fc.fields[fc.activeModalField])||"string"==typeof fc.activeModalField&&fc.activeModalField.length>0&&!$.isNumeric(fc.activeModalField)&&setVirtualValue(fc.activeModalField,[]),"string"==typeof fc.activeModalField&&fc.activeModalField.length>0&&!$.isNumeric(fc.activeModalField)&&fc.fields[fc.activeModalField].push(b),getConfig(fc.fieldSchema[fc.activeModalField],"renderRepeatableTable",!1)&&$('[fc-data-group="'+fc.activeModalField+'"] .fc-summary').html(renderRepeatableTable(fc.activeModalField,fc.fields[fc.activeModalField])),void hideModal()):(c.addClass("fc-error"),!1)},editRepeatableRow=function(){var a,b=$(".fc-modal").find(".modal-body > .fc-fieldcontainer"),c={};b&&b.length>0&&validateModal(!0)&&(fc.domContainer.find(".fc-modal [formcorp-data-id]").each(function(){var a=$(this).attr("formcorp-data-id");c[a]=getFieldValue($(this))}),"object"!=typeof fc.fields[fc.activeModalField]&&"string"==typeof fc.activeModalField&&fc.activeModalField.length>0&&!$.isNumeric(fc.activeModalField)&&setVirtualValue(fc.activeModalField,[]),fc.fields[fc.modalMeta.fieldId]&&fc.fields[fc.modalMeta.fieldId][fc.modalMeta.index]&&(fc.fields[fc.modalMeta.fieldId][fc.modalMeta.index]=c,fc.saveQueue[fc.modalMeta.fieldId]=fc.fields[fc.modalMeta.fieldId],a=renderRepeatableTable(fc.modalMeta.fieldId,fc.fields[fc.modalMeta.fieldId]),$('[fc-data-group="'+fc.modalMeta.fieldId+'"] .fc-summary').html(a),hideModal()))},deleteRepeatableRow=function(){fc.fields[fc.modalMeta.fieldId].splice(fc.modalMeta.index,1),fc.saveQueue[fc.modalMeta.fieldId]=fc.fields[fc.modalMeta.fieldId];var a=renderRepeatableTable(fc.modalMeta.fieldId,fc.fields[fc.modalMeta.fieldId]);$('[fc-data-group="'+fc.modalMeta.fieldId+'"] .fc-summary').html(a),hideModal()},loadNextPage=function(a,b){if(!fc.preventNextPageLoad){void 0===a&&(a=!0),"undefined"==typeof b&&(b=!1),logEvent(fc.eventTypes.onNextPageClick);var c=fc.domContainer.find('.fc-page[data-page-id="'+fc.currentPage+'"]');if(0!==c.length){if(!validForm(void 0,a))return logEvent(fc.eventTypes.onNextPageError),a&&fc.config.scrollOnSubmitError&&scrollToFirstError(),!1;var d,e,f,g,h,i,j={},k=($(this),getPageVisibleFieldsFromDom());k!==!1&&k.each(function(){var a=$(this);if(g=a.attr("formcorp-data-id"),g.length){var b=fc.domContainer.find('.fc-field[fc-data-group="'+g+'"]');b.parent().hasClass("fc-data-repeatable-grouplet")||(a.hasClass("fc-data-repeatable-grouplet")?setVirtualValue(g,getValue(g),j):(f=getFieldValue(a),fc.fields[g]!==f?setVirtualValue(g,f):setVirtualValue(g,f,j))),prepopulate(g,f)}}),Object.keys(fc.saveQueue).length&&($.extend(j,fc.saveQueue),fc.saveQueue={}),d={form_id:fc.formId,page_id:fc.currentPage,form_values:j};var l=fc.currentPage;if(e=nextPage(!1,!0),fc.currentPage=l,!validForm(fc.domContainer,!0))return!1;if((e&&"object"==typeof e.page&&isSubmitPage(e.page)||e===!1)&&(d.complete=!0,!b&&isDevelopmentBranch()))return fc.modalState=fc.states.SUBMIT_DEVELOPMENT_BRANCH,showModal({addButton:!0,addButtonText:fc.lang.yes,closeButtonText:fc.lang.no,body:fc.lang.confirmSubmitDevelopment,title:fc.lang.areSureHeader}),!1;fc.domContainer.trigger(fc.jsEvents.onLoadingPageStart),fc.preventNextPageLoad=!0,api("page/next",d,"put",function(a){var b,c,d=!1;if("boolean"==typeof a.success&&a.success){if("string"==typeof a.nextPage&&a.nextPage.length>0&&(d=a.nextPage),fc.lastActivity=(new Date).getTime(),fc.domContainer.trigger(fc.jsEvents.onLoadingPageEnd),!fc.config.administrativeEdit&&void 0!==a.criticalErrors&&"object"==typeof a.criticalErrors&&a.criticalErrors.length>0){var f,g,j,k,l=!1;for(f=0;f<a.criticalErrors.length;f+=1)if(g=$('.fc-field[fc-data-group="'+a.criticalErrors[f]+'"]'),g.length>0&&!g.hasClass("fc-hide")){if(j=g.attr("fc-belongs-to"),k=fc.domContainer.find(".fc-section[formcorp-data-id="+j+"]"),k.length>0){if(!k.hasClass("fc-hide"))return void(fc.preventNextPageLoad=!1);l=!0}if(l===!1)return log("[FC](1) Server side validation errors occurred, client should have caught this"),void(fc.preventNextPageLoad=!1)}}if(hasNextPage()){if(h=fc.currentPage,fc.config.pageAnimations?($(".fc-page-"+fc.currentPage).css({animation:fc.config.pageAnimations.next.currentPageAnimation}),setTimeout(function(){nextPage(),i=fc.currentPage,"string"==typeof d&&d.length>0&&d!==i&&showSecurityError({message:"Next page mismatch between client and server"}),fc.config.pageAnimations&&setTimeout(function(){$("html, body").scrollTop(0)},10),setTimeout(function(){setCurrentSection(getCurrentSection(fc.pageId),!0)},fc.config.pageAnimations?fc.config.pageAnimations.next.delay:0),fc.domContainer.trigger(fc.jsEvents.onNextPage,[h,i]),fc.domContainer.trigger(fc.jsEvents.onPageChange,[h,i]),logEvent(fc.eventTypes.onNextPageSuccess,{from:h,to:i,timeSpent:(Date.now()-fc.nextPageLoadedTimestamp)/1e3}),fc.nextPageLoadedTimestamp=Date.now()},fc.config.pageAnimations?fc.config.pageAnimations.next.delay:0)):(nextPage(),i=fc.currentPage,"string"==typeof d&&d.length>0&&d!==i&&showSecurityError({message:"Next page mismatch between client and server"}),setTimeout(function(){setCurrentSection(getCurrentSection(fc.pageId),!0)},fc.config.pageAnimations?fc.config.pageAnimations.next.delay:0),fc.domContainer.trigger(fc.jsEvents.onNextPage,[h,i]),fc.domContainer.trigger(fc.jsEvents.onPageChange,[h,i]),logEvent(fc.eventTypes.onNextPageSuccess,{from:h,to:i,timeSpent:(Date.now()-fc.nextPageLoadedTimestamp)/1e3}),fc.nextPageLoadedTimestamp=Date.now()),"object"==typeof e.page&&isSubmitPage(e.page)&&(fc.config.hideLastNextSectionButton&&fc.domContainer.find(".fc-page:visible:last .fc-section:visible:last .fc-section-end").hide(),fc.domContainer.trigger(fc.jsEvents.onFormComplete),logEvent(fc.eventTypes.onFormComplete)),fc.nextPageButtonClicked&&fc.config.onePage&&fc.config.smoothScroll&&(b=$(".fc-page:last"),b&&b.length>0&&(c=parseInt(b.offset().top,10)+parseInt(fc.config.scrollOffset,10),0===$(document).scrollTop()&&(c+=fc.config.initialScrollOffset),void 0!==fc.config.conditionalHtmlScrollOffset.class&&$("html").hasClass(fc.config.conditionalHtmlScrollOffset.class)&&(c+=fc.config.conditionalHtmlScrollOffset.offset),scrollToOffset(c),fc.nextPageButtonClicked=!1)),fc.preventNextPageLoad=!1,fc.config.forceNextPageAutoload&&!isSubmitPage(e.page)){var m=getPageById(fc.currentPage),n=nextPage(!1,!0);isSubmitPage(m)||isSubmitPage(n.page)||!hasNextPage()||checkAutoLoad(!0)}return}fc.config.pageAnimations?($(".fc-page-"+fc.currentPage).css({animation:fc.config.pageAnimations.next.currentPageAnimation}),setTimeout(function(){$(fc.jQueryContainer+" .render").html(fc.lang.formCompleteHtml)},fc.config.pageAnimations?fc.config.pageAnimations.next.delay:0)):$(fc.jQueryContainer+" .render").html(fc.lang.formCompleteHtml),fc.domContainer.trigger(fc.jsEvents.onFormComplete),logEvent(fc.eventTypes.onFormComplete)}else logEvent(fc.eventTypes.onNextPageError);enhancedSecurityError(a)&&(showSecurityError(a),fc.domContainer.find(".fc-loading-screen").removeClass("show"),fc.domContainer.trigger(fc.jsEvents.onLoadingPageEnd)),fc.preventNextPageLoad=!1})}}},loadPrevPage=function(){if(fc.config.showPrevPageButton!==!0)return!1;var a=getPreviousPage();return render(a),setTimeout(function(){setCurrentSection(getCurrentSection(a),!0),fc.domContainer.trigger(fc.jsEvents.onPrevPage)},10),!1},registerOnePageListeners=function(){$(document).on("scroll",function(){var a,b,c,d;for(a=0;a<fc.pageOrders.length;a+=1)d=$('[data-page-id="'+fc.pageOrders[a]+'"]'),d.length>0&&(b=parseInt($('[data-page-id="'+fc.pageOrders[a]+'"]').offset().top,10),b+=parseInt(fc.config.scrollOffset,10)-fc.config.activePageOffset,$(document).scrollTop()>b&&(void 0===fc.activePage&&(fc.activePage=fc.pageOrders[a]),c=fc.pageOrders[a]));void 0!==c&&fc.activePage!==c&&(fc.domContainer.trigger(fc.jsEvents.onPageChange,[fc.activePage,c]),fc.activePage=c)})},registerEventListeners=function(){fc.config.realTimeValidation===!1&&fc.domContainer.on("focus",".fc-field input",function(a){var b=$(a.currentTarget),c=b.attr("formcorp-data-id");removeFieldError(c)}),fc.config.flagFocusedCurrentSection&&$(window).scroll(function(a){fc.scrollInterval===!1&&(fc.scrollInterval=setTimeout(function(){var a=($("body"),$(window).height()),b=$(window).scrollTop(),c=[];$(".fc-section").each(function(d){var e=$(this),f=e.outerHeight(),g=e.offset().top,h=g-b,i=h>=0&&h<a||h+f>=0&&h+f<a;c.push({height:f,offset:g,relativeOffset:h,isInViewport:i,$this:e})}).removeClass(fc.config.flagFocusedCurrentSection),c.forEach(function(a){a.isInViewport&&a.$this.addClass(fc.config.flagFocusedCurrentSection)}),clearInterval(fc.scrollInterval),fc.scrollInterval=!1}.bind(this),120))}.bind(this)),fc.config.showNextSectionButtons&&$("#formcorp-form").on("click",".fc-next-section-button",function(a){var b=$(a.currentTarget),c=b.parents(".fc-page"),d=b.parents(".fc-section"),e=(d.attr("formcorp-data-id"),d.add(d.prevAll(".fc-section:visible")));if(validForm(e,!0)){var f=d.nextAll(".fc-section:visible").first(),g=void 0;if(f.length>0)g=f.attr("formcorp-data-id"),setCurrentSection(g,!0);else{var h=c.nextAll(".fc-page:visible").first();f=h.children(".fc-section:visible").first(),f.length>0?(g=f.attr("formcorp-data-id"),setCurrentSection(g,!0)):$(".fc-submit button, .fc-submit input").last().trigger("click")}}else{var i=e.find(".fc-field.fc-error").first().closest(".fc-section");$("html, body").stop(!0,!0).animate({scrollTop:i.offset().top+fc.config.scrollOffset})}}),fc.domContainer.on("click","div.fc-submit button, div.fc-submit input[type="+fc.config.buttonInputType+"]",function(){return fc.nextPageButtonClicked=!0,fc.functions.loadNextPage(),!1}),fc.config.deleteSessionOnComplete&&fc.domContainer.on(fc.jsEvents.onFormComplete,function(){deleteSession(!1)}),fc.domContainer.on("click",".fc-prev-page input, .fc-prev-page button",function(){fc.config.pageAnimations&&$(".fc-page-"+fc.currentPage).css({animation:fc.config.pageAnimations.prev.currentPageAnimation}),setTimeout(function(){return fc.functions.loadPrevPage()},fc.config.pageAnimations?fc.config.pageAnimations.prev.delay:0)}),fc.domContainer.on("click",".fc-desc a",function(){var a=$(this).attr("href");return window.open(a),!1}),registerValueChangedListeners(),$(window).on("hashchange",function(){var a=getHashVar(fc.config.hashPrefix),b=fc.domContainer.find('.fc-page[data-page-id="'+a+'"]');0===b.length&&fc.ignoreHashChangeEvent===!1&&fc.oldHash!==a&&"object"==typeof fc.pages[a]&&render(a),fc.config.smoothScroll&&fc.oldHash&&setTimeout(function(a){smoothScrollToPage(a)}.bind(this,a),fc.config.scrollWait),fc.oldHash=a,fc.ignoreHashChangeEvent=!1}),fc.domContainer.on("click",".fc-repeatable a.fc-click.fc-add",function(){var a,b,c,d,e,f=$(this).attr("data-id"),g="",h=fc.fieldSchema[f];return void 0!==h&&getConfig(h,"repeatable",!1)&&(a=parseInt(getConfig(h,"repeatableStyle",0)),0===a?(fc.activeModalField=f,fc.modalState=fc.states.ADD_REPEATABLE,g=$("<div />").append($('[fc-data-group="'+f+'"] > .fc-fieldcontainer').clone()).html(),$(".fc-modal .modal-body").html(g),$(".fc-modal").addClass("fc-show")):1===a&&(c=fc.domContainer.find('.fc-field[fc-data-group="'+f+'"]'),b=c.attr("fc-belongs-to"),d=fc.domContainer.find('.fc-field[fc-data-group="'+f+'"] .fc-repeatable-rows'),d.length>0&&(e=d.find(".fc-repeatable-row").length,e<getConfig(h,"maxRows",1e5)&&(g=outputRepeatablePreDetermined(f,e+1,fc.sections[b]),d.html(g),setFieldValues(d),flushFieldVisibility(),flushActivePageForField(f,!0)),e+1>=getConfig(h,"maxRows",1e5)?c.find(".fc-add").addClass("fc-hide"):c.find(".fc-remove.fc-hide")&&c.find(".fc-remove.fc-hide").removeClass("fc-hide")))),fc.domContainer.trigger(fc.jsEvents.onDynamicRowAdded),!1}),fc.domContainer.on("click",".fc-repeatable a.fc-click.fc-remove",function(){var a,b,c,d,e,f,g,h=$(this).attr("data-id"),i="",j=fc.fieldSchema[h];if(void 0!==j&&getConfig(j,"repeatable",!1)&&(a=parseInt(getConfig(j,"repeatableStyle",0)),1===a&&(d=fc.domContainer.find('.fc-field[fc-data-group="'+h+'"]'),b=d.attr("fc-belongs-to"),c=fc.domContainer.find('.fc-field[fc-data-group="'+h+'"] .fc-repeatable-rows'),c.length>0&&(e=c.find(".fc-repeatable-row").length,e>getNumericTagValue(getConfig(j,"repeatableLinkedTo"))&&confirm(getConfig(j,"removeAlertText")))))){i=outputRepeatablePreDetermined(h,e-1,fc.sections[b]),c.html(i),setFieldValues(c),flushFieldVisibility(),flushActivePageForField(h,!0),void 0!==fc.fields[h]&&$.isArray(fc.fields[h])&&"string"==typeof h&&h.length>0&&!$.isNumeric(h)&&(e-1<=0?setVirtualValue(h,[]):(fc.fields[h].splice(e-1),fc.saveQueue[h]=fc.fields[h])),g=[h,e-1].join(fc.constants.prefixSeparator);for(f in fc.fields)fc.fields.hasOwnProperty(f)&&0===f.indexOf(g)&&(delete fc.fields[f],fc.saveQueue[f]="");e-1<=getNumericTagValue(getConfig(j,"repeatableLinkedTo"))?d.find(".fc-remove").addClass("fc-hide"):d.find(".fc-add.fc-hide")&&d.find(".fc-add.fc-hide").removeClass("fc-hide")}return fc.domContainer.trigger(fc.jsEvents.onDynamicRowRemoved),!1}),fc.domContainer.on("click",".fc-help-link",function(){var a=$(this).attr("data-for");return fc.helpData&&fc.helpData[a]&&(fc.modalState=fc.states.MODAL_TEXT,fc.modalMeta={body:fc.helpData[a]},showModal({addButton:!1,body:fc.helpData[a],title:fc.helpTitle[a]})),!1}),fc.domContainer.on("click",".fc-modal .fc-btn-close",function(){return $(".fc-modal.fc-show").removeClass("fc-show"),!1}),fc.domContainer.on("click",".fc-modal .fc-btn-add",function(){if(void 0!==fc.modalState&&"string"==typeof fc.modalState)switch(fc.modalState){case fc.states.DELETE_REPEATABLE:deleteRepeatableRow();break;case fc.states.ADD_REPEATABLE:addRepeatableRow();break;case fc.states.EMAIL_VERIFICATION_CODE:verifyEmailAddress();break;case fc.states.SMS_VERIFICATION_CODE:verifyMobileNumber();break;case fc.states.EDIT_REPEATABLE:editRepeatableRow();break;case fc.states.SUBMIT_DEVELOPMENT_BRANCH:hideModal(),fc.functions.loadNextPage(!0,!0)}return!1}),registerRepeatableGroupletListeners(),registerApiLookupListener(),fc.config.onePage&&registerOnePageListeners(),$(window).resize(function(){fc.mobileView=isMobile(),fc.mobileView!==fc.inMobileView&&updateMobileFieldsVisibility()})},renderAutoCompleteWidget=function(a,b,c){var d=fc.fieldSchema[a];if(!$.isArray(b))return"";var e=$('.fc-field[fc-data-group="'+a+'"]');0===e.length&&(e=fc.domContainer.find('[data-container="'+a+'"]')),e.addClass("fc-auto-suggest-open");var f,g,h,i,j,k,l=c.match(/\{([a-zA-Z0-9\-\_]+)\}/g);if(0===l.length)return"";for(g=0;g<l.length;g+=1)l[g]=l[g].replace(/[\{\}]/g,"");if(0===e.length)return"";if(f='<div class="fc-auto-suggest" data-id="'+a+'">',f+='<div class="fc-suggest-close"><a href="#">x</a></div>',0===b.length)f+='<div class="fc-suggest-row"><span>Sorry, no results found.</span></div>';else for(g=0;g<b.length;g+=1){for(j=b[g],i=c.slice(0),h=0;h<l.length;h+=1)k=new RegExp("{"+l[h]+"}","g"),i=i.replace(k,void 0!==j[l[h]]?j[l[h]]:"");f+='<div class="fc-suggest-row" data-suggest="'+encodeURI(JSON.stringify(j))+'" data-id="'+a+'"><a href="#">'+i+"</a></div>"}return"undefined"!=typeof d&&getConfig(d,"enableEnterManually",!1)&&(f+='<div><button class="fc-api-enter-manually" fc-belongs-to="'+a+'">Enter manually</button></div>'),f+="</div>"},removeAutoCompleteWidget=function(a){var b=$('.fc-field[fc-data-group="'+a+'"]').removeClass("fc-auto-suggest-open");return 0===b.length&&(b=fc.domContainer.find('[data-container="'+a+'"]').removeClass("fc-auto-suggest-open")),0!==b.length&&(fc.domContainer.off("click."+a),fc.domContainer.off("keydown."+a),void b.find(".fc-auto-suggest").remove())},moveSelectionAutoCompleteWidget=function(a,b){var c=$('.fc-auto-suggest[data-id="'+a+'"]'),d=38==b?"up":"down",e=c.find(".fc-suggest-row"),f=e.filter(".selected");if(0==f.length)e.first().addClass("selected");else{f.removeClass("selected");var g;"down"==d?(g=f.next(".fc-suggest-row"),g.length||(g=e.first())):(g=f.prev(".fc-suggest-row"),g.length||(g=e.last())),g.addClass("selected")}},enterSelectionAutoCompleteWidget=function(a,b){var c=$('.fc-auto-suggest[data-id="'+a+'"]'),d=c.find(".fc-suggest-row"),e=d.filter(".selected");selectRowAutoCompleteWidget(e)},selectRowAutoCompleteWidget=function(a){if("undefined"==typeof a.attr("data-suggest"))return!1;var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=JSON.parse(decodeURI(a.attr("data-suggest"))),t=getDataId(a.attr("data-id")),u=fc.fieldSchema[t],v=getConfig(u,"mapResponse","{}"),w=!1;if("object"!=typeof s)return!1;try{b=JSON.parse(v)}catch(x){return!1}if(c=getAllFieldTags(!0),t.indexOf(fc.constants.prefixSeparator)>=0&&(m=t.split(fc.constants.prefixSeparator),void 0!==fc.fieldSchema[m[0]]&&void 0!==fc.fieldSchema[m[0]].type&&"grouplet"===fc.fieldSchema[m[0]].type)){n=getFieldsSchema(getConfig(fc.fieldSchema[m[0]],"grouplet",{field:[]}).field),w=getConfig(fc.fieldSchema[m[0]],"repeatable",!1),m.splice(w?2:1);for(o in n)n.hasOwnProperty(o)&&(q=getConfig(n[o],"tag",""),q.length>0&&(p=m.slice(),p.push(o),c[q]=getDataId(p.join(fc.constants.prefixSeparator))))}for(d in b)if(b.hasOwnProperty(d)&&void 0!==c[d]&&(e=c[d],l=$('.fc-field[fc-data-group="'+e+'"]'),l.length>0)){if(f=b[d],g=f.match(/\{([a-zA-Z0-9\-\_]+)\}/g),g.length>0)for(h=0;h<g.length;h+=1)i=g[h].replace(/[\{\}]/g,""),k=new RegExp("{"+i+"}","g"),j=void 0!==s[i]?s[i]:"",f=f.replace(k,j);setValue(e,f)}var y=fc.domContainer.find('[data-container="'+t+'"]');if(u.config.requrieSelectionFromSuggestion){var z=l.find("input"),A=z.closest(".fc-field-element-container");z.attr("disabled","disabled").hover(function(a){$(a.currentTarget);A.append($('<span class="fc-reset-api-lookup-field">Click to reset</span>'))},function(a){A.find(".fc-reset-api-lookup-field").remove()})}return y.length>0&&y.find('input[type="text"].fc-fieldinput').val(a.find("a").text()),r=getConfig(u,"successfulTransaction",""),r.length>0&&$.ajax({type:"GET",url:r}),removeAutoCompleteWidget(t),!1},registerApiLookupListener=function(){fc.registeredApiLookup!==!0&&(fc.domContainer.on("click",".fc-field-apiLookup button.fc-api-enter-manually",function(a){var b=$(a.currentTarget),c=b.attr("fc-belongs-to"),d=fc.fieldSchema[c],e=$("input[formcorp-data-id="+c+"]").addClass("fc-hide"),f=JSON.parse(d.config.mapResponse),g=d.config.responseSummary;for(var h in f)if(f[h]!==g){var i=$(".fc-tag-"+h),j=i.find("input, select, textarea");fc.fieldSchema[j.attr("formcorp-data-id")];i.removeClass("fc-hide fc-enter-manually-hide"),j.off("input").on("input",function(a,b,e){return function(){var f=a;for(var g in e)e[g]!==a&&(f=f.replace(e[g],$(".fc-tag-"+g).find("input, select, textarea").first().val()));b.val(f.replace(/null|undefined/,"")),fc.fields[c]=b.val(),d.config.prePopulate&&d.config.prePopulate.length>0&&d.config.prePopulate.forEach(function(a){fc.fields[a]=b.val()})}}(g,e,f)).trigger("input").closest(".fc-field").removeClass("fc-field-success")}e.val("").closest(".fc-field").removeClass("fc-field-success")}),fc.domContainer.on("input paste",".fc-field-apiLookup input[type=text].fc-fieldinput, .fc-field-apiLookup input[type=tel].fc-fieldinput, .fc-field-apiLookup input[type=number].fc-fieldinput",function(a){var b=$(this),c=b.attr("formcorp-data-id");"undefined"!=typeof c&&"string"==typeof c&&0!==c.length||(c=b.attr("data-config"));var d=$('.fc-field[fc-data-group="'+c+'"]');if(0!==d.length||(d=fc.domContainer.find('[data-container="'+c+'"]'),0!==d.length)){var e,f,g,h,i,j,k,l,m=fc.fieldSchema[c],n=$(this).val(),o=getConfig(m,"responseSummary",""),p={},b=this;if(h=parseInt(getConfig(m,"gracePeriod",-1)),h<0)return void removeAutoCompleteWidget(c);if(0===o.length)return void removeAutoCompleteWidget(c);if(l=parseInt(getConfig(m,"minCharsBeforeTrigger",0)),l>0&&(j=n,i=getConfig(m,"stripCharRegex",""),i.length>0&&(k=new RegExp(i,"g"),j=j.replace(k,"")),j.length<l))return void removeAutoCompleteWidget(c);if(e=getConfig(m,"apiUrl",""),e.length<=0)return void removeAutoCompleteWidget(c);if(f=getConfig(m,"requestType","GET"),["GET","POST","PUT"].indexOf(f)<0)return void removeAutoCompleteWidget(c);p.type=f,["POST","PUT"].indexOf(f)>=0&&(g=getConfig(m,"postData",""),g.length>0&&(g=g.replace(/<value>/g,encodeURIComponent(n)),p.data=g)),e.indexOf("<value>")>=0&&(e=e.replace(/<value>/g,encodeURIComponent(n))),p.url=e,p.success=function(a){var b=renderAutoCompleteWidget(c,a,o),e=d.find(".fc-auto-suggest");e.length>0&&e.remove(),fc.domContainer.off("click."+c),fc.domContainer.on("click."+c,function(a){return!$(a.target).is('.fc-auto-suggest[data-id="'+c+'"]')&&void removeAutoCompleteWidget(c)}),fc.domContainer.off("keydown."+c),fc.domContainer.on("keydown."+c,function(a){38==a.keyCode||40==a.keyCode?moveSelectionAutoCompleteWidget(c,a.keyCode):13==a.keyCode?(a.preventDefault(),enterSelectionAutoCompleteWidget(c,a.keyCode)):9==a.keyCode?enterSelectionAutoCompleteWidget(c,a.keyCode):27==a.keyCode&&removeAutoCompleteWidget(c)}),d.find(".fc-fieldgroup").append(b)},setTimeout(function(){var a=getFieldValue($(b));a===n&&$.ajax(p)},h)}}),fc.domContainer.on("click",".fc-suggest-close a",function(){var a=$(this).parent().parent().attr("data-id");return removeAutoCompleteWidget(a),!1}),fc.domContainer.on("click",".fc-suggest-row",function(a){a.preventDefault(),selectRowAutoCompleteWidget($(this))}),fc.registeredApiLookup=!0)},generateRandomString=function(a){var b,c="",d="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";for(b=0;b<a;b+=1)c+=d.charAt(Math.floor(Math.random()*d.length));return c},loadCssFiles=function(){var a,b="formcorp-css",c="formcorp.css";for(0===$("#"+b).length&&loadCssFile(cdnUrl()+c),fc.domContainer.addClass("fc-container"),fc.config.hideModal||addModalWindow(),fc.domContainer.prepend('<div class="fc-loading-screen"><div class="fc-loading-halo"></div></div>'),a=0;a<fc.config.signatureLibCss.length;a+=1)loadCssFile(fc.config.signatureLibCss[a]);for(a=0;a<fc.config.signatureLibJs.length;a+=1)loadJsFile(fc.config.signatureLibJs[a]);fc.renderedSignatures={}},addModalWindow=function(){if(!($("#fc-modal").length>0)){var a='<div class="fc-modal" id="fc-modal" aria-hidden="true"><div class="modal-dialog"><div class="modal-header"><h2>'+fc.lang.addModalHeader+"</h2>"+(fc.config.showModalCloseInHeader?'<a href="#" class="btn btn-danger fc-btn-close">x</a> ':"")+'</div><div class="modal-body"></div><div class="modal-footer"><div class="fc-loading fc-hide"></div><div class="fc-error fc-hide"></div>'+(fc.config.showModalCloseInFooter?'<a href="#" class="btn btn-danger fc-btn-close">'+fc.lang.closeModalText+"</a> ":"")+'<a href="#" class="btn btn-success fc-btn-add">'+fc.lang.addModalText+"</a> </div></div></div></div>";fc.domContainer.prepend($(a))}},orderSchema=function(a,b){if(void 0===b&&(b="order"),"object"==typeof a){var c;for(c in a)a.hasOwnProperty(c)&&(a[c]&&"object"==typeof a[c]&&void 0!==a[c][0]&&a[c][0]&&void 0!==a[c][0].order?a[c]=orderObject(a[c]):a[c]=orderSchema(a[c],b))}return a},orderObject=function(a){var b,c,d,e=[],f=[];for(b in a)a.hasOwnProperty(b)&&(c=void 0!==a[b].order?a[b].order:0,void 0===e[c]&&(e[c]=[]),e[c].push(a[b]));for(b in e)if(e.hasOwnProperty(b))for(d=0;d<e[b].length;d+=1)f.push(e[b][d]);return f},pruneNonPageFields=function(a,b){var c,d,e,f,g=[],h={};if("object"==typeof a.page&&"object"==typeof a.page.section)for(d=0;d<a.page.section.length;d+=1)if(c=a.page.section[d],"object"==typeof c.field&&c.field.length>0)for(e=0;e<c.field.length;e+=1)f=c.field[e],g.push(f._id.$id),void 0!==b[f._id.$id]?h[f._id.$id]=b[f._id.$id]:h[f._id.$id]="";return h},removeInvisibleSectionFields=function(page,fields){var section,x,y,visible,field;if("object"==typeof page.page&&"object"==typeof page.page.section)for(x=0;x<page.page.section.length;x+=1)if(section=page.page.section[x],"string"==typeof section.visibility&&section.visibility.length>0&&(visible=eval(getBooleanLogic(section.visibility)),!visible&&"object"==typeof section.field&&section.field.length>0))for(y=0;y<section.field.length;y+=1)field=section.field[y],delete fields[field._id.$id];return fields},pruneInvisibleFields=function(fields){if("object"==typeof fields){var dataId,field,visible,json;for(dataId in fields)if(fields.hasOwnProperty(dataId)){if(field=fc.fieldSchema[dataId],void 0===field)continue;if(getConfig(field,"mobileOnly",!1)&&!fc.mobileView){delete fields[dataId];continue}if(getConfig(field,"desktopOnly",!1)&&fc.mobileView){delete fields[dataId];continue}if("string"==typeof field.config.visibility&&field.config.visibility.length>0){if(["[","{"].indexOf(field.config.visibility.substring(0,1))>-1)try{json=$.parseJSON(field.config.visibility),field.config.visibility=toBooleanLogic(json)}catch(ignore){}try{visible=eval(field.config.visibility),"boolean"==typeof visible&&(visible||delete fields[dataId])}catch(ignore){}}}}return fields},fieldIsValid=function(dataId,value,checkConfig){var schema,customErrors,id,iterator,grouplet,val,visible,defaultValue,errors;"boolean"!=typeof checkConfig&&(checkConfig=!1);try{if("string"==typeof dataId?schema=fc.fieldSchema[dataId]:"object"==typeof dataId&&(schema=dataId,dataId=getId(schema)),"object"!=typeof schema)return!0}catch(ignore){}if(fc.config.useTags&&objectHasTag(schema.config)&&!hasTags(schema.config.tags))return!0;if(getConfig(schema,"visibility",!1)!==!1)try{if(visible=eval(schema.config.visibility),"boolean"==typeof visible&&!visible)return!0}catch(ignore){}if(checkConfig){var classes=getConfig(schema,"class","");if("string"==typeof classes&&classes.length>0){var classesArr=classes.split(" ");if(classesArr.indexOf("fc-hide")>=0)return!0}}if(void 0!==schema.config&&void 0!==schema.config.required&&schema.config.required&&""===value)return defaultValue=getDefaultValue(schema),"string"==typeof defaultValue&&defaultValue.length>0;if("grouplet"===schema.type&&!getConfig(schema,"repeatable",!1)){if(grouplet=getConfig(schema,"grouplet",{}),void 0!==grouplet.field&&"object"==typeof grouplet.field&&grouplet.field.length>0)for(iterator=0;iterator<grouplet.field.length;iterator+=1)if(id=dataId+fc.constants.prefixSeparator+grouplet.field[iterator]._id.$id,val=void 0!==fc.fields[id]?fc.fields[id]:"",!fieldIsValid(grouplet.field[iterator],val))return!1;return!0}return errors=getFieldErrors(dataId),!($.isArray(errors)&&errors.length>0)&&(customErrors=getCustomErrors(schema,value),0===customErrors.length)},formFieldsValid=function(a,b){
if("object"!=typeof a)return!0;"boolean"!=typeof b&&(b=!1);var c;for(c in a)if(a.hasOwnProperty(c)&&!fieldIsValid(c,a[c],b))return!1;return!0},getFirstPageId=function(){var a;if(fc.channel&&"string"==typeof fc.channel&&fc.channel.length>0&&fc.schema.channel&&$.isArray(fc.schema.channel)&&fc.schema.channel.length>0)for(a=0;a<fc.schema.channel.length;a+=1)if(fc.schema.channel[a].name&&fc.schema.channel[a].name===fc.channel)return fc.schema.channel[a].default;if(!fc.config.useTags)return fc.schema.stage[0].page[0]._id.$id;if("object"!=typeof fc.tags||!$.isArray(fc.tags)||0==fc.tags.length)return fc.schema.stage[0].page[0]._id.$id;for(var b=0;b<fc.schema.stage.length;b+=1)for(var c=0;c<fc.schema.stage[b].page.length;c+=1){var d=fc.schema.stage[b].page[c];if("object"!=typeof d.tags||!$.isArray(d.tags)||0===d.tags.length||hasTags(d.tags))return d._id.$id}},getCurrentSection=function(pageId,useValidation){if(fc.config.sectionManagement){"boolean"!=typeof useValidation&&(useValidation=!1);var firstPageId=util.isEmpty(pageId)?getFirstPage():pageId,currentPage=getPageById(firstPageId),$currentPage=$(".fc-page-"+firstPageId),pageSections=util.arrayFrom(currentPage.page.section),sectionFields=function(a){var b={};return a.forEach(function(a){b[a._id.$id]=a.field.map(getId)}),b}(pageSections),currentSectionId;if(useValidation){var invalidFields=validForm($currentPage,!1,!0);for(var sectionId in sectionFields){if(util.intersectArray(invalidFields,sectionFields[sectionId]).length>0){currentSectionId=sectionId;break}currentSectionId=sectionId}}else currentSectionId=getId(util.arrayFrom(currentPage.page.section).sort(function(a,b){return"undefined"==typeof a.order||"undefined"!=typeof b.order&&b.order-a.order}).filter(function(sec){return""===sec.visibility||eval(getBooleanLogic(sec.visibility))}).pop());var $currentSection=$(".fc-section-"+currentSectionId);return currentSectionId}},setCurrentSection=function(a,b){if(fc.config.sectionManagement){var c=fc.currentSection,d=$(".fc-section"),e=$(".fc-section-"+a);d.removeClass("fc-current-section"),e.addClass("fc-current-section"),fc.currentSection=a,"boolean"==typeof b&&b&&e.length>0&&$("html, body").stop(!0,!0).animate({scrollTop:e.offset().top+fc.config.scrollOffset},400,"swing"),fc.domContainer.trigger(fc.jsEvents.onSectionChange,[a,c])}},getFirstPage=function(){var a,b,c,d,e=getFirstPageId(),f=!1;do{if(fc.currentPage=e,a=getPageById(e),void 0===a)break;if("object"!=typeof a.stage)break;if(fc.config.updateHash&&setHashVar(fc.config.hashPrefix,e),updateFieldSchema(a.stage),c=pruneNonPageFields(a,fc.fields),c=removeInvisibleSectionFields(a,c),c=pruneInvisibleFields(c),fc.config.onePage?(render(e),fc.mode!==fc.modes.PREPOPULATE&&flushVisibility(),f=fc.mode===fc.modes.PREPOPULATE||validForm(fc.jQueryContainer,!1)&&!isSubmitPage(a.page)):fc.mode===fc.modes.PREPOPULATE?f=!0:(d=formFieldsValid(c,!0),f=d&&!isSubmitPage(a.page)),f){if(b=nextPage(!1,!0),void 0===b||"object"!=typeof b){f=!1;break}if(e=b.page._id.$id,fc.prevPages[e]=a,isSubmitPage(b.page)===!0){f=!1;break}}}while(f);return e},loadSettings=function(a){api("form/settings",{},"post",function(b){"object"==typeof b&&(fc.settings=b),a()})},initRender=function(a){var b;fc.isRendered=!1,void 0!==a.stage&&(fc.schema=orderSchema(a),"object"==typeof fc.schema.stage&&fc.schema.stage.length>0&&"object"==typeof fc.schema.stage[0].page&&fc.schema.stage[0].page.length>0&&(b=getFirstPage(),fc.config.onePage||(fc.currentPage=getFirstPageId(),render(b,!0)))),fc.mode===formcorp.MODE_REVIEW&&readOnly(),fc.domContainer.trigger(fc.jsEvents.onConnectionMade);var c=getCurrentSection(b,!0);$(".fc-section-"+c);setTimeout(function(){setCurrentSection(c,!0)},fc.config.pageAnimations?fc.config.pageAnimations.prev.delay:0)},autoLoadLibs=function(a){var b,c=[],d=0;if(fc.schemaData=a,"object"==typeof fc.fieldSchema&&Object.keys(fc.fieldSchema).length>0)for(var e in fc.fieldSchema)fc.fieldSchema.hasOwnProperty(e)&&"object"==typeof fc.fieldSchema[e]&&"string"==typeof fc.fieldSchema[e].type&&c.indexOf(fc.fieldSchema[e].type)==-1&&c.push(fc.fieldSchema[e].type);var f,g,h;for(f=0;f<c.length;f+=1)if(b=c[f],"object"==typeof fc.requiredFieldLibraries[b]&&$.isArray(fc.requiredFieldLibraries[b])&&fc.requiredFieldLibraries[b].length>0)for(g=0;g<fc.requiredFieldLibraries[b].length;g+=1){if($.isArray(fc.libraryPreCallbacks[b]))for(var i=0;i<fc.libraryPreCallbacks[b].length;i+=1){var j=fc.libraryPreCallbacks[b][i];"function"==typeof j&&j()}h=fc.requiredFieldLibraries[b][g],fc.libs2Load.push(h),fc.libsLoaded.indexOf(b)<0&&fc.libsLoaded.push(b),loadLib(h),++d}if(d){if(sessionRequiresVerification(a))return void verifySession()}else checkAllLibsLoaded(a)},setSchemaData=function(a){if("object"==typeof a.data&&Object.keys(a.data).length>0)for(var b in a.data)a.data.hasOwnProperty(b)&&("string"==typeof b&&b.length>0&&!$.isNumeric(b)&&setVirtualValue(b,a.data[b]),fc.fieldSchema[b]&&fc.fieldSchema[b].type&&"abnVerification"===fc.fieldSchema[b].type&&fc.fields[b].length>0&&fc.validAbns.push(fc.fields[b]),b.indexOf(fc.constants.prefixSeparator)>-1&&saveOriginalGroupletValue(b,a.data[b]))},preVerificationComplete=function(){api("form/data",{},"post",function(a){"object"==typeof a&&a.success&&(fc.domContainer.html('<div class="render"></div>'),setSchemaData(a),fc.schemaData.data=a.data,fc.schemaData.files=a.files,fc.schemaData.verify={perform:!1})})},verifySession=function(){var a=fc.schemaData.verify,b="";switch(b+='<div class="fc-page fc-page-verify-session">',b+='<div class="fc-section">',b+='<div class="fc-section-header">',b+='<div class="fc-section-label">',b+="<h4>Welcome back!</h4>",b+="</div>",b+="</div>",b+='<div class="fc-section-body">',b+='<div class="fc-resume-choice">',b+="<p>The progress of filling your application has been saved since your last visit.</p><p>You can resume your application or start a new one by clicking on the buttons below:</p>",b+='<input type="'+fc.config.buttonInputType+'" class="fc-btn fc-resume-application-button" onclick="resumeApplication()" value="Resume application">',b+='<script>function hardreload() {$.removeCookie("fcSessionId");location.reload(true);}</script>',b+='<script>function resumeApplication() {$(".fc-resume-choice").slideUp();$(".fc-resume-application").slideDown();$(".fc-send-sms input").trigger("click");}</script>',b+="</div>",b+='<div class="fc-resume-application" style="display:none">',b+="<p>In order to resume your application, you must first verify your credentials. We have sent a confirmation number to your ",b+="sms"===a.method?"mobile phone":"e-mail address",b+=". Please enter the code below or click the button to re-send the verification code.</p>",b+='<div class="fc-field fc-field-smsVerification">',a.method){case"sms":var c={_id:{$id:"preVerification"},config:{autoDeliverOnFirstRender:!1,renderAsModal:!1,verificationButtonText:fc.lang.verify}};b+=renderSmsVerification(c)}b+="</div>",b+="</div>",b+='<input type="'+fc.config.buttonInputType+'" class="fc-btn fc-restart-application" onclick="hardreload()" value="Restart application">',b+='<div class="fc-clear"></div>',b+="</div>",b+="</div>",b+="</div>",fc.domContainer.html(b),fc.domContainer.trigger(fc.jsEvents.onConnectionMade)},loadSchema=function(){api("form/schema",{},"post",function(a){if("boolean"==typeof a.error&&a.error)return void log("FC Error: "+a.message);a.stage.map(function(a){return a.page.map(function(a){if(Array.isArray(a.section))return a;var c=[];for(b in a.section)c.push(a.section[b]);return a.section=c,a})});var b;if(a&&a.stage&&setFieldSchemas(a.stage),setSchemaData(a),"object"==typeof a.lang&&loadLanguagePack(a.lang),fc.domContainer.trigger(fc.jsEvents.onSchemaLoaded),fc.config.autoDiscoverLibs){autoLoadLibs(a);var c=setInterval(function(){fc.libs2Load.length<fc.libsLoaded.length||(initRender(fc.schemaData),clearInterval(c))},50)}else{if(sessionRequiresVerification(a))return void verifySession();initRender(a)}})},processSaveQueue=function(){if(fc.mode!==formcorp.MODE_REVIEW&&fc.config.saveInRealTime===!0){if(fc.saveQueueRunning===!0)return void log("[FC] Save queue is already running (slow server?)");if(0!==Object.keys(fc.saveQueue).length){fc.saveQueueRunning=!0;var a=fc.saveQueue,b={form_id:fc.formId,page_id:fc.pageId,form_values:a};api("page/submit",b,"put",function(b){var c;if("object"==typeof b&&b.success===!0){fc.lastActivity=(new Date).getTime();for(c in a)a.hasOwnProperty(c)&&("string"==typeof fc.saveQueue[c]&&fc.saveQueue[c]===a[c]?delete fc.saveQueue[c]:"object"==typeof fc.saveQueue[c]&&"object"==typeof a[c]?JSON.stringify(fc.saveQueue[c])===JSON.stringify(a[c])&&delete fc.saveQueue[c]:fc.saveQueue[c]===a[c]&&delete fc.saveQueue[c])}fc.saveQueueRunning=!1})}}},{libs:{MATERIAL_DATEPICKER:"materialDatepicker",IDMATRIX:"idmatrix"},modes:{DEFAULT:"defaultMode",PREPOPULATE:"propopulateMode"},init:function(a,b){this.publicKey=a,this.container=b,this.jQueryContainer="#"+b,this.domContainer=$(this.jQueryContainer),this.callbacks={afterRender:[]},this.fields={},this.fieldSchema={},this.sections={},this.pages={},this.saveQueueRunning=!1,this.saveQueue={},this.prevPages={},this.lastActivity=(new Date).getTime(),this.expired=!1,this.pageOrders=[],this.activeScroll="",this.processedActions={},this.analytics=!1,this.lastCompletedField="",this.lastCompletedTimestamp=Date.now(),this.lastHesitationTime=-1,this.nextPageLoadedTimestamp=Date.now(),this.nextPageButtonClicked=!1,this.validAbns=[],this.mobileView=isMobile(),this.withinIterator={},this.preventNextPageLoad=!1,this.developmentBranches=["Staging","Development","Dev"],this.fieldCount=0,this.formState="",this.intervals=[],this.loadedLibs=[],this.languagePacks={},this.getPagesByTag=getPagesByTag,this.util=util,this.scrollInterval=!1,this.progressBar=!1,this.progressBarFactory=progressBarFactory,this.functions={loadNextPage:loadNextPage,loadPrevPage:loadPrevPage,afterRender:afterRender},this.requiredFieldLibraries={date:[this.libs.MATERIAL_DATEPICKER],digsigCollect:["lib/featherlight/featherlight.min.css","lib/featherlight/featherlight.min.js"],greenIdVerification:["lib/global/lodash.core.min.js",isMinified()?"lib/green-id.min.js":"lib/green-id.js","lib/green-id/green-id.css"],idmatrix:[this.libs.IDMATRIX]},this.libraryCallbacks={greenIdVerification:[function(){fc.greenID.initGreenId()}]},this.libraryPreCallbacks={greenIdVerification:[initGreenId]},this.libsLoaded=[],"undefined"==typeof this.libs2Load&&(this.libs2Load=[]),"undefined"==typeof this.entityTokens&&(this.entityTokens={}),"string"!=typeof this.mode&&(this.mode=this.modes.DEFAULT),"undefined"==typeof this.tags&&(this.tags=[]),"undefined"==typeof this.languageAliasMaps&&(this.languageAliasMaps={}),jQuery.support.cors=!0,this.reRenderOnValueChange={},this.fieldGrouplets={},"boolean"!=typeof this.dev&&(this.dev=!1),this.states={DELETE_REPEATABLE:"deleteRepeatable",ADD_REPEATABLE:"addRepeatableRow",EDIT_REPEATABLE:"editRepeatableRow",EMAIL_VERIFICATION_CODE:"emailVerificationCode",SMS_VERIFICATION_CODE:"smsVerificationCode",MODAL_TEXT:"modalText",SUBMIT_DEVELOPMENT_BRANCH:"submitDevelopmentBranch"},this.eventTypes={onFieldInit:"onFieldInit",onFocus:"onFocus",onBlur:"onBlur",onValueChange:"onValueChange",onNextStage:"onNextStage",onFormInit:"onFormInit",onMouseDown:"onMouseDown",onFieldError:"onFieldError",onNextPageClick:"onNextPageClick",onNextPageSuccess:"onNextPageSuccess",onNextPageError:"onNextPageError",onFormComplete:"onFormComplete"},this.jsEvents={onFormInit:"OnFcInit",onFormExpired:"onFormExpired",onValidationError:"onValidationError",onFormComplete:"onFormComplete",onNextPage:"onNextPage",onPageChange:"onPageChange",onPrevPage:"onPrevPage",onSectionChange:"onSectionChange",onConnectionMade:"onFCConnectionMade",onFinishRender:"onFinishFormRender",onFieldError:"onFieldError",onFieldSuccess:"onFieldSuccess",onAnalyticsLoaded:"onAnalyticsLoaded",onFieldValueChange:"onFieldValueChange",onLoadingPageStart:"onLoadingPageStart",onLoadingPageEnd:"onLoadingPageEnd",onGreenIdLoaded:"onGreenIdLoaded",onButtonUnknownClick:"onButtonUnknownClick",onDynamicRowAdded:"onDynamicRowAdded",onDynamicRowRemoved:"onDynamicRowRemoved",onPreValueChange:"onPreValueChange",onSchemaLoaded:"onSchemaLoaded",onValueChanged:"onValueChanged",onVisibilityChanged:"onVisibilityChanged",onFieldFocus:"onFieldFocus",onFieldBlur:"onFieldBlur",onCustomerAuthResult:"onCustomerAuthResult",onFormStateChange:"onFormStateChange",onPageRender:"onPageRender"},this.processes={emailListeners:"emailListeners",smsListeners:"smsListeners",creditCardListeners:"creditCardListeners",loadSignatureLibs:"loadSignatureLibs"},this.constants={enterKey:13,prefixSeparator:"_",tagSeparator:".",configKeys:{summaryLayout:"summaryLayout"},persistentSessions:"persistentSessions",enhancedSecurity:"enhancedSecurity",defaultChannel:"master",greenId:{scriptPath:isMinified()?"lib/green-id.min.js":"lib/green-id.js"},repeatableWithButton:[0,1],repeatablePredetermined:2,repeatableInModal:[0],repeatableInDOM:[1,2],repeatableLinkedTo:"repeatableLinkedTo",functionCallbackType:"functionCallback",formulaPrefix:"FORMULA:",formLoadedClass:"fc-form-loaded",stateLoadingEntityRecord:"loadingEntityRecord",optionValueSeparator:"|"},this.environments={live:"Live",sandbox:"Sandbox"},this.gateways={paycorp:{method:"POST",action:{sandbox:"https://test-merchants.paycorp.com.au/paycentre3/makeEntry",live:"https://merchants.paycorp.com.au/paycentre3/makeEntry"}},securepay:{method:"POST",action:{sandbox:"https://payment.securepay.com.au/test/v2/invoice?bill_name=transact",live:"https://payment.securepay.com.au/live/v2/invoice?bill_name=transact"}}},this.cardTypes={visa:"visa",mastercard:"mastercard",amex:"amex"},void 0===fc.config&&this.setConfig(),void 0===fc.lang&&this.setLanguage(),void 0===fc.channel&&(fc.channel=fc.constants.defaultChannel),$(document).ready(function(){return(fc.config.analytics===!0||"string"==typeof fc.config.analytics&&fc.config.analytics.length>0)&&initAnalytics(),0!==fc.domContainer.length&&(""!==fc.domContainer.attr("data-id")&&(fc.formId=fc.domContainer.attr("data-id"),fc.domContainer.attr("data-mode",fc.mode),loadJsFile(parserUrl(),function(){fc.parser=new Parser,fc.parser.functions.groupletLength=groupletLength,fc.parser.functions.getValue=getValue,fc.parser.functions.fieldIdByTag=fieldIdByTag,fc.parser.functions.getContentRadioListMeta=getContentRadioListMeta}),loadLibs(),void loadSettings(function(){fc.initSession(),fc.domContainer.hasClass("fc-channel")||fc.domContainer.addClass("fc-channel fc-channel-"+fc.channel),fc.domContainer.html('<div class="render"></div>'),loadCssFiles(),registerEventListeners(),loadSchema(),fc.formPosition=fc.domContainer.position(),logEvent(fc.eventTypes.onFormInit),fc.domContainer.trigger(fc.jsEvents.onFormInit),fc.domContainer.addClass(fc.constants.formLoadedClass),isDevelopmentBranch()&&fc.domContainer.on(fc.jsEvents.onFinishRender,function(){var a=$(document);if(0===a.find(".fc-dev-status").length){var b=$("<div></div>");b.attr("class","fc-dev-status"),b.append("<span></span>"),b.find("span").html("in development"),a.find("body").append(b)}}),fc.config.saveInRealTime===!0&&fc.intervals.push(setInterval(function(){processSaveQueue()},fc.config.saveInRealTimeInterval)),fc.config.timeUserOut&&fc.intervals.push(setInterval(function(){fc.expired!==!0&&timeout()},5e3))})))})},getCdnUrl:function(){return cdnUrl},api:api,getConfig:getConfig,getSessionId:getSessionId,getId:getId,renderGreenIdField:renderGreenIdField,initGreenIdFieldInDOM:initGreenIdFieldInDOM,loadMaterialDatepicker:loadMaterialDatepicker,renderIDMatrixField:renderIDMatrixField,getAllFieldTags:getAllFieldTags,getFieldTagValues:getFieldTagValues,getTokens:getTokens,setLanguageAlias:setLanguageAlias,showModal:showModal,getUrlParameter:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))},setDevelopmentBranches:function(a){$.isArray(a)&&(fc.developmentBranches=a)},getDevelopmentBranches:function(){return fc.developmentBranches},setBranch:function(a){this.branch=a},setAsDevelopmentMode:function(a){"boolean"!=typeof a&&(a=!0),this.dev=a},ui:{renderDropdown:renderDropdown,renderTextfield:renderTextfield},setApiUrl:function(a){return"string"==typeof a&&(this.apiUrl=a,!0)},setCdnUrl:function(a){return"string"==typeof a&&(this.cdnUrl=a,!0)},setChannel:function(a){this.channel=a},setSessionId:function(a){this.sessionId=a},setValue:setValue,setVirtualValue:setVirtualValue,deleteSession:deleteSession,getValue:function(a){return getValue(a)},getFieldDefinition:function(a){return fc.fieldSchema[a]||!1},setConfig:function(a){var b,c=8e3,d=6e3;if(this.config={activePageOffset:250,administrativeEdit:!1,analytics:!0,asterisksOnLabels:!0,autoDiscoverLibs:!0,autoLoadPages:!1,autoScrollToNextField:!1,autoShiftFocusOnEnter:!1,buttonInputType:"submit",colonAfterLabel:!0,conditionalHtmlScrollOffset:{},creditCardErrorUrlParam:"creditCardError",creditCardNumberLimits:[16,16],css:{entityRecordLoadingClass:"entity-record-loading"},cvvImage:null,datePickerIconOffset:25,debug:!1,deleteSessionOnComplete:!0,descriptionBeforeLabel:!0,entityPrefix:"ent:",eventQueueInterval:c,forceNextPageAutoload:!1,forceSignatureLib:!1,hashPrefix:"h:",hashSeparator:",",helpAsModal:!1,helpDefaultWhenNoTitleText:!0,hideModal:!1,initialScrollOffset:0,inlineValidation:!0,maxCreditCardCodeLength:4,minSizeForMobile:479,onePage:!1,pageAnimations:!1,progressBarStick:!1,progressBarStickClass:"sticky",progressBarPristineClass:"pristine",progressBarUnstickClass:"unsticky",progressBarBodyStickClass:"stick-progress-bar",progressBarOffset:0,realTimeValidation:!0,renderEmptyLabels:!1,renderOnlyVertical:!0,saveInRealTime:!0,saveInRealTimeInterval:d,sectionManagement:!1,scrollDuration:1e3,scrollOffset:0,scrollOnSubmitError:!1,scrollWait:500,sessionIdName:"fcSessionId",sessionKeyLength:40,showModalCloseInFooter:!0,showModalCloseInHeader:!0,showNextSectionButtons:!1,hideLastNextSectionButton:!1,showPrevPageButton:!0,signatureLibCss:[cdnUrl()+"dist/signaturepad/assets/jquery.signaturepad.css"],signatureLibJs:[cdnUrl()+"dist/signaturepad/jquery.signaturepad.min.js",cdnUrl()+"dist/signaturepad/assets/flashcanvas.js",cdnUrl()+"dist/signaturepad/assets/json2.min.js"],signatureClass:"sigPad",smoothScroll:!1,staticHelpModalLink:!1,timeOutWarning:870,timeOutAfter:900,timeUserOut:!1,updateHash:!0,useTags:!0,verificationModal:!1},this.config.eventQueueInterval<c&&(this.config.eventQueueInterval=c),this.config.saveInRealTimeInterval<d&&(this.config.saveInRealTimeInterval=d),"object"==typeof a&&Object.keys(a).length>0)for(b in a)a.hasOwnProperty(b)&&(fc.config[b]=a[b])},fieldErrors:fieldErrors,setLanguage:function(a){var b;if(Object.keys(this).indexOf("lang")===-1&&(this.lang={prevButtonText:"Previous",submitText:"Next",submitFormText:"Submit application",formCompleteHtml:'<h2 class="fc-header">Your application is complete</h2><p>Congratulations, your application has successfully been completed. Please expect a response shortly.</p>',addFieldTextValue:"Add value",removeFieldTextValue:"Remove value",closeModalText:"Close",addModalText:"Add",addModalHeader:"Add value",emptyFieldError:"This field cannot be empty",defaultCustomValidationError:"This field failed custom validation",sessionExpiredHtml:'<h2 class="fc-header">Your session has expired</h2><p>Unfortunately, due to a period of extended inactivity, your session has expired. To fill out a new form submission, please refresh your page.</p>',creditCardNameText:"Name (as it appears on your card)",creditCardNumberText:"Card number (no dashes or spaces)",creditCardExpiryDateText:"Expiration date",creditCardSecurityCodeText:"Security code (3 on back, Amex: 4 on front)",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],creditCardMissingName:"You must enter a valid name as it appears on your credit card",creditCardMissingNumber:"You must enter a valid credit card number",creditCardMissingExpiryDate:"You must enter a valid expiry date",creditCardExpired:"Your card has expired",creditCardMissingSecurityCode:"You must enter a valid security code",creditCardNumberIncorrectFormat:"The format of your credit card number is incorrect, please verify your details",edit:"Edit",delete:"Delete",error:"Error",verificationErrorPrefix:"ERROR: ",verificationEmptyCode:"You must enter a verification code.",defaultModalTitle:"Information",deleteDialogHeader:"Are you sure?",editDialogHeader:"Edit",deleteSignatoryDialogText:"Are you sure you want to delete the selected signatory?",editSignatoryDialogText:"Edit signatory",confirm:"Confirm",invalidCardFormat:"The credit card you entered could not be recognised",sendEmail:"Send email",fieldValidated:'<p><i class="fa fa-check"></i>Successfully verified</p>',fileFieldErrorPrefix:"ERROR:",fileFriendlyFieldErrorPrefix:"We're sorry, but ",fieldMustBeVerified:"You must first complete verification",fileFieldTypeError:"Unaccepted file type. Available File Types: ",fileFieldSizeError:"We're sorry, the file you uploaded is too large. Max file size allowed: ",invalidFiles:"You have invalid files.",noValidFiles:"You have no valid files.",sendSms:"Re-Send SMS",payNow:"Pay now",creditCardSuccess:"<p>Your payment has successfully been processed.</p>",paymentRequired:"Payment is required before proceeding.",paymentGst:"GST:",paymentSubTotal:"Sub-total:",paymentTotal:"Total:",currencySymbol:"$",total:"Total",description:"Description",paymentDescription:"Application completion",validate:"Validate",validAbnRequired:"You must enter and validate a valid ABN.",helpModalLink:"what is this?",helpTitle:"What is this?",requiredAsterisk:"*",labelColon:":",fileUploadCopy:"Attach File(s)",greenID:{options:{driversLicense:{title:"Drivers Licence",body:"Use your state issued driver's licence to help prove your identity.",icon:"",dependencies:["sources.driversLicense.act","sources.driversLicense.nsw","sources.driversLicense.nt","sources.driversLicense.qld","sources.driversLicense.sa","sources.driversLicense.tas","sources.driversLicense.vic","sources.driversLicense.wa","sources.driversLicense.act.dvs","sources.driversLicense.nsw.dvs","sources.driversLicense.nt.dvs","sources.driversLicense.qld.dvs","sources.driversLicense.sa.dvs","sources.driversLicense.tas.dvs","sources.driversLicense.vic.dvs","sources.driversLicense.wa.dvs"]},passport:{title:"Passport",body:"Help confirm your identity using the details on your Australian issued passport.",icon:"",dependencies:["sources.passport"]},visa:{title:"Visa",body:"Help confirm your identity using the details on your Australian issued Visa",icon:"",dependencies:["sources.visa"]},skip:{title:"Skip Verification",body:"You will be required to manually attach verification documents upon form submission.",icon:""}},html:{completePrefix:"To complete digital verification for this individual, you must verify <span></span> from the options below.",alreadyInitialised:"<em>This individual has previously undergone electronic verification elsewhere on the form.</em>",skipped:"You have skipped verification for this user.",completed:"You have successfully been verified."}},verify:"Verify",passwordHidden:"Hidden",yes:"Yes",no:"No",confirmSubmitDevelopment:"The form is currently on a <em>development branch</em>. Are you sure you want to submit?",areSureHeader:"Are you sure?",loading:"Loading...",dateCorrectFormat:"Date must be in a valid format",optionPrefix:"opt_",urlSessionPrefix:"s:",downloadButtonText:"Download"}),"object"==typeof a&&Object.keys(a).length>0)for(b in a)a.hasOwnProperty(b)&&(fc.lang[b]=a[b])},getSetting:function(a,b){return fc.settings&&void 0!==fc.settings[a]?fc.settings[a]:b},remoteApiUrl:apiUrl,initSession:function(){if(!("string"==typeof this.sessionId&&this.sessionId.length>0)){if(this.getSetting(this.constants.persistentSessions,!1)){var a=getHashVar(fc.lang.urlSessionPrefix);if(a.length>0)return $.cookie(this.config.sessionIdName,a),this.sessionId=a,void removeHashVar(fc.lang.urlSessionPrefix);if(void 0!==this.sessionId)return void $.cookie(this.config.sessionIdName,this.sessionId)}void 0===this.sessionId&&void 0===$.cookie(this.config.sessionIdName)?(this.sessionId=generateRandomString(this.config.sessionKeyLength),$.cookie(this.config.sessionIdName,this.sessionId)):this.sessionId=$.cookie(this.config.sessionIdName)}},overrideFunction:function(a,b){"string"==typeof a&&"function"==typeof b&&(fc.functions[a]=b)},loadNextPage:loadNextPage,loadPrevPage:loadPrevPage,afterRender:afterRender,validForm:validForm,getFieldValue:getFieldValue,pageIsValid:function(a){var b=$('.fc-page[data-page-id="'+a+'"]');if(b&&b.length>0)return validForm(b,!1)},getPageById:getPageById,comparisonEqual:function(a,b){return void 0!==a&&a===b},comparisonNot_equal:function(a,b){return a!==b},comparisonIn:function(a,b,c){if(void 0===a)return!1;var d,e,f;try{f=$.parseJSON(a),a=f}catch(g){}if("number"==typeof a&&(a=""+a),"string"==typeof a){if("object"==typeof b)for(d=0;d<b.length;d+=1)if(e=b[d],a===e)return!0}else if(a&&b&&"object"==typeof a&&"object"==typeof b){for(d=0;d<b.length;d+=1)try{if(a&&a.indexOf(b[d])===-1)return!1}catch(g){}return!0}return!1},comparisonNot_in:function(a,b,c){return!fc.comparisonIn(a,b,c)},comparisonIs_not_null:function(a){return void 0!==a&&("string"==typeof a?a.length>0:void 0)},comparisonIs_null:function(a){return void 0===a||"string"==typeof a&&0===a.length},comparisonIs_not_empty:function(a){return void 0!==a&&("string"==typeof a?a.length>0:"object"==typeof a?$.isArray(a)?a.length>0:Object.keys(a).length>0:void 0)},comparisonIs_empty:function(a){return void 0!==a&&("string"==typeof a?0===a.length:"object"==typeof a?$.isArray(a)?0===a.length:0===Object.keys(a).length:void 0)},comparisonContains:function(a,b){return void 0!==a&&a.indexOf(b)>-1},comparisonNot_contains:function(a,b){return void 0!==a&&a.indexOf(b)===-1},comparisonGreater:function(a,b){return $.isNumeric(a)&&$.isNumeric(b)&&parseFloat(a)>parseFloat(b)},comparisonGreater_or_equal:function(a,b){return $.isNumeric(a)&&$.isNumeric(b)&&parseFloat(a)>=parseFloat(b)},comparisonLess:function(a,b){return $.isNumeric(a)&&$.isNumeric(b)&&parseFloat(a)<parseFloat(b)},comparisonLess_or_equal:function(a,b){return $.isNumeric(a)&&$.isNumeric(b)&&parseFloat(a)<=parseFloat(b)},getHashVar:getHashVar,addTag:addTag,removeTag:removeTag,setTags:setTags,getTags:getTags,addLib:addLib,setEntityToken:setEntityToken,setEntityTokens:setEntityTokens,setValueUpdate:setValueUpdate,tokenise:tokenise,setMode:setMode,getMode:getMode,setCompletionCondition:setCompletionCondition,initGreenIdDOMFields:initGreenIdDOMFields,toCamelCase:function(a){return a.replace(/^([A-Z])|\s(\w)/g,function(a,b,c){return c?c.toUpperCase():b.toLowerCase()})}}}(jQuery);return self.forms[id]=fc,self.forms[id]},validators={range:function(a,b){if(!$.isNumeric(b))return!1;var c=parseFloat(a[0]),d=parseFloat(a[1]),e=parseFloat(b);return e>=c&&e<=d},min:function(a,b){return b=b.replace(/\,/g,""),!!$.isNumeric(b)&&parseFloat(b)>=parseFloat(a[0])},max:function(a,b){return b=b.replace(/\,/g,""),!!$.isNumeric(b)&&parseFloat(b)<=parseFloat(a[0])},regularExpression:function(a,b){var c=new RegExp(a[0]);return c.test(b)},validAbn:function(a){if(0===a.replace(/[^0-9]/g,"").length)return!1;var b,c=[10,1,3,5,7,9,11,13,15,17,19],d=0,e=a.replace(/[\s]+/g,""),f=e.split("");if(/[^0-9]/.test(e))return!1;if(11!==e.length)return!1;for(f[0]=parseInt(f[0])-1,b=0;b<11;b+=1)d+=parseInt(f[b])*c[b];return d%89===0},validAcn:function(a){if(0===a.replace(/[^0-9]/g,"").length)return!1;var b,c,d,e=[8,7,6,5,4,3,2,1],f=0,g=a.replace(/[\s]+/g,"",a),h=g.split("");if(/[^0-9]/.test(g))return!1;if(9!==g.length)return!1;for(b=0;b<8;b+=1)f+=parseInt(h[b])*e[b];return c=f%10,d=(10-c)%10,d===parseInt(h[8])},validAcnOrAbn:function(a){return validAbn(a)||validAcn(a)},validTFN:function(a){if(0===a.replace(/[^0-9]/g,"").length)return!1;if(!/^\d{9}$/g.test(a))return!1;var b,c=[1,4,3,7,5,8,6,9,10],d=0,e=["333333333","444444441","444444442","555555555","666666666","777777777","888888888","987654321","000000000","111111111"];if(e.indexOf(a)>=0)return!0;for(b=0;b<9;b+=1)d+=a[b]*c[b];return d%11===0}};return{const:{},create:create,destroyForm:destroyForm,forms:self.forms,getForms:getForms,getForm:getForm,modules:{},validators:validators,MODE_REVIEW:"review"}}();